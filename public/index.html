<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="chimps">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="chimps">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="chimps">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":30},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> chimps </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">chimps</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/小坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/小坑/" itemprop="url">
                  小坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T00:02:30+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id=""><a href="#" class="headerlink" title=":="></a><code>:=</code></h1><p>如下函数：<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetAll</span><span class="params">(sql <span class="keyword">string</span>)</span> <span class="params">(records []<span class="keyword">interface</span>&#123;&#125;, err error)</span></span> &#123;</div><div class="line">	query, err := DB.Query(sql)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	column, _ := query.Columns()</div><div class="line">	scans := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(column))</div><div class="line">	values := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(column))</div><div class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> values &#123;</div><div class="line">		scans[i] = &amp;values[i]</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> query.Next() &#123;</div><div class="line">	    <span class="comment">// 如果此处写成err := query.Scan(scans...)。</span></div><div class="line">	    <span class="comment">// 那么在此作用域内，err 和 外层作用域不同，return会报错</span></div><div class="line">		err = query.Scan(scans...)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">		record := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</div><div class="line">		<span class="keyword">for</span> i, col := <span class="keyword">range</span> values &#123;</div><div class="line">			<span class="keyword">if</span> col != <span class="literal">nil</span> &#123;</div><div class="line">				record[column[i]] = <span class="keyword">string</span>(col.([]<span class="keyword">byte</span>))</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		records = <span class="built_in">append</span>(records, record)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="mysql-NULL-值"><a href="#mysql-NULL-值" class="headerlink" title="mysql NULL 值"></a>mysql NULL 值</h1><p>如果mysql的某个值为null，go查询数据库时则会报错：<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">sql: Scan error on column index <span class="number">2</span>: unsupported Scan, storing driver.Value <span class="keyword">type</span> &lt;<span class="literal">nil</span>&gt; into <span class="keyword">type</span> *<span class="keyword">string</span></div></pre></td></tr></table></figure></p>
<p>解决办法：</p>
<ul>
<li><p>对于可能为NULL的字段读取，go的sql模块提供了一个sql.NullString这样的东东来解析可能为NULL的字符串，对于浮点型或者整形也有类似的数据类型。很蛋疼的样子，不过可以解决问题，下面是遵照这种方案进行的修改。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">rows.Next() &#123;</div><div class="line">  <span class="keyword">var</span> id <span class="keyword">int</span></div><div class="line">  <span class="keyword">var</span> name, info sql.NullString</div><div class="line">  <span class="keyword">if</span> err = rows.Scan(&amp;id, &amp;name, &amp;info); err != <span class="literal">nil</span> &#123;</div><div class="line">    fmt.Println(<span class="string">"获取结果出错："</span> + err.Error())</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line">  fmt.Println(<span class="string">"id:"</span>, id, <span class="string">"name:"</span>, name.String, <span class="string">"info:"</span>, info.String)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>sql语句本身也能解决这种问题<br>此时也不需要修改go代码，继续保持go的强类型风格</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">IFNULL</span>(<span class="string">`name`</span>, <span class="string">''</span>) <span class="keyword">AS</span> <span class="string">`name`</span>, <span class="keyword">IFNULL</span>(info, <span class="string">''</span>) <span class="keyword">AS</span> info <span class="keyword">FROM</span> <span class="keyword">user</span></div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/gin文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/gin文档/" itemprop="url">
                  gin文档
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T00:01:06+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>（摘录）</p>
</blockquote>
<h1 id="Gin-Web-Framework"><a href="#Gin-Web-Framework" class="headerlink" title="Gin Web Framework"></a>Gin Web Framework</h1><p><img align="right" src="https://raw.githubusercontent.com/gin-gonic/gin/master/logo.jpg"><br><a href="https://travis-ci.org/gin-gonic/gin" target="_blank" rel="external"><img src="https://travis-ci.org/gin-gonic/gin.svg" alt="Build Status"></a><br><a href="https://codecov.io/gh/gin-gonic/gin" target="_blank" rel="external"><img src="https://codecov.io/gh/gin-gonic/gin/branch/master/graph/badge.svg" alt="codecov"></a><br><a href="https://goreportcard.com/report/github.com/gin-gonic/gin" target="_blank" rel="external"><img src="https://goreportcard.com/badge/github.com/gin-gonic/gin" alt="Go Report Card"></a><br><a href="https://godoc.org/github.com/gin-gonic/gin" target="_blank" rel="external"><img src="https://godoc.org/github.com/gin-gonic/gin?status.svg" alt="GoDoc"></a><br><a href="https://gitter.im/gin-gonic/gin?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="external"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/gin-gonic/gin"></a></p>
<p>Gin is a web framework written in Go (Golang). It features a martini-like API with much better performance, up to 40 times faster thanks to <a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="external">httprouter</a>. If you need performance and good productivity, you will love Gin.</p>
<p><img src="https://gin-gonic.github.io/gin/other/console.png" alt="Gin console logger"></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ cat test.go</div></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"gopkg.in/gin-gonic/gin.v1"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	r := gin.Default()</div><div class="line">	r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</div><div class="line">			<span class="string">"message"</span>: <span class="string">"pong"</span>,</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">	r.Run() <span class="comment">// listen and serve on 0.0.0.0:8080</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Benchmarks"><a href="#Benchmarks" class="headerlink" title="Benchmarks"></a>Benchmarks</h2><p>Gin uses a custom version of <a href="https://github.com/julienschmidt/httprouter" target="_blank" rel="external">HttpRouter</a>  </p>
<p><a href="/BENCHMARKS.md">See all benchmarks</a></p>
<table>
<thead>
<tr>
<th>Benchmark name</th>
<th style="text-align:right">(1)</th>
<th style="text-align:right">(2)</th>
<th style="text-align:right">(3)</th>
<th style="text-align:right">(4)</th>
</tr>
</thead>
<tbody>
<tr>
<td>BenchmarkAce_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">109482</td>
<td style="text-align:right">13792</td>
<td style="text-align:right">167</td>
</tr>
<tr>
<td>BenchmarkBear_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">287490</td>
<td style="text-align:right">79952</td>
<td style="text-align:right">943</td>
</tr>
<tr>
<td>BenchmarkBeego_GithubAll</td>
<td style="text-align:right">3000</td>
<td style="text-align:right">562184</td>
<td style="text-align:right">146272</td>
<td style="text-align:right">2092</td>
</tr>
<tr>
<td>BenchmarkBone_GithubAll</td>
<td style="text-align:right">500</td>
<td style="text-align:right">2578716</td>
<td style="text-align:right">648016</td>
<td style="text-align:right">8119</td>
</tr>
<tr>
<td>BenchmarkDenco_GithubAll</td>
<td style="text-align:right">20000</td>
<td style="text-align:right">94955</td>
<td style="text-align:right">20224</td>
<td style="text-align:right">167</td>
</tr>
<tr>
<td>BenchmarkEcho_GithubAll</td>
<td style="text-align:right">30000</td>
<td style="text-align:right">58705</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
<tr>
<td><strong>BenchmarkGin_GithubAll</strong></td>
<td style="text-align:right"><strong>30000</strong></td>
<td style="text-align:right"><strong>50991</strong></td>
<td style="text-align:right"><strong>0</strong></td>
<td style="text-align:right"><strong>0</strong></td>
</tr>
<tr>
<td>BenchmarkGocraftWeb_GithubAll</td>
<td style="text-align:right">5000</td>
<td style="text-align:right">449648</td>
<td style="text-align:right">133280</td>
<td style="text-align:right">1889</td>
</tr>
<tr>
<td>BenchmarkGoji_GithubAll</td>
<td style="text-align:right">2000</td>
<td style="text-align:right">689748</td>
<td style="text-align:right">56113</td>
<td style="text-align:right">334</td>
</tr>
<tr>
<td>BenchmarkGoJsonRest_GithubAll</td>
<td style="text-align:right">5000</td>
<td style="text-align:right">537769</td>
<td style="text-align:right">135995</td>
<td style="text-align:right">2940</td>
</tr>
<tr>
<td>BenchmarkGoRestful_GithubAll</td>
<td style="text-align:right">100</td>
<td style="text-align:right">18410628</td>
<td style="text-align:right">797236</td>
<td style="text-align:right">7725</td>
</tr>
<tr>
<td>BenchmarkGorillaMux_GithubAll</td>
<td style="text-align:right">200</td>
<td style="text-align:right">8036360</td>
<td style="text-align:right">153137</td>
<td style="text-align:right">1791</td>
</tr>
<tr>
<td>BenchmarkHttpRouter_GithubAll</td>
<td style="text-align:right">20000</td>
<td style="text-align:right">63506</td>
<td style="text-align:right">13792</td>
<td style="text-align:right">167</td>
</tr>
<tr>
<td>BenchmarkHttpTreeMux_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">165927</td>
<td style="text-align:right">56112</td>
<td style="text-align:right">334</td>
</tr>
<tr>
<td>BenchmarkKocha_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">171362</td>
<td style="text-align:right">23304</td>
<td style="text-align:right">843</td>
</tr>
<tr>
<td>BenchmarkMacaron_GithubAll</td>
<td style="text-align:right">2000</td>
<td style="text-align:right">817008</td>
<td style="text-align:right">224960</td>
<td style="text-align:right">2315</td>
</tr>
<tr>
<td>BenchmarkMartini_GithubAll</td>
<td style="text-align:right">100</td>
<td style="text-align:right">12609209</td>
<td style="text-align:right">237952</td>
<td style="text-align:right">2686</td>
</tr>
<tr>
<td>BenchmarkPat_GithubAll</td>
<td style="text-align:right">300</td>
<td style="text-align:right">4830398</td>
<td style="text-align:right">1504101</td>
<td style="text-align:right">32222</td>
</tr>
<tr>
<td>BenchmarkPossum_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">301716</td>
<td style="text-align:right">97440</td>
<td style="text-align:right">812</td>
</tr>
<tr>
<td>BenchmarkR2router_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">270691</td>
<td style="text-align:right">77328</td>
<td style="text-align:right">1182</td>
</tr>
<tr>
<td>BenchmarkRevel_GithubAll</td>
<td style="text-align:right">1000</td>
<td style="text-align:right">1491919</td>
<td style="text-align:right">345553</td>
<td style="text-align:right">5918</td>
</tr>
<tr>
<td>BenchmarkRivet_GithubAll</td>
<td style="text-align:right">10000</td>
<td style="text-align:right">283860</td>
<td style="text-align:right">84272</td>
<td style="text-align:right">1079</td>
</tr>
<tr>
<td>BenchmarkTango_GithubAll</td>
<td style="text-align:right">5000</td>
<td style="text-align:right">473821</td>
<td style="text-align:right">87078</td>
<td style="text-align:right">2470</td>
</tr>
<tr>
<td>BenchmarkTigerTonic_GithubAll</td>
<td style="text-align:right">2000</td>
<td style="text-align:right">1120131</td>
<td style="text-align:right">241088</td>
<td style="text-align:right">6052</td>
</tr>
<tr>
<td>BenchmarkTraffic_GithubAll</td>
<td style="text-align:right">200</td>
<td style="text-align:right">8708979</td>
<td style="text-align:right">2664762</td>
<td style="text-align:right">22390</td>
</tr>
<tr>
<td>BenchmarkVulcan_GithubAll</td>
<td style="text-align:right">5000</td>
<td style="text-align:right">353392</td>
<td style="text-align:right">19894</td>
<td style="text-align:right">609</td>
</tr>
<tr>
<td>BenchmarkZeus_GithubAll</td>
<td style="text-align:right">2000</td>
<td style="text-align:right">944234</td>
<td style="text-align:right">300688</td>
<td style="text-align:right">2648</td>
</tr>
</tbody>
</table>
<p>(1): Total Repetitions<br>(2): Single Repetition Duration (ns/op)<br>(3): Heap Memory (B/op)<br>(4): Average Allocations per Repetition (allocs/op)  </p>
<h2 id="Gin-v1-stable"><a href="#Gin-v1-stable" class="headerlink" title="Gin v1. stable"></a>Gin v1. stable</h2><ul>
<li>[x] Zero allocation router.</li>
<li>[x] Still the fastest http router and framework. From routing to writing.</li>
<li>[x] Complete suite of unit tests</li>
<li>[x] Battle tested</li>
<li>[x] API frozen, new releases will not break your code.</li>
</ul>
<h2 id="Start-using-it"><a href="#Start-using-it" class="headerlink" title="Start using it"></a>Start using it</h2><ol>
<li><p>Download and install it:</p>
 <figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ go get gopkg.in/gin-gonic/gin.v1</div></pre></td></tr></table></figure>
</li>
<li><p>Import it in your code:</p>
 <figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"gopkg.in/gin-gonic/gin.v1"</span></div></pre></td></tr></table></figure>
</li>
<li><p>(Optional) Import <code>net/http</code>. This is required for example if using constants such as <code>http.StatusOK</code>.</p>
 <figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"net/http"</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="API-Examples"><a href="#API-Examples" class="headerlink" title="API Examples"></a>API Examples</h2><h4 id="Using-GET-POST-PUT-PATCH-DELETE-and-OPTIONS"><a href="#Using-GET-POST-PUT-PATCH-DELETE-and-OPTIONS" class="headerlink" title="Using GET, POST, PUT, PATCH, DELETE and OPTIONS"></a>Using GET, POST, PUT, PATCH, DELETE and OPTIONS</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">// Creates a gin router with default middleware:</span></div><div class="line">	<span class="comment">// logger and recovery (crash-free) middleware</span></div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	router.GET(<span class="string">"/someGet"</span>, getting)</div><div class="line">	router.POST(<span class="string">"/somePost"</span>, posting)</div><div class="line">	router.PUT(<span class="string">"/somePut"</span>, putting)</div><div class="line">	router.DELETE(<span class="string">"/someDelete"</span>, deleting)</div><div class="line">	router.PATCH(<span class="string">"/somePatch"</span>, patching)</div><div class="line">	router.HEAD(<span class="string">"/someHead"</span>, head)</div><div class="line">	router.OPTIONS(<span class="string">"/someOptions"</span>, options)</div><div class="line"></div><div class="line">	<span class="comment">// By default it serves on :8080 unless a</span></div><div class="line">	<span class="comment">// PORT environment variable was defined.</span></div><div class="line">	router.Run()</div><div class="line">	<span class="comment">// router.Run(":3000") for a hard coded port</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Parameters-in-path"><a href="#Parameters-in-path" class="headerlink" title="Parameters in path"></a>Parameters in path</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// This handler will match /user/john but will not match neither /user/ or /user</span></div><div class="line">	router.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		name := c.Param(<span class="string">"name"</span>)</div><div class="line">		c.String(http.StatusOK, <span class="string">"Hello %s"</span>, name)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// However, this one will match /user/john/ and also /user/john/send</span></div><div class="line">	<span class="comment">// If no other routers match /user/john, it will redirect to /user/john/</span></div><div class="line">	router.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		name := c.Param(<span class="string">"name"</span>)</div><div class="line">		action := c.Param(<span class="string">"action"</span>)</div><div class="line">		message := name + <span class="string">" is "</span> + action</div><div class="line">		c.String(http.StatusOK, message)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Querystring-parameters"><a href="#Querystring-parameters" class="headerlink" title="Querystring parameters"></a>Querystring parameters</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// Query string parameters are parsed using the existing underlying request object.</span></div><div class="line">	<span class="comment">// The request responds to a url matching:  /welcome?firstname=Jane&amp;lastname=Doe</span></div><div class="line">	router.GET(<span class="string">"/welcome"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</div><div class="line">		lastname := c.Query(<span class="string">"lastname"</span>) <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></div><div class="line"></div><div class="line">		c.String(http.StatusOK, <span class="string">"Hello %s %s"</span>, firstname, lastname)</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Multipart-Urlencoded-Form"><a href="#Multipart-Urlencoded-Form" class="headerlink" title="Multipart/Urlencoded Form"></a>Multipart/Urlencoded Form</h3><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	router.POST(<span class="string">"/form_post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		message := c.PostForm(<span class="string">"message"</span>)</div><div class="line">		nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</div><div class="line"></div><div class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</div><div class="line">			<span class="string">"status"</span>:  <span class="string">"posted"</span>,</div><div class="line">			<span class="string">"message"</span>: message,</div><div class="line">			<span class="string">"nick"</span>:    nick,</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Another-example-query-post-form"><a href="#Another-example-query-post-form" class="headerlink" title="Another example: query + post form"></a>Another example: query + post form</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">POST /post?id=1234&amp;page=1 HTTP/1.1</div><div class="line">Content-Type: application/x-www-form-urlencoded</div><div class="line"></div><div class="line">name=manu&amp;message=this_is_great</div></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	router.POST(<span class="string">"/post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line"></div><div class="line">		id := c.Query(<span class="string">"id"</span>)</div><div class="line">		page := c.DefaultQuery(<span class="string">"page"</span>, <span class="string">"0"</span>)</div><div class="line">		name := c.PostForm(<span class="string">"name"</span>)</div><div class="line">		message := c.PostForm(<span class="string">"message"</span>)</div><div class="line"></div><div class="line">		fmt.Printf(<span class="string">"id: %s; page: %s; name: %s; message: %s"</span>, id, page, name, message)</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">id: 1234; page: 1; name: manu; message: this_is_great</div></pre></td></tr></table></figure>
<h3 id="Another-example-upload-file"><a href="#Another-example-upload-file" class="headerlink" title="Another example: upload file"></a>Another example: upload file</h3><p>References issue <a href="https://github.com/gin-gonic/gin/issues/548" target="_blank" rel="external">#548</a>.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	router.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line"></div><div class="line">	        file, header , err := c.Request.FormFile(<span class="string">"upload"</span>)</div><div class="line">	        filename := header.Filename</div><div class="line">	        fmt.Println(header.Filename)</div><div class="line">	        out, err := os.Create(<span class="string">"./tmp/"</span>+filename+<span class="string">".png"</span>)</div><div class="line">	        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">	            log.Fatal(err)</div><div class="line">	        &#125;</div><div class="line">	        <span class="keyword">defer</span> out.Close()</div><div class="line">	        _, err = io.Copy(out, file)</div><div class="line">	        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">	            log.Fatal(err)</div><div class="line">	        &#125;   </div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Grouping-routes"><a href="#Grouping-routes" class="headerlink" title="Grouping routes"></a>Grouping routes</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// Simple group: v1</span></div><div class="line">	v1 := router.Group(<span class="string">"/v1"</span>)</div><div class="line">	&#123;</div><div class="line">		v1.POST(<span class="string">"/login"</span>, loginEndpoint)</div><div class="line">		v1.POST(<span class="string">"/submit"</span>, submitEndpoint)</div><div class="line">		v1.POST(<span class="string">"/read"</span>, readEndpoint)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Simple group: v2</span></div><div class="line">	v2 := router.Group(<span class="string">"/v2"</span>)</div><div class="line">	&#123;</div><div class="line">		v2.POST(<span class="string">"/login"</span>, loginEndpoint)</div><div class="line">		v2.POST(<span class="string">"/submit"</span>, submitEndpoint)</div><div class="line">		v2.POST(<span class="string">"/read"</span>, readEndpoint)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Blank-Gin-without-middleware-by-default"><a href="#Blank-Gin-without-middleware-by-default" class="headerlink" title="Blank Gin without middleware by default"></a>Blank Gin without middleware by default</h4><p>Use</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">r := gin.New()</div></pre></td></tr></table></figure>
<p>instead of</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">r := gin.Default()</div></pre></td></tr></table></figure>
<h4 id="Using-middleware"><a href="#Using-middleware" class="headerlink" title="Using middleware"></a>Using middleware</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">// Creates a router without any middleware by default</span></div><div class="line">	r := gin.New()</div><div class="line"></div><div class="line">	<span class="comment">// Global middleware</span></div><div class="line">	r.Use(gin.Logger())</div><div class="line">	r.Use(gin.Recovery())</div><div class="line"></div><div class="line">	<span class="comment">// Per route middleware, you can add as many as you desire.</span></div><div class="line">	r.GET(<span class="string">"/benchmark"</span>, MyBenchLogger(), benchEndpoint)</div><div class="line"></div><div class="line">	<span class="comment">// Authorization group</span></div><div class="line">	<span class="comment">// authorized := r.Group("/", AuthRequired())</span></div><div class="line">	<span class="comment">// exactly the same as:</span></div><div class="line">	authorized := r.Group(<span class="string">"/"</span>)</div><div class="line">	<span class="comment">// per group middleware! in this case we use the custom created</span></div><div class="line">	<span class="comment">// AuthRequired() middleware just in the "authorized" group.</span></div><div class="line">	authorized.Use(AuthRequired())</div><div class="line">	&#123;</div><div class="line">		authorized.POST(<span class="string">"/login"</span>, loginEndpoint)</div><div class="line">		authorized.POST(<span class="string">"/submit"</span>, submitEndpoint)</div><div class="line">		authorized.POST(<span class="string">"/read"</span>, readEndpoint)</div><div class="line"></div><div class="line">		<span class="comment">// nested group</span></div><div class="line">		testing := authorized.Group(<span class="string">"testing"</span>)</div><div class="line">		testing.GET(<span class="string">"/analytics"</span>, analyticsEndpoint)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	r.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="middleware-中间件-使用"><a href="#middleware-中间件-使用" class="headerlink" title="middleware(中间件)使用"></a>middleware(中间件)使用</h4><p>定义中间件<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// </span></div><div class="line"><span class="keyword">package</span> middleware</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"github.com/gin-gonic/gin"</span></div><div class="line">	<span class="string">"blog_api/models/m_user"</span></div><div class="line">	<span class="string">"log"</span></div><div class="line">	<span class="string">"blog_api/lib/response"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">AuthRequire</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">	accessToken := c.Request.Header.Get(<span class="string">"Authorization"</span>)</div><div class="line">	<span class="keyword">if</span> m_user.IsLogin(accessToken) == <span class="literal">false</span> &#123;</div><div class="line">		c.String(<span class="number">401</span>, <span class="string">"未登录或登录已过期, 请重新登录"</span>)</div><div class="line">		c.Abort()</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">// 延长token过期时间</span></div><div class="line">		err := m_user.DeferToken(accessToken)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			log.Println(<span class="string">"延长过期失败, 原因:"</span> + err.Error())</div><div class="line">			response.Error(<span class="string">"延长过期失败, 原因:"</span>+err.Error(), c, <span class="literal">nil</span>)</div><div class="line">			c.Abort()</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用中间件<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"blog_api/controller"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"github.com/gin-gonic/gin"</span></div><div class="line">	<span class="string">"blog_api/middleware"</span></div><div class="line">)</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	... ...</div><div class="line">	auth := router.Group(<span class="string">"/"</span>)</div><div class="line">	auth.Use(middleware.AuthRequire)</div><div class="line">	&#123;</div><div class="line">		auth.GET(<span class="string">"users"</span>, controller.GetUsers)</div><div class="line">	&#125;</div><div class="line">	router.Run(<span class="string">":9004"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Model-binding-and-validation"><a href="#Model-binding-and-validation" class="headerlink" title="Model binding and validation"></a>Model binding and validation</h4><p>To bind a request body into a type, use model binding. We currently support binding of JSON, XML and standard form values (foo=bar&amp;boo=baz).</p>
<p>Note that you need to set the corresponding binding tag on all fields you want to bind. For example, when binding from JSON, set <code>json:&quot;fieldname&quot;</code>.</p>
<p>When using the Bind-method, Gin tries to infer the binder depending on the Content-Type header. If you are sure what you are binding, you can use BindWith.</p>
<p>You can also specify that specific fields are required. If a field is decorated with <code>binding:&quot;required&quot;</code> and has a empty value when binding, the current request will fail with an error.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Binding from JSON</span></div><div class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</div><div class="line">	User     <span class="keyword">string</span> <span class="string">`form:"user" json:"user" binding:"required"`</span></div><div class="line">	Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" binding:"required"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// Example for binding JSON (&#123;"user": "manu", "password": "123"&#125;)</span></div><div class="line">	router.POST(<span class="string">"/loginJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="keyword">var</span> json Login</div><div class="line">		<span class="keyword">if</span> c.BindJSON(&amp;json) == <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">if</span> json.User == <span class="string">"manu"</span> &amp;&amp; json.Password == <span class="string">"123"</span> &#123;</div><div class="line">				c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Example for binding a HTML form (user=manu&amp;password=123)</span></div><div class="line">	router.POST(<span class="string">"/loginForm"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="keyword">var</span> form Login</div><div class="line">		<span class="comment">// This will infer what binder to use depending on the content-type header.</span></div><div class="line">		<span class="keyword">if</span> c.Bind(&amp;form) == <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">if</span> form.User == <span class="string">"manu"</span> &amp;&amp; form.Password == <span class="string">"123"</span> &#123;</div><div class="line">				c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###Multipart/Urlencoded binding<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"gopkg.in/gin-gonic/gin.v1"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> LoginForm <span class="keyword">struct</span> &#123;</div><div class="line">	User     <span class="keyword">string</span> <span class="string">`form:"user" binding:"required"`</span></div><div class="line">	Password <span class="keyword">string</span> <span class="string">`form:"password" binding:"required"`</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	router.POST(<span class="string">"/login"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="comment">// you can bind multipart form with explicit binding declaration:</span></div><div class="line">		<span class="comment">// c.BindWith(&amp;form, binding.Form)</span></div><div class="line">		<span class="comment">// or you can simply use autobinding with Bind method:</span></div><div class="line">		<span class="keyword">var</span> form LoginForm</div><div class="line">		<span class="comment">// in this case proper binding will be automatically selected</span></div><div class="line">		<span class="keyword">if</span> c.Bind(&amp;form) == <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">if</span> form.User == <span class="string">"user"</span> &amp;&amp; form.Password == <span class="string">"password"</span> &#123;</div><div class="line">				c.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				c.JSON(<span class="number">401</span>, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Test it with:<br><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">$ curl -v --form user=user --form password=password http://localhost:8080/login</div></pre></td></tr></table></figure></p>
<h4 id="XML-JSON-and-YAML-rendering"><a href="#XML-JSON-and-YAML-rendering" class="headerlink" title="XML, JSON and YAML rendering"></a>XML, JSON and YAML rendering</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	r := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// gin.H is a shortcut for map[string]interface&#123;&#125;</span></div><div class="line">	r.GET(<span class="string">"/someJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.JSON(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/moreJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="comment">// You also can use a struct</span></div><div class="line">		<span class="keyword">var</span> msg <span class="keyword">struct</span> &#123;</div><div class="line">			Name    <span class="keyword">string</span> <span class="string">`json:"user"`</span></div><div class="line">			Message <span class="keyword">string</span></div><div class="line">			Number  <span class="keyword">int</span></div><div class="line">		&#125;</div><div class="line">		msg.Name = <span class="string">"Lena"</span></div><div class="line">		msg.Message = <span class="string">"hey"</span></div><div class="line">		msg.Number = <span class="number">123</span></div><div class="line">		<span class="comment">// Note that msg.Name becomes "user" in the JSON</span></div><div class="line">		<span class="comment">// Will output  :   &#123;"user": "Lena", "Message": "hey", "Number": 123&#125;</span></div><div class="line">		c.JSON(http.StatusOK, msg)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/someXML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.XML(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/someYAML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.YAML(http.StatusOK, gin.H&#123;<span class="string">"message"</span>: <span class="string">"hey"</span>, <span class="string">"status"</span>: http.StatusOK&#125;)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	r.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Serving-static-files"><a href="#Serving-static-files" class="headerlink" title="Serving static files"></a>Serving static files</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	router.Static(<span class="string">"/assets"</span>, <span class="string">"./assets"</span>)</div><div class="line">	router.StaticFS(<span class="string">"/more_static"</span>, http.Dir(<span class="string">"my_file_system"</span>))</div><div class="line">	router.StaticFile(<span class="string">"/favicon.ico"</span>, <span class="string">"./resources/favicon.ico"</span>)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="HTML-rendering"><a href="#HTML-rendering" class="headerlink" title="HTML rendering"></a>HTML rendering</h4><p>Using LoadHTMLTemplates()</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	router.LoadHTMLGlob(<span class="string">"templates/*"</span>)</div><div class="line">	<span class="comment">//router.LoadHTMLFiles("templates/template1.html", "templates/template2.html")</span></div><div class="line">	router.GET(<span class="string">"/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.HTML(http.StatusOK, <span class="string">"index.tmpl"</span>, gin.H&#123;</div><div class="line">			<span class="string">"title"</span>: <span class="string">"Main website"</span>,</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>templates/index.tmpl<br><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span></div><div class="line">		&#123;&#123; .title &#125;&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Using templates with same name in different directories</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	router.LoadHTMLGlob(<span class="string">"templates/**/*"</span>)</div><div class="line">	router.GET(<span class="string">"/posts/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.HTML(http.StatusOK, <span class="string">"posts/index.tmpl"</span>, gin.H&#123;</div><div class="line">			<span class="string">"title"</span>: <span class="string">"Posts"</span>,</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">	router.GET(<span class="string">"/users/index"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		c.HTML(http.StatusOK, <span class="string">"users/index.tmpl"</span>, gin.H&#123;</div><div class="line">			<span class="string">"title"</span>: <span class="string">"Users"</span>,</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>templates/posts/index.tmpl<br><figure class="highlight html"><table><tr><td class="code"><pre><div class="line">&#123;&#123; define "posts/index.tmpl" &#125;&#125;</div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span></div><div class="line">	&#123;&#123; .title &#125;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using posts/index.tmpl<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line">&#123;&#123; end &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>templates/users/index.tmpl<br><figure class="highlight html"><table><tr><td class="code"><pre><div class="line">&#123;&#123; define "users/index.tmpl" &#125;&#125;</div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span></div><div class="line">	&#123;&#123; .title &#125;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using users/index.tmpl<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line">&#123;&#123; end &#125;&#125;</div></pre></td></tr></table></figure></p>
<p>You can also use your own html template render</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"html/template"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	html := template.Must(template.ParseFiles(<span class="string">"file1"</span>, <span class="string">"file2"</span>))</div><div class="line">	router.SetHTMLTemplate(html)</div><div class="line">	router.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Redirects"><a href="#Redirects" class="headerlink" title="Redirects"></a>Redirects</h4><p>Issuing a HTTP redirect is easy:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">r.GET(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">	c.Redirect(http.StatusMovedPermanently, <span class="string">"http://www.google.com/"</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Both internal and external locations are supported.</p>
<h4 id="Custom-Middleware"><a href="#Custom-Middleware" class="headerlink" title="Custom Middleware"></a>Custom Middleware</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Logger</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		t := time.Now()</div><div class="line"></div><div class="line">		<span class="comment">// Set example variable</span></div><div class="line">		c.Set(<span class="string">"example"</span>, <span class="string">"12345"</span>)</div><div class="line"></div><div class="line">		<span class="comment">// before request</span></div><div class="line"></div><div class="line">		c.Next()</div><div class="line"></div><div class="line">		<span class="comment">// after request</span></div><div class="line">		latency := time.Since(t)</div><div class="line">		log.Print(latency)</div><div class="line"></div><div class="line">		<span class="comment">// access the status we are sending</span></div><div class="line">		status := c.Writer.Status()</div><div class="line">		log.Println(status)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	r := gin.New()</div><div class="line">	r.Use(Logger())</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/test"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		example := c.MustGet(<span class="string">"example"</span>).(<span class="keyword">string</span>)</div><div class="line"></div><div class="line">		<span class="comment">// it would print: "12345"</span></div><div class="line">		log.Println(example)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	r.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Using-BasicAuth-middleware"><a href="#Using-BasicAuth-middleware" class="headerlink" title="Using BasicAuth() middleware"></a>Using BasicAuth() middleware</h4><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// simulate some private data</span></div><div class="line"><span class="keyword">var</span> secrets = gin.H&#123;</div><div class="line">	<span class="string">"foo"</span>:    gin.H&#123;<span class="string">"email"</span>: <span class="string">"foo@bar.com"</span>, <span class="string">"phone"</span>: <span class="string">"123433"</span>&#125;,</div><div class="line">	<span class="string">"austin"</span>: gin.H&#123;<span class="string">"email"</span>: <span class="string">"austin@example.com"</span>, <span class="string">"phone"</span>: <span class="string">"666"</span>&#125;,</div><div class="line">	<span class="string">"lena"</span>:   gin.H&#123;<span class="string">"email"</span>: <span class="string">"lena@guapa.com"</span>, <span class="string">"phone"</span>: <span class="string">"523443"</span>&#125;,</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	r := gin.Default()</div><div class="line"></div><div class="line">	<span class="comment">// Group using gin.BasicAuth() middleware</span></div><div class="line">	<span class="comment">// gin.Accounts is a shortcut for map[string]string</span></div><div class="line">	authorized := r.Group(<span class="string">"/admin"</span>, gin.BasicAuth(gin.Accounts&#123;</div><div class="line">		<span class="string">"foo"</span>:    <span class="string">"bar"</span>,</div><div class="line">		<span class="string">"austin"</span>: <span class="string">"1234"</span>,</div><div class="line">		<span class="string">"lena"</span>:   <span class="string">"hello2"</span>,</div><div class="line">		<span class="string">"manu"</span>:   <span class="string">"4321"</span>,</div><div class="line">	&#125;))</div><div class="line"></div><div class="line">	<span class="comment">// /admin/secrets endpoint</span></div><div class="line">	<span class="comment">// hit "localhost:8080/admin/secrets</span></div><div class="line">	authorized.GET(<span class="string">"/secrets"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="comment">// get user, it was set by the BasicAuth middleware</span></div><div class="line">		user := c.MustGet(gin.AuthUserKey).(<span class="keyword">string</span>)</div><div class="line">		<span class="keyword">if</span> secret, ok := secrets[user]; ok &#123;</div><div class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">"user"</span>: user, <span class="string">"secret"</span>: secret&#125;)</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">"user"</span>: user, <span class="string">"secret"</span>: <span class="string">"NO SECRET :("</span>&#125;)</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	r.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Goroutines-inside-a-middleware"><a href="#Goroutines-inside-a-middleware" class="headerlink" title="Goroutines inside a middleware"></a>Goroutines inside a middleware</h4><p>When starting inside a middleware or handler, you <strong>SHOULD NOT</strong> use the original context inside it, you have to use a read-only copy.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	r := gin.Default()</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/long_async"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="comment">// create copy to be used inside the goroutine</span></div><div class="line">		cCp := c.Copy()</div><div class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">			<span class="comment">// simulate a long task with time.Sleep(). 5 seconds</span></div><div class="line">			time.Sleep(<span class="number">5</span> * time.Second)</div><div class="line"></div><div class="line">			<span class="comment">// note that you are using the copied context "cCp", IMPORTANT</span></div><div class="line">			log.Println(<span class="string">"Done! in path "</span> + cCp.Request.URL.Path)</div><div class="line">		&#125;()</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	r.GET(<span class="string">"/long_sync"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</div><div class="line">		<span class="comment">// simulate a long task with time.Sleep(). 5 seconds</span></div><div class="line">		time.Sleep(<span class="number">5</span> * time.Second)</div><div class="line"></div><div class="line">		<span class="comment">// since we are NOT using a goroutine, we do not have to copy the context</span></div><div class="line">		log.Println(<span class="string">"Done! in path "</span> + c.Request.URL.Path)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">// Listen and serve on 0.0.0.0:8080</span></div><div class="line">	r.Run(<span class="string">":8080"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Custom-HTTP-configuration"><a href="#Custom-HTTP-configuration" class="headerlink" title="Custom HTTP configuration"></a>Custom HTTP configuration</h4><p>Use <code>http.ListenAndServe()</code> directly, like this:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line">	http.ListenAndServe(<span class="string">":8080"</span>, router)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	router := gin.Default()</div><div class="line"></div><div class="line">	s := &amp;http.Server&#123;</div><div class="line">		Addr:           <span class="string">":8080"</span>,</div><div class="line">		Handler:        router,</div><div class="line">		ReadTimeout:    <span class="number">10</span> * time.Second,</div><div class="line">		WriteTimeout:   <span class="number">10</span> * time.Second,</div><div class="line">		MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</div><div class="line">	&#125;</div><div class="line">	s.ListenAndServe()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Graceful-restart-or-stop"><a href="#Graceful-restart-or-stop" class="headerlink" title="Graceful restart or stop"></a>Graceful restart or stop</h4><p>Do you want to graceful restart or stop your web server?<br>There are some ways this can be done.</p>
<p>We can use <a href="https://github.com/fvbock/endless" target="_blank" rel="external">fvbock/endless</a> to replace the default <code>ListenAndServe</code>. Refer issue <a href="https://github.com/gin-gonic/gin/issues/296" target="_blank" rel="external">#296</a> for more details.</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">router := gin.Default()</div><div class="line">router.GET(<span class="string">"/"</span>, handler)</div><div class="line"><span class="comment">// [...]</span></div><div class="line">endless.ListenAndServe(<span class="string">":4242"</span>, router)</div></pre></td></tr></table></figure>
<p>An alternative to endless:</p>
<ul>
<li><a href="https://github.com/braintree/manners" target="_blank" rel="external">manners</a>: A polite Go HTTP server that shuts down gracefully.<h3 id="获取header头信息"><a href="#获取header头信息" class="headerlink" title="获取header头信息"></a>获取header头信息</h3><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 如果只是Request.Header,返回一个slice, 如果跟上Get方法,则能方便的找到某一项的值</span></div><div class="line">accessToken := c.Request.Header.Get(<span class="string">"Authorization"</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Contributing"><a href="#Contributing" class="headerlink" title="Contributing"></a>Contributing</h2><ul>
<li>With issues:<ul>
<li>Use the search tool before opening a new issue.</li>
<li>Please provide source code and commit sha if you found a bug.</li>
<li>Review existing issues and provide feedback or react to them.</li>
</ul>
</li>
<li>With pull requests:<ul>
<li>Open your pull request against develop</li>
<li>Your pull request should have no more than two commits, if not you should squash them.</li>
<li>It should pass all tests in the available continuous integrations systems such as TravisCI.</li>
<li>You should add/modify tests to cover your proposed code changes.</li>
<li>If your pull request contains a new feature, please document it on the README.</li>
</ul>
</li>
</ul>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>Awesome project lists using <a href="https://github.com/gin-gonic/gin" target="_blank" rel="external">Gin</a> web framework.</p>
<ul>
<li><a href="https://github.com/drone/drone" target="_blank" rel="external">drone</a>: Drone is a Continuous Delivery platform built on Docker, written in Go</li>
<li><a href="https://github.com/appleboy/gorush" target="_blank" rel="external">gorush</a>: A push notification server written in Go.</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/读取配置文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/读取配置文件/" itemprop="url">
                  读取配置文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T00:00:29+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用json格式"><a href="#使用json格式" class="headerlink" title="使用json格式"></a>使用json格式</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> config</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"log"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> mysql <span class="keyword">struct</span> &#123;</div><div class="line">	Host <span class="keyword">string</span></div><div class="line">	Port <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Data mysql</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 判断是为了实现单例的效果</span></div><div class="line">	<span class="keyword">if</span> Data.Port == <span class="number">0</span> &#123;</div><div class="line">	    <span class="comment">// 当前目录应该为main.go的目录</span></div><div class="line">		str, err := ioutil.ReadFile(<span class="string">"./config/database.json"</span>)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"err: 读取json配置失败"</span> + err.Error())</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> err = json.Unmarshal(str, &amp;Data); err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"err: 解析json配置失败"</span> + err.Error())</div><div class="line">		&#125;</div><div class="line">		log.Println(<span class="string">"读取配置文件成功"</span>)</div><div class="line">	&#125;</div><div class="line">	log.Println(<span class="string">"执行init函数 配置文件"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/发邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/发邮件/" itemprop="url">
                  发邮件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:59:18+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="邮件的一般格式"><a href="#邮件的一般格式" class="headerlink" title="邮件的一般格式"></a>邮件的一般格式</h1><figure class="highlight html"><table><tr><td class="code"><pre><div class="line">From:chimps@example.com</div><div class="line">To:to@163.com</div><div class="line">Subject:TEST EMAIL</div><div class="line">Content-Type: text/html; chatset=UTF-8</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello go<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="使用阿里云企业邮注意事项"><a href="#使用阿里云企业邮注意事项" class="headerlink" title="使用阿里云企业邮注意事项"></a>使用阿里云企业邮注意事项</h1><p>如果你的域名为example.com<br>在阿里的域名那里都配好之后，发邮件的配置应该如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">HOST: smtp.example.com</div><div class="line">HOST_ADDR: smtp.example.com:25</div><div class="line">USER: 该企业邮箱所创建的子邮箱</div><div class="line">PASSWORD：user的password</div></pre></td></tr></table></figure></p>
<h1 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h1><p>主要是使用net/smtp包的<code>SendMail</code>方法<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"net/smtp"</span></div><div class="line">	<span class="string">"strings"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> (</div><div class="line">	HOST     = <span class="string">"smtp.example.com"</span></div><div class="line">	ADDR     = <span class="string">"smtp.example.com:25"</span></div><div class="line">	USER     = <span class="string">"chimps@example.com"</span></div><div class="line">	PASSWORD = <span class="string">"xxx"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	to := <span class="string">"to1@163.com;to1@163.com"</span></div><div class="line">	subject := <span class="string">"TEST EMAIL"</span></div><div class="line">	email_type := <span class="string">"html"</span></div><div class="line">	message := <span class="string">"&lt;h1&gt;hello go&lt;/h1&gt;"</span></div><div class="line">	<span class="keyword">if</span> err := SendEmail(to, subject, email_type, message); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"发送失败, reason:"</span> + err.Error())</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendEmail</span><span class="params">(to <span class="keyword">string</span>, subject <span class="keyword">string</span>, email_type <span class="keyword">string</span>, message <span class="keyword">string</span>)</span> <span class="params">(err error)</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> content_type <span class="keyword">string</span></div><div class="line">	<span class="keyword">switch</span> email_type &#123;</div><div class="line">	<span class="keyword">case</span> <span class="string">"html"</span>:</div><div class="line">		content_type = <span class="string">"Content-Type: text/html; chatset=UTF-8"</span></div><div class="line">	<span class="keyword">case</span> <span class="string">"text"</span>:</div><div class="line">		content_type = <span class="string">"Content-Type: text/plain; chatset=UTF-8"</span></div><div class="line">	&#125;</div><div class="line">	auth := smtp.PlainAuth(<span class="string">""</span>, USER, PASSWORD, HOST)</div><div class="line">	send_to := strings.Split(to, <span class="string">";"</span>)</div><div class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> send_to &#123;</div><div class="line">		<span class="keyword">var</span> msg []<span class="keyword">string</span></div><div class="line">		msg = <span class="built_in">append</span>(msg, <span class="string">"From:"</span>+USER, <span class="string">"To:"</span>+v, <span class="string">"Subject:"</span>+subject, content_type, <span class="string">"\r\n"</span>+message)</div><div class="line">		msg_string := strings.Join(msg, <span class="string">"\r\n"</span>)</div><div class="line">		fmt.Println(msg_string)</div><div class="line"></div><div class="line">		<span class="keyword">if</span> err = smtp.SendMail(ADDR, auth, USER, []<span class="keyword">string</span>&#123;v&#125;, []<span class="keyword">byte</span>(msg_string)); err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"send fail , reason: "</span> + err.Error())</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"send ok :"</span> + v)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h1><p>一般情况下，发邮件时间比较耗时的事情，所以一般使用go的协程，通过channel通讯</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/正则表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/正则表达式/" itemprop="url">
                  正则表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:56:45+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><h2 id="单一："><a href="#单一：" class="headerlink" title="单一："></a>单一：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">.                   匹配任意一个字符，如果设置 s = true，则可以匹配换行符</div><div class="line"></div><div class="line">[字符类]            匹配“字符类”中的一个字符，“字符类”见后面的说明</div><div class="line">[^字符类]           匹配“字符类”外的一个字符，“字符类”见后面的说明</div><div class="line"></div><div class="line">\小写Perl标记       匹配“Perl类”中的一个字符，“Perl类”见后面的说明</div><div class="line">\大写Perl标记       匹配“Perl类”外的一个字符，“Perl类”见后面的说明</div><div class="line"></div><div class="line">[:ASCII类名:]       匹配“ASCII类”中的一个字符，“ASCII类”见后面的说明</div><div class="line">[:^ASCII类名:]      匹配“ASCII类”外的一个字符，“ASCII类”见后面的说明</div><div class="line"></div><div class="line">\pUnicode普通类名   匹配“Unicode类”中的一个字符(仅普通类)，“Unicode类”见后面的说明</div><div class="line">\PUnicode普通类名   匹配“Unicode类”外的一个字符(仅普通类)，“Unicode类”见后面的说明</div><div class="line"></div><div class="line">\p&#123;Unicode类名&#125;     匹配“Unicode类”中的一个字符，“Unicode类”见后面的说明</div><div class="line">\P&#123;Unicode类名&#125;     匹配“Unicode类”外的一个字符，“Unicode类”见后面的说明</div></pre></td></tr></table></figure>
<h2 id="复合"><a href="#复合" class="headerlink" title="复合"></a>复合</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">xy             匹配 xy（x 后面跟随 y）</div><div class="line">x|y            匹配 x 或 y (优先匹配 x)</div></pre></td></tr></table></figure>
<h2 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">x*             匹配零个或多个 x，优先匹配更多(贪婪)</div><div class="line">x+             匹配一个或多个 x，优先匹配更多(贪婪)</div><div class="line">x?             匹配零个或一个 x，优先匹配一个(贪婪)</div><div class="line">x&#123;n,m&#125;         匹配 n 到 m 个 x，优先匹配更多(贪婪)</div><div class="line">x&#123;n,&#125;          匹配 n 个或多个 x，优先匹配更多(贪婪)</div><div class="line">x&#123;n&#125;           只匹配 n 个 x</div><div class="line">x*?            匹配零个或多个 x，优先匹配更少(非贪婪)</div><div class="line">x+?            匹配一个或多个 x，优先匹配更少(非贪婪)</div><div class="line">x??            匹配零个或一个 x，优先匹配零个(非贪婪)</div><div class="line">x&#123;n,m&#125;?        匹配 n 到 m 个 x，优先匹配更少(非贪婪)</div><div class="line">x&#123;n,&#125;?         匹配 n 个或多个 x，优先匹配更少(非贪婪)</div><div class="line">x&#123;n&#125;?          只匹配 n 个 x</div></pre></td></tr></table></figure>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">(子表达式)            被捕获的组，该组被编号 (子匹配)</div><div class="line">(?P&lt;命名&gt;子表达式)    被捕获的组，该组被编号且被命名 (子匹配)</div><div class="line">(?:子表达式)          非捕获的组 (子匹配)</div><div class="line">(?标记)               在组内设置标记，非捕获，标记影响当前组后的正则表达式</div><div class="line">(?标记:子表达式)      在组内设置标记，非捕获，标记影响当前组内的子表达式</div><div class="line"></div><div class="line">标记的语法是：</div><div class="line">xyz  (设置 xyz 标记)</div><div class="line">-xyz (清除 xyz 标记)</div><div class="line">xy-z (设置 xy 标记, 清除 z 标记)</div><div class="line"></div><div class="line">可以设置的标记有：</div><div class="line">i              不区分大小写 (默认为 false)</div><div class="line">m              多行模式：让 ^ 和 $ 匹配整个文本的开头和结尾，而非行首和行尾(默认为 false)</div><div class="line">s              让 . 匹配 \n (默认为 false)</div><div class="line">U              非贪婪模式：交换 x* 和 x*? 等的含义 (默认为 false)</div></pre></td></tr></table></figure>
<h2 id="位置标记："><a href="#位置标记：" class="headerlink" title="位置标记："></a>位置标记：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">^              如果标记 m=true 则匹配行首，否则匹配整个文本的开头（m 默认为 false）</div><div class="line">$              如果标记 m=true 则匹配行尾，否则匹配整个文本的结尾（m 默认为 false）</div><div class="line">\A             匹配整个文本的开头，忽略 m 标记</div><div class="line">\b             匹配单词边界</div><div class="line">\B             匹配非单词边界</div><div class="line">\z             匹配整个文本的结尾，忽略 m 标记</div></pre></td></tr></table></figure>
<h2 id="转序标记"><a href="#转序标记" class="headerlink" title="转序标记"></a>转序标记</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">\a             匹配响铃符    （相当于 \x07）</div><div class="line">               注意：正则表达式中不能使用 \b 匹配退格符，因为 \b 被用来匹配单词边界，</div><div class="line">               可以使用 \x08 表示退格符。</div><div class="line">\f             匹配换页符    （相当于 \x0C）</div><div class="line">\t             匹配横向制表符（相当于 \x09）</div><div class="line">\n             匹配换行符    （相当于 \x0A）</div><div class="line">\r             匹配回车符    （相当于 \x0D）</div><div class="line">\v             匹配纵向制表符（相当于 \x0B）</div><div class="line">\123           匹配 8  進制编码所代表的字符（必须是 3 位数字）</div><div class="line">\x7F           匹配 16 進制编码所代表的字符（必须是 3 位数字）</div><div class="line">\x&#123;10FFFF&#125;     匹配 16 進制编码所代表的字符（最大值 10FFFF  ）</div><div class="line">\Q...\E        匹配 \Q 和 \E 之间的文本，忽略文本中的正则语法</div><div class="line"></div><div class="line">\\             匹配字符 \</div><div class="line">\^             匹配字符 ^</div><div class="line">\$             匹配字符 $</div><div class="line">\.             匹配字符 .</div><div class="line">\*             匹配字符 *</div><div class="line">\+             匹配字符 +</div><div class="line">\?             匹配字符 ?</div><div class="line">\&#123;             匹配字符 &#123;</div><div class="line">\&#125;             匹配字符 &#125;</div><div class="line">\(             匹配字符 (</div><div class="line">\)             匹配字符 )</div><div class="line">\[             匹配字符 [</div><div class="line">\]             匹配字符 ]</div><div class="line">\|             匹配字符 |</div></pre></td></tr></table></figure>
<h2 id="可以将“命名字符类”作为“字符类”的元素："><a href="#可以将“命名字符类”作为“字符类”的元素：" class="headerlink" title="可以将“命名字符类”作为“字符类”的元素："></a>可以将“命名字符类”作为“字符类”的元素：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[\d]           匹配数字 (相当于 \d)</div><div class="line">[^\d]          匹配非数字 (相当于 \D)</div><div class="line">[\D]           匹配非数字 (相当于 \D)</div><div class="line">[^\D]          匹配数字 (相当于 \d)</div><div class="line">[[:name:]]     命名的“ASCII 类”包含在“字符类”中 (相当于 [:name:])</div><div class="line">[^[:name:]]    命名的“ASCII 类”不包含在“字符类”中 (相当于 [:^name:])</div><div class="line">[\p&#123;Name&#125;]     命名的“Unicode 类”包含在“字符类”中 (相当于 \p&#123;Name&#125;)</div><div class="line">[^\p&#123;Name&#125;]    命名的“Unicode 类”不包含在“字符类”中 (相当于 \P&#123;Name&#125;)</div></pre></td></tr></table></figure>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p><code>字符类</code>取值如下（<code>字符类</code>包含<code>Perl类</code>、<code>ASCII类</code>、<code>Unicode类</code>）： x 单个字符 A-Z 字符范围(包含首尾字符) \小写字母 Perl类 [:ASCII类名:] ASCII类 \p{Unicode脚本类名} Unicode类 (脚本类) \pUnicode普通类名 Unicode类 (普通类)</p>
<h2 id="“Perl-类”取值如下："><a href="#“Perl-类”取值如下：" class="headerlink" title="“Perl 类”取值如下："></a>“Perl 类”取值如下：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">\d             数字 (相当于 [0-9])</div><div class="line">\D             非数字 (相当于 [^0-9])</div><div class="line">\s             空白 (相当于 [\t\n\f\r ])</div><div class="line">\S             非空白 (相当于[^\t\n\f\r ])</div><div class="line">\w             单词字符 (相当于 [0-9A-Za-z_])</div><div class="line">\W             非单词字符 (相当于 [^0-9A-Za-z_])</div></pre></td></tr></table></figure>
<h2 id="“ASCII-类”取值如下"><a href="#“ASCII-类”取值如下" class="headerlink" title="“ASCII 类”取值如下"></a>“ASCII 类”取值如下</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[:alnum:]      字母数字 (相当于 [0-9A-Za-z])</div><div class="line">[:alpha:]      字母 (相当于 [A-Za-z])</div><div class="line">[:ascii:]      ASCII 字符集 (相当于 [\x00-\x7F])</div><div class="line">[:blank:]      空白占位符 (相当于 [\t ])</div><div class="line">[:cntrl:]      控制字符 (相当于 [\x00-\x1F\x7F])</div><div class="line">[:digit:]      数字 (相当于 [0-9])</div><div class="line">[:graph:]      图形字符 (相当于 [!-~] 相当于 [A-Za-z0-9!&quot;# $%&amp;&apos;()*+,\-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~])</div><div class="line">[:lower:]      小写字母 (相当于 [a-z])</div><div class="line">[:print:]      可打印字符 (相当于 [ -~] 相当于 [ [:graph:]])</div><div class="line">[:punct:]      标点符号 (相当于 [!-/:-@[-`&#123;-~])</div><div class="line">[:space:]      空白字符(相当于 [\t\n\v\f\r ])</div><div class="line">[:upper:]      大写字母(相当于 [A-Z])</div><div class="line">[:word:]       单词字符(相当于 [0-9A-Za-z_])</div><div class="line">[:xdigit:]     16 進制字符集(相当于 [0-9A-Fa-f])</div></pre></td></tr></table></figure>
<h2 id="“Unicode-类”取值如下—普通类："><a href="#“Unicode-类”取值如下—普通类：" class="headerlink" title="“Unicode 类”取值如下—普通类："></a>“Unicode 类”取值如下—普通类：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">C                 -其他-          (other)</div><div class="line">Cc                控制字符        (control)</div><div class="line">Cf                格式            (format)</div><div class="line">Co                私人使用区      (private use)</div><div class="line">Cs                代理区          (surrogate)</div><div class="line">L                 -字母-          (letter)</div><div class="line">Ll                小写字母        (lowercase letter)</div><div class="line">Lm                修饰字母        (modifier letter)</div><div class="line">Lo                其它字母        (other letter)</div><div class="line">Lt                首字母大写字母  (titlecase letter)</div><div class="line">Lu                大写字母        (uppercase letter)</div><div class="line">M                 -标记-          (mark)</div><div class="line">Mc                间距标记        (spacing mark)</div><div class="line">Me                关闭标记        (enclosing mark)</div><div class="line">Mn                非间距标记      (non-spacing mark)</div><div class="line">N                 -数字-          (number)</div><div class="line">Nd                十進制数字      (decimal number)</div><div class="line">Nl                字母数字        (letter number)</div><div class="line">No                其它数字        (other number)</div><div class="line">P                 -标点-          (punctuation)</div><div class="line">Pc                连接符标点      (connector punctuation)</div><div class="line">Pd                破折号标点符号  (dash punctuation)</div><div class="line">Pe                关闭的标点符号  (close punctuation)</div><div class="line">Pf                最后的标点符号  (final punctuation)</div><div class="line">Pi                最初的标点符号  (initial punctuation)</div><div class="line">Po                其他标点符号    (other punctuation)</div><div class="line">Ps                开放的标点符号  (open punctuation)</div><div class="line">S                 -符号-          (symbol)</div><div class="line">Sc                货币符号        (currency symbol)</div><div class="line">Sk                修饰符号        (modifier symbol)</div><div class="line">Sm                数学符号        (math symbol)</div><div class="line">So                其他符号        (other symbol)</div><div class="line">Z                 -分隔符-        (separator)</div><div class="line">Zl                行分隔符        (line separator)</div><div class="line">Zp                段落分隔符      (paragraph separator)</div><div class="line">Zs                空白分隔符      (space separator)</div></pre></td></tr></table></figure>
<h2 id="“Unicode-类”取值如下—脚本类："><a href="#“Unicode-类”取值如下—脚本类：" class="headerlink" title="“Unicode 类”取值如下—脚本类："></a>“Unicode 类”取值如下—脚本类：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Arabic                  阿拉伯文</div><div class="line">Armenian                亚美尼亚文</div><div class="line">Balinese                巴厘岛文</div><div class="line">Bengali                 孟加拉文</div><div class="line">Bopomofo                汉语拼音字母</div><div class="line">Braille                 盲文</div><div class="line">Buginese                布吉文</div><div class="line">Buhid                   布希德文</div><div class="line">Canadian_Aboriginal     加拿大土著文</div><div class="line">Carian                  卡里亚文</div><div class="line">Cham                    占族文</div><div class="line">Cherokee                切诺基文</div><div class="line">Common                  普通的，字符不是特定于一个脚本</div><div class="line">Coptic                  科普特文</div><div class="line">Cuneiform               楔形文字</div><div class="line">Cypriot                 塞浦路斯文</div><div class="line">Cyrillic                斯拉夫文</div><div class="line">Deseret                 犹他州文</div><div class="line">Devanagari              梵文</div><div class="line">Ethiopic                衣索比亚文</div><div class="line">Georgian                格鲁吉亚文</div><div class="line">Glagolitic              格拉哥里文</div><div class="line">Gothic                  哥特文</div><div class="line">Greek                   希腊</div><div class="line">Gujarati                古吉拉特文</div><div class="line">Gurmukhi                果鲁穆奇文</div><div class="line">Han                     汉文</div><div class="line">Hangul                  韩文</div><div class="line">Hanunoo                 哈鲁喏文</div><div class="line">Hebrew                  希伯来文</div><div class="line">Hiragana                平假名（日语）</div><div class="line">Inherited               继承前一个字符的脚本</div><div class="line">Kannada                 坎那达文</div><div class="line">Katakana                片假名（日语）</div><div class="line">Kayah_Li                克耶字母</div><div class="line">Kharoshthi              卡罗须提文</div><div class="line">Khmer                   高棉文</div><div class="line">Lao                     老挝文</div><div class="line">Latin                   拉丁文</div><div class="line">Lepcha                  雷布查文</div><div class="line">Limbu                   林布文</div><div class="line">Linear_B                B类线形文字（古希腊）</div><div class="line">Lycian                  利西亚文</div><div class="line">Lydian                  吕底亚文</div><div class="line">Malayalam               马拉雅拉姆文</div><div class="line">Mongolian               蒙古文</div><div class="line">Myanmar                 缅甸文</div><div class="line">New_Tai_Lue             新傣仂文</div><div class="line">Nko                     Nko文</div><div class="line">Ogham                   欧甘文</div><div class="line">Ol_Chiki                桑塔利文</div><div class="line">Old_Italic              古意大利文</div><div class="line">Old_Persian             古波斯文</div><div class="line">Oriya                   奥里亚文</div><div class="line">Osmanya                 奥斯曼亚文</div><div class="line">Phags_Pa                八思巴文</div><div class="line">Phoenician              腓尼基文</div><div class="line">Rejang                  拉让文</div><div class="line">Runic                   古代北欧文字</div><div class="line">Saurashtra              索拉什特拉文（印度县城）</div><div class="line">Shavian                 萧伯纳文</div><div class="line">Sinhala                 僧伽罗文</div><div class="line">Sundanese               巽他文</div><div class="line">Syloti_Nagri            锡尔赫特文</div><div class="line">Syriac                  叙利亚文</div><div class="line">Tagalog                 塔加拉文</div><div class="line">Tagbanwa                塔格巴努亚文</div><div class="line">Tai_Le                  德宏傣文</div><div class="line">Tamil                   泰米尔文</div><div class="line">Telugu                  泰卢固文</div><div class="line">Thaana                  塔安那文</div><div class="line">Thai                    泰文</div><div class="line">Tibetan                 藏文</div><div class="line">Tifinagh                提非纳文</div><div class="line">Ugaritic                乌加里特文</div><div class="line">Vai                     瓦伊文</div><div class="line">Yi                      彝文</div></pre></td></tr></table></figure>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>　　对于 [a-z] 这样的正则表达式，如果要在 [] 中匹配 - ，可以将 - 放在 [] 的开头或结尾，例如 [-a-z] 或 [a-z-]</p>
<p>　　可以在 [] 中使用转义字符：\f、\t、\n、\r、\v、\377、\xFF、\x{10FFFF}、\、\^、\$、.、*、+、\?、{、}、(、)、[、]、|（具体含义见上面的说明）</p>
<p>　　如果在正则表达式中使用了分组，则在执行正则替换的时候，“替换内容”中可以使用 $1、${1}、$name、${name} 这样的“分组引用符”获取相应的分组内容。其中 $0 代表整个匹配项，$1 代表第 1 个分组，$2 代表第 2 个分组，……。</p>
<p>　　如果“分组引用符”是 $name 的形式，则在解析的时候，name 是取尽可能长的字符串，比如：$1x 相当于 ${1x}，而不是${1}x，再比如：$10 相当于 ${10}，而不是 ${1}0。</p>
<p>　　由于 $ 字符会被转义，所以要在“替换内容”中使用 $ 字符，可以用 \$ 代替。</p>
<p>　　上面介绍的正则表达式语法是“Perl 语法”，除了“Perl 语法”外，Go 语言中还有另一种“POSIX 语法”，“POSIX 语法”除了不能使用“Perl 类”之外，其它都一样。</p>
<h1 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h1><p>func main() { text := Hello 世界！123 Go.<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 查找连续的小写字母</span></div><div class="line">reg := regexp.MustCompile(<span class="string">`[a-z]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["ello" "o"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的非小写字母</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[^a-z]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["H" " 世界！123 G" "."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的单词字母</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[\w]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello" "123" "Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的非单词字母、非空白字符</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[^\w\s]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["世界！" "."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的大写字母</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[[:upper:]]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["H" "G"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的非 ASCII 字符</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[[:^ascii:]]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["世界！"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的标点符号</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[\pP]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["！" "."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的非标点符号字符</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[\PP]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello 世界" "123 Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的汉字</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[\p&#123;Han&#125;]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["世界"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续的非汉字字符</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[\P&#123;Han&#125;]+`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello " "！123 Go."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找 Hello 或 Go</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`Hello|Go`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello" "Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找行首以 H 开头，以空格结尾的字符串</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`^H.*\s`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello 世界！123 "]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找行首以 H 开头，以空白结尾的字符串（非贪婪模式）</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?U)^H.*\s`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello "]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找以 hello 开头（忽略大小写），以 Go 结尾的字符串</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?i:^hello).*Go`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello 世界！123 Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找 Go.</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`\QGo.\E`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Go."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找从行首开始，以空格结尾的字符串（非贪婪模式）</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?U)^.* `</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello "]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找以空格开头，到行尾结束，中间不包含空格字符串</span></div><div class="line">reg = regexp.MustCompile(<span class="string">` [^ ]*$`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// [" Go."]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找“单词边界”之间的字符串</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?U)\b.+\b`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello" " 世界！" "123" " " "Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找连续 1 次到 4 次的非空格字符，并以 o 结尾的字符串</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`[^ ]&#123;1,4&#125;o`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello" "Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找 Hello 或 Go</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?:Hell|G)o`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.FindAllString(text, <span class="number">-1</span>))</div><div class="line"><span class="comment">// ["Hello" "Go"]</span></div><div class="line"></div><div class="line"><span class="comment">// 查找 Hello 或 Go，替换为 Hellooo、Gooo</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(?PHell|G)o`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.ReplaceAllString(text, <span class="string">"$&#123;n&#125;ooo"</span>))</div><div class="line"><span class="comment">// "Hellooo 世界！123 Gooo."</span></div><div class="line"></div><div class="line"><span class="comment">// 交换 Hello 和 Go</span></div><div class="line">reg = regexp.MustCompile(<span class="string">`(Hello)(.*)(Go)`</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.ReplaceAllString(text, <span class="string">"$3$2$1"</span>))</div><div class="line"><span class="comment">// "Go 世界！123 Hello."</span></div><div class="line"></div><div class="line"><span class="comment">// 特殊字符的查找</span></div><div class="line">reg = regexp.MustCompile(<span class="string">"[\\f\\t\\n\\r\\v\\123\\x7F\\x&#123;10FFFF&#125;\\\\\\^\\$\\.\\*\\+\\?\\&#123;\\&#125;\\(\\)\\[\\]\\|]"</span>)</div><div class="line">fmt.Printf(<span class="string">"%q\n"</span>, reg.ReplaceAllString(<span class="string">"\f\t\n\r\v\123\x7F\U0010FFFF\\^$.*+?&#123;&#125;()[]|"</span>, <span class="string">"-"</span>))</div><div class="line"><span class="comment">// "----------------------"</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/反射/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/反射/" itemprop="url">
                  反射
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:55:20+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>详见：<a href="http://studygolang.com/pkgdoc" target="_blank" rel="external">go标准包：reflect</a></p>
<h1 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h1><ul>
<li>大大提高程序的灵活性，特别是与interface结合能够发挥更大的效果</li>
<li>反射使用TypeOf和ValueOf函数从接口中获取目标对象信息</li>
<li>反射会将匿名字段设为独立字段（匿名字段本质）</li>
<li>想要利用反射修改对象信息，前提是interface.data是settble,即pointer-interface</li>
<li>通过反射可以<code>动态</code>的调用方法<h1 id="demo实例"><a href="#demo实例" class="headerlink" title="demo实例"></a>demo实例</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</div><div class="line">	Id   <span class="keyword">int</span></div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span> <span class="title">Hello</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"hello world"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	u := User&#123;<span class="number">12</span>, <span class="string">"zhangsan"</span>, <span class="number">33</span>&#125;</div><div class="line">	<span class="comment">// 此处不可以传指针</span></div><div class="line">	Info(u)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Info</span><span class="params">(o <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</div><div class="line">	t := reflect.TypeOf(o)</div><div class="line">	fmt.Println(<span class="string">"Type:"</span>, t.Name())</div><div class="line">	v := reflect.ValueOf(o)</div><div class="line">	fmt.Println(<span class="string">"Field:"</span>)</div><div class="line">    <span class="keyword">if</span> k := t.Kind(); k != reflect.Struct &#123;</div><div class="line">		fmt.Println(<span class="string">"不是interface的struct类型"</span>)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; t.NumField(); i++ &#123;</div><div class="line">		f := t.Field(i)</div><div class="line">		val := v.Field(i).Interface()</div><div class="line">		fmt.Println(f.Name,f.Type,f.Anonymous,val)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">Type: User</div><div class="line">Field:</div><div class="line">Id <span class="keyword">int</span> <span class="literal">false</span> <span class="number">12</span></div><div class="line">Name <span class="keyword">string</span> <span class="literal">false</span> zhangsan</div><div class="line">Age <span class="keyword">int</span> <span class="literal">false</span> <span class="number">33</span></div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h1 id="匿名字段的反射"><a href="#匿名字段的反射" class="headerlink" title="匿名字段的反射"></a>匿名字段的反射</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</div><div class="line">	Id   <span class="keyword">int</span></div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> Manage <span class="keyword">struct</span> &#123;</div><div class="line">	User</div><div class="line">	Title <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	m := Manage&#123;User&#123;<span class="number">12</span>, <span class="string">"zhangsan"</span>, <span class="number">14</span>&#125;, <span class="string">"wangwu"</span>&#125;</div><div class="line">	t := reflect.TypeOf(m)</div><div class="line">	<span class="comment">// 匿名字段的反射</span></div><div class="line">	fmt.Println(t.Field(<span class="number">1</span>))</div><div class="line">	<span class="comment">// 取出匿名字段的值</span></div><div class="line">	fmt.Println(t.FieldByIndex([]<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">0</span>&#125;))</div><div class="line">	<span class="comment">// 取出正常字段的值</span></div><div class="line">	fmt.Println(t.FieldByIndex([]<span class="keyword">int</span>&#123;<span class="number">1</span>&#125;))</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">&#123;Title  <span class="keyword">string</span>  <span class="number">32</span> [<span class="number">1</span>] <span class="literal">false</span>&#125;</div><div class="line">&#123;Id  <span class="keyword">int</span>  <span class="number">0</span> [<span class="number">0</span>] <span class="literal">false</span>&#125;</div><div class="line">&#123;Title  <span class="keyword">string</span>  <span class="number">32</span> [<span class="number">1</span>] <span class="literal">false</span>&#125;</div></pre></td></tr></table></figure>
<h1 id="通过反射改变其值"><a href="#通过反射改变其值" class="headerlink" title="通过反射改变其值"></a>通过反射改变其值</h1><blockquote>
<p>demo1<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">x := <span class="number">13</span></div><div class="line">v := reflect.ValueOf(&amp;x)</div><div class="line">v.Elem().SetInt(<span class="number">999</span>)</div><div class="line">fmt.Println(x)</div><div class="line"><span class="comment">// 结果：999</span></div></pre></td></tr></table></figure></p>
<p>demo2<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">	sex  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	u := User&#123;<span class="string">"zhansan"</span>, <span class="number">12</span>, <span class="number">2</span>&#125;</div><div class="line">	f := reflect.ValueOf(&amp;u)</div><div class="line">	v := reflect.ValueOf(u)</div><div class="line">	<span class="comment">// kind方法返回类型,</span></div><div class="line">	<span class="comment">// interface方法返回v当前持有的值（表示为/保管在interface&#123;&#125;类型），</span></div><div class="line">	<span class="comment">// 等价于：var i interface&#123;&#125; = (v's underlying value)</span></div><div class="line">	fmt.Println(v.Kind(), v.Type(), v.Interface())</div><div class="line">	<span class="keyword">if</span> f.Kind() == reflect.Ptr &amp;&amp; !f.Elem().CanSet() &#123;</div><div class="line">		fmt.Println(<span class="string">"User不能被设置"</span>)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">	    <span class="comment">// Elem返回v持有的接口保管的值的Value封装，或者v持有的指针指向的值的Value封装。</span></div><div class="line">		f = f.Elem()</div><div class="line">	&#125;</div><div class="line">	val := f.FieldByName(<span class="string">"Name"</span>)</div><div class="line">	<span class="comment">// IsValid返回v是否持有一个值。如果v是Value零值会返回假，此时v除了IsValid、String、Kind之外的方法都会导致panic。</span></div><div class="line">	<span class="comment">// 绝大多数函数和方法都永远不返回Value零值。如果某个函数/方法返回了非法的Value，它的文档必须显式的说明具体情况。</span></div><div class="line">	<span class="keyword">if</span> (!val.IsValid()) &#123;</div><div class="line">		fmt.Println(<span class="string">"val不是有效值"</span>)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (val.Kind() == reflect.String) &#123;</div><div class="line">		<span class="comment">// 设置值</span></div><div class="line">		val.SetString(<span class="string">"wangwu"</span>)</div><div class="line">	&#125;</div><div class="line">	fmt.Println(u)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="通过反射调用其方法"><a href="#通过反射调用其方法" class="headerlink" title="通过反射调用其方法"></a>通过反射调用其方法</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">	sex  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	user := User&#123;<span class="string">"zhangsan"</span>, <span class="number">12</span>, <span class="number">2</span>&#125;</div><div class="line">	f := reflect.ValueOf(user)</div><div class="line">	<span class="comment">// 返回v的名为name的方法的已绑定（到v的持有值的）状态的函数形式的Value封装。</span></div><div class="line">	mv := f.MethodByName(<span class="string">"GetName"</span>)</div><div class="line">	<span class="comment">// slice格式,reflect.Value为一种reflect的value类型,包含reflect.Int...</span></div><div class="line">	<span class="comment">// ValueOf返回一个初始化为i接口保管的具体值的Value</span></div><div class="line">	args := []reflect.Value&#123;reflect.ValueOf(<span class="string">"wangwu"</span>)&#125;</div><div class="line">	<span class="comment">// func (v Value) Call(in []Value) []Value</span></div><div class="line">	<span class="comment">// Call方法使用输入的参数in调用v持有的函数。</span></div><div class="line">	mv.Call(args)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(user User)</span> <span class="title">GetName</span><span class="params">(name <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"hello "</span> + name + <span class="string">" my name is "</span> + user.Name)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/数据类型判断与转换/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/数据类型判断与转换/" itemprop="url">
                  数据类型判断与转换
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:52:24+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="int-int64-string之间转换"><a href="#int-int64-string之间转换" class="headerlink" title="int int64 string之间转换"></a>int int64 string之间转换</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">#<span class="keyword">string</span>到<span class="keyword">int</span>  </div><div class="line"><span class="keyword">int</span>,err:=strconv.Atoi(<span class="keyword">string</span>)  </div><div class="line">#<span class="keyword">string</span>到<span class="keyword">int64</span>  </div><div class="line"><span class="keyword">int64</span>, err := strconv.ParseInt(<span class="keyword">string</span>, <span class="number">10</span>, <span class="number">64</span>)  </div><div class="line">#<span class="keyword">int</span>到<span class="keyword">string</span>  </div><div class="line"><span class="keyword">string</span>:=strconv.Itoa(<span class="keyword">int</span>)  </div><div class="line">#<span class="keyword">int64</span>到<span class="keyword">string</span>  </div><div class="line"><span class="keyword">string</span>:=strconv.FormatInt(<span class="keyword">int64</span>,<span class="number">10</span>)</div></pre></td></tr></table></figure>
<h1 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h1><p>Go语言里面有一个语法，可以直接判断是否是该类型的变量： <code>value, ok = element.(T)</code>，这里value就是变量的值，ok是一个bool类型，element是interface变量，T是断言的类型。<br>　　如果element里面确实存储了T类型的数值，那么ok返回true，否则返回false。</p>
<ul>
<li><p>demo1</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> a <span class="keyword">interface</span>&#123;&#125;</div><div class="line">a = <span class="string">"zhangsan"</span></div><div class="line"><span class="comment">// interface&#123;&#125; =&gt; string (断言)</span></div><div class="line">a = a.(<span class="keyword">string</span>)</div><div class="line"><span class="comment">// 如果直接string(a), 则报错:</span></div><div class="line">cannot convert a (<span class="keyword">type</span> <span class="keyword">interface</span> &#123;&#125;) to <span class="keyword">type</span> <span class="keyword">string</span>: need <span class="keyword">type</span> assertion</div></pre></td></tr></table></figure>
</li>
<li><p>demo2</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"strconv"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</div><div class="line"><span class="keyword">type</span> List [] Element</div><div class="line"></div><div class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</div><div class="line">    name <span class="keyword">string</span></div><div class="line">    age <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//定义了String方法，实现了fmt.Stringer</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"(name: "</span> + p.name + <span class="string">" - age: "</span>+strconv.Itoa(p.age)+ <span class="string">" years)"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    list := <span class="built_in">make</span>(List, <span class="number">3</span>)</div><div class="line">    list[<span class="number">0</span>] = <span class="number">1</span> <span class="comment">// an int</span></div><div class="line">    list[<span class="number">1</span>] = <span class="string">"Hello"</span> <span class="comment">// a string</span></div><div class="line">    list[<span class="number">2</span>] = Person&#123;<span class="string">"Dennis"</span>, <span class="number">70</span>&#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> index, element := <span class="keyword">range</span> list &#123;</div><div class="line">        <span class="keyword">if</span> value, ok := element.(<span class="keyword">int</span>); ok &#123;</div><div class="line">            fmt.Printf(<span class="string">"list[%d] is an int and its value is %d\n"</span>, index, value)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> value, ok := element.(<span class="keyword">string</span>); ok &#123;</div><div class="line">            fmt.Printf(<span class="string">"list[%d] is a string and its value is %s\n"</span>, index, value)</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> value, ok := element.(Person); ok &#123;</div><div class="line">            fmt.Printf(<span class="string">"list[%d] is a Person and its value is %s\n"</span>, index, value)</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            fmt.Println(<span class="string">"list[%d] is of a different type"</span>, index)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>switch测试</strong><br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"strconv"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> Element <span class="keyword">interface</span>&#123;&#125;</div><div class="line"><span class="keyword">type</span> List [] Element</div><div class="line"></div><div class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</div><div class="line">    name <span class="keyword">string</span></div><div class="line">    age <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//打印</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"(name: "</span> + p.name + <span class="string">" - age: "</span>+strconv.Itoa(p.age)+ <span class="string">" years)"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    list := <span class="built_in">make</span>(List, <span class="number">3</span>)</div><div class="line">    list[<span class="number">0</span>] = <span class="number">1</span> <span class="comment">//an int</span></div><div class="line">    list[<span class="number">1</span>] = <span class="string">"Hello"</span> <span class="comment">//a string</span></div><div class="line">    list[<span class="number">2</span>] = Person&#123;<span class="string">"Dennis"</span>, <span class="number">70</span>&#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> index, element := <span class="keyword">range</span> list&#123;</div><div class="line">        <span class="keyword">switch</span> value := element.(<span class="keyword">type</span>) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="keyword">int</span>:</div><div class="line">                fmt.Printf(<span class="string">"list[%d] is an int and its value is %d\n"</span>, index, value)</div><div class="line">            <span class="keyword">case</span> <span class="keyword">string</span>:</div><div class="line">                fmt.Printf(<span class="string">"list[%d] is a string and its value is %s\n"</span>, index, value)</div><div class="line">            <span class="keyword">case</span> Person:</div><div class="line">                fmt.Printf(<span class="string">"list[%d] is a Person and its value is %s\n"</span>, index, value)</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                fmt.Println(<span class="string">"list[%d] is of a different type"</span>, index)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>这里有一点需要强调的是：element.(type)语法不能在switch外的任何逻辑里面使用，如果你要在switch外面判断一个类型就使用comma-ok</strong>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/文件/" itemprop="url">
                  文件处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:51:59+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="遍历目录"><a href="#遍历目录" class="headerlink" title="遍历目录"></a>遍历目录</h1><p>使用ioutil标准包<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">ListDir</span><span class="params">(filePath <span class="keyword">string</span>)</span> <span class="params">(files []<span class="keyword">string</span>, err error)</span></span> &#123;</div><div class="line">	paths, err := ioutil.ReadDir(filePath)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> _, f := <span class="keyword">range</span> paths &#123;</div><div class="line">		<span class="keyword">if</span> !f.IsDir() &#123;</div><div class="line">			files = <span class="built_in">append</span>(files, f.Name())</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/字符串/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/字符串/" itemprop="url">
                  字符串
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:51:52+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="实现随机数"><a href="#实现随机数" class="headerlink" title="实现随机数"></a>实现随机数</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateRandom</span><span class="params">(strLen <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</div><div class="line">	strRandom := <span class="string">"qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM"</span></div><div class="line">	bytes := []<span class="keyword">byte</span>(strRandom)</div><div class="line">	strByte := []<span class="keyword">byte</span>&#123;&#125;</div><div class="line">	<span class="comment">// 需要一个随机种子（torrent），不然每次都是一样的随机数</span></div><div class="line">	r := rand.New(rand.NewSource(time.Now().UnixNano()))</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; strLen; i++ &#123;</div><div class="line">		subNum := r.Intn(<span class="built_in">len</span>(bytes))</div><div class="line">		sep := bytes[subNum]</div><div class="line">		strByte = <span class="built_in">append</span>(strByte, sep)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">string</span>(strByte)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="MD5加密"><a href="#MD5加密" class="headerlink" title="MD5加密"></a>MD5加密</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Md5</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</div><div class="line">	m := md5.New()</div><div class="line">	m.Write([]<span class="keyword">byte</span>(str))</div><div class="line">	<span class="keyword">return</span> hex.EncodeToString(m.Sum(<span class="literal">nil</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/webServer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/webServer/" itemprop="url">
                  webServer
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:50:45+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="通过默认的net-http服务"><a href="#通过默认的net-http服务" class="headerlink" title="通过默认的net/http服务"></a>通过默认的net/http服务</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	http.HandleFunc(<span class="string">"/"</span>, HelloWorld)</div><div class="line">	errpr := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</div><div class="line">	<span class="keyword">if</span> errpr != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatal(<span class="string">"listen falded"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 由于http.ResponseWriter只是一个接口,所以不需要引用传值</span></div><div class="line"><span class="comment">// 而http.Request是一个数据(结构类型),所以需要引用传值</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloWorld</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	io.WriteString(w, <span class="string">"hello world"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="重写ServeHTTP方法"><a href="#重写ServeHTTP方法" class="headerlink" title="重写ServeHTTP方法"></a>重写ServeHTTP方法</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> MyHandler <span class="keyword">struct</span> &#123;&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	mux := http.NewServeMux()</div><div class="line">	mux.Handle(<span class="string">"/"</span>, &amp;MyHandler&#123;&#125;)</div><div class="line">	mux.HandleFunc(<span class="string">"/home"</span>, Home)</div><div class="line">	err := http.ListenAndServe(<span class="string">":8080"</span>, mux)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		log.Fatal(<span class="string">"listen falded"</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MyHandler)</span><span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	io.WriteString(w, <span class="string">"hello world "</span> + r.URL.Path)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Home</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	io.WriteString(w, <span class="string">"home "</span> + r.URL.Path)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="重写http-Server"><a href="#重写http-Server" class="headerlink" title="重写http.Server"></a>重写http.Server</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 定义全局变量</span></div><div class="line"><span class="keyword">var</span> mux <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">(http.ResponseWriter, *http.Request)</span></span></div><div class="line"><span class="title">type</span> <span class="title">MyHandler</span> <span class="title">struct</span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	server := http.Server&#123;</div><div class="line">		Addr: <span class="string">":8080"</span>,</div><div class="line">		<span class="comment">// 定义server的默认handler</span></div><div class="line">		Handler: &amp;MyHandler&#123;&#125;,</div><div class="line">		ReadTimeout: <span class="number">2</span> * time.Second,</div><div class="line">	&#125;</div><div class="line">	<span class="comment">// 对全局变量赋值</span></div><div class="line">	mux = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">(http.ResponseWriter, *http.Request)</span>)</span></div><div class="line">	<span class="title">mux</span>["/<span class="title">home</span>"] = <span class="title">Home</span></div><div class="line">	<span class="title">mux</span>["/<span class="title">user</span>"] = <span class="title">User</span></div><div class="line">	<span class="title">err</span> := <span class="title">server</span>.<span class="title">ListenAndServe</span><span class="params">()</span></div><div class="line">	<span class="title">if</span> <span class="title">err</span> != <span class="title">nil</span> &#123;</div><div class="line">		log.Fatal(<span class="string">"listen faild"</span>)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="comment">// handler默认执行的方法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*MyHandler)</span><span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">    <span class="comment">// 根据map转发路由</span></div><div class="line">	<span class="keyword">if</span> v, ok := mux[r.URL.String()]; ok &#123;</div><div class="line">		v(w, r)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	io.WriteString(w, <span class="string">"hello world "</span> + r.URL.Path)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Home</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	io.WriteString(w, <span class="string">"home "</span> + r.URL.Path)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">User</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	io.WriteString(w, <span class="string">"user "</span> + r.URL.Path)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="原生中间件编写"><a href="#原生中间件编写" class="headerlink" title="原生中间件编写"></a>原生中间件编写</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> SingleMiddle <span class="keyword">struct</span> &#123;</div><div class="line">	handler   http.Handler</div><div class="line">	allowHost []<span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> myHandler <span class="keyword">struct</span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> allowHosts []<span class="keyword">string</span></div><div class="line">	allowHosts = <span class="built_in">append</span>(allowHosts, <span class="string">"localhost:8080"</span>)</div><div class="line">	MyHandler := &amp;myHandler&#123;&#125;</div><div class="line">	singleHost := NewSingle(MyHandler, allowHosts)</div><div class="line">	http.ListenAndServe(<span class="string">":8080"</span>, singleHost)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// middleware</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSingle</span><span class="params">(handler http.Handler, allowHost []<span class="keyword">string</span>)</span> <span class="params">(*SingleMiddle)</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> &amp;SingleMiddle&#123;handler, allowHost&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// middleware</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SingleMiddle)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	host := r.Host</div><div class="line">	isIn := <span class="literal">false</span></div><div class="line">	fmt.Println(s.allowHost)</div><div class="line">	fmt.Println(host)</div><div class="line">	<span class="keyword">for</span> _, allowH := <span class="keyword">range</span> s.allowHost &#123;</div><div class="line">		<span class="keyword">if</span> allowH == host &#123;</div><div class="line">			isIn = <span class="literal">true</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> isIn &#123;</div><div class="line">		s.handler.ServeHTTP(w, r)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		w.WriteHeader(<span class="number">403</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// custom handler</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *myHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</div><div class="line">	w.WriteHeader(<span class="number">200</span>)</div><div class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">"helle golang"</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/数组与切片/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/数组与切片/" itemprop="url">
                  数组与切片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:49:02+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 索引数组</span></div><div class="line">a := [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">2</span>:<span class="number">20</span>&#125;</div><div class="line"><span class="comment">// 不指定数组长度</span></div><div class="line">a := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</div><div class="line"><span class="comment">// 多维数组,只有第一维可以使用...</span></div><div class="line">a := [...][<span class="number">3</span>]<span class="keyword">int</span>&#123;</div><div class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</div><div class="line">    &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</div><div class="line">&#125;</div><div class="line">a := [<span class="number">2</span>][<span class="number">3</span>]<span class="keyword">int</span>&#123;</div><div class="line">    &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,</div><div class="line">    &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//指针数组</span></div><div class="line">x,y := <span class="number">1</span>,<span class="number">2</span></div><div class="line">a := [...]*<span class="keyword">int</span>&#123;&amp;x, &amp;y&#125;</div><div class="line"><span class="comment">//指向数组的指针</span></div><div class="line">a :=[...]<span class="keyword">int</span>&#123;<span class="number">99</span>:<span class="number">1</span>&#125;</div><div class="line"><span class="keyword">var</span> p *[<span class="number">100</span>]<span class="keyword">int</span> = &amp;a</div><div class="line"><span class="comment">// 数组之间可以使用 == 或 != 比较,只有长度和类型相同才算相同的数组，才能比较</span></div><div class="line">a :=[<span class="number">2</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</div><div class="line">b :=[<span class="number">2</span>]<span class="keyword">int</span>&#123;<span class="number">3</span>,<span class="number">2</span>&#125;</div><div class="line"><span class="comment">// 使用new关键字，返回指向数组的指针</span></div><div class="line">a :=[<span class="number">2</span>]<span class="keyword">int</span>&#123;&#125;</div><div class="line">a[<span class="number">1</span>] = <span class="number">2</span></div><div class="line">b = <span class="built_in">new</span>([<span class="number">2</span>]<span class="keyword">int</span>)</div><div class="line">b[<span class="number">1</span>] = <span class="number">2</span></div><div class="line"><span class="comment">// 不论是指向数组的指针还是数组本身，都可以使用a[1]的形式给数组赋值</span></div><div class="line"><span class="comment">// go语言的数组是值类型，不是引用类型</span></div><div class="line"><span class="comment">//冒泡排序</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	list := [...]<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">323</span>, <span class="number">4</span>, <span class="number">565</span>, <span class="number">67</span>, <span class="number">3</span>&#125;</div><div class="line">	fmt.Println(list)</div><div class="line">	<span class="keyword">var</span> lenth = <span class="built_in">len</span>(list)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; lenth; i++ &#123;</div><div class="line">		<span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; lenth; j++ &#123;</div><div class="line">			<span class="keyword">if</span> list[i] &gt; list[j] &#123;</div><div class="line">				tmp := list[i]</div><div class="line">				list[i] = list[j]</div><div class="line">				list[j] = tmp</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	fmt.Println(list)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">12</span> <span class="number">323</span> <span class="number">4</span> <span class="number">565</span> <span class="number">67</span> <span class="number">3</span>]</div><div class="line">[<span class="number">3</span> <span class="number">4</span> <span class="number">12</span> <span class="number">67</span> <span class="number">323</span> <span class="number">565</span>]</div></pre></td></tr></table></figure>
<h1 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h1><h2 id="切片与数组的定义区别"><a href="#切片与数组的定义区别" class="headerlink" title="切片与数组的定义区别"></a>切片与数组的定义区别</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">vs:=[]<span class="keyword">interface</span>&#123;&#125;&#123;</div><div class="line">    []<span class="keyword">int</span>&#123;&#125;,<span class="comment">// slice 切片</span></div><div class="line">    []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,<span class="comment">// slice 切片</span></div><div class="line">    []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;[:],<span class="comment">//切片再切还是切片</span></div><div class="line">    <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">3</span>,<span class="number">10</span>),<span class="comment">//标准的slice 定义方式</span></div><div class="line">    [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,<span class="comment">//array 数组，确定数组长度</span></div><div class="line">    [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,<span class="comment">//array 数组，由编译器自动计算数组长度。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Reslice"><a href="#Reslice" class="headerlink" title="Reslice"></a>Reslice</h2><ul>
<li>切片本质上是指向类型</li>
<li>切片不能越界，如果超过底层数组，则报错，而不是追加数组长度</li>
<li>索引不可超多数组容量<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">a := [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;</div><div class="line">fpm.Prinln(a)</div><div class="line"><span class="comment">// 0~4 容量为10</span></div><div class="line">s1 := a[:<span class="number">5</span>]</div><div class="line"><span class="comment">// 5-9, 索引5到索引9,索引10不取， 容量为5</span></div><div class="line">s1 := a[<span class="number">5</span>,<span class="number">10</span>]</div><div class="line"><span class="comment">// 使用make,</span></div><div class="line"><span class="comment">// 参数1：类型，</span></div><div class="line"><span class="comment">// 参数2：包含几个元素，</span></div><div class="line"><span class="comment">// 参数3：容量（先分配10个连续内存地址，如果增加到11个时，则需要从新分配，每次增加一倍，扩容至20，下次40，在下次80，造成这种现象的原因是因为：从新分配内存是一件效率非常低的）如果留空，则和参数相等</span></div><div class="line">s1 := <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">3</span>,<span class="number">10</span>)</div><div class="line"><span class="comment">// 获取切片的长度, </span></div><div class="line"><span class="built_in">len</span>(s1)</div><div class="line"><span class="comment">// 获取切片容量</span></div><div class="line"><span class="keyword">map</span>(s1)</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Append"><a href="#Append" class="headerlink" title="Append"></a>Append</h2><blockquote>
<ul>
<li>可以在slice尾部追加元素</li>
<li>可以将一个slice追加到另一个slice</li>
<li>如果最终长度未超过追加到slice的容量，则返回原始slice</li>
<li><p>如果超过追加的slice的容量，将重新分配数据</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">s1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">3</span>, <span class="number">6</span>)</div><div class="line">fmt.Printf(<span class="string">"%p\n"</span>, s1)</div><div class="line">s1 = <span class="built_in">append</span>(s1, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">fmt.Printf(<span class="string">"%v %p\n"</span>, s1, s1)</div><div class="line">s1 = <span class="built_in">append</span>(s1, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">fmt.Printf(<span class="string">"%v %p\n"</span>, s1, s1)</div><div class="line"><span class="comment">// 对于指向同一个数组的slice，如果数组改变了，则两个slice指向的部分同样改变</span></div><div class="line">a := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</div><div class="line">s1 := a[<span class="number">2</span>:<span class="number">5</span>]</div><div class="line">s2 := a[<span class="number">1</span>:<span class="number">3</span>]</div><div class="line">fmt.Println(s1, s2)</div><div class="line">s1[<span class="number">0</span>] = <span class="number">9</span></div><div class="line">fmt.Println(s1, s2)</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">3</span> <span class="number">4</span> <span class="number">5</span>] [<span class="number">2</span> <span class="number">3</span>]</div><div class="line">[<span class="number">9</span> <span class="number">4</span> <span class="number">5</span>] [<span class="number">2</span> <span class="number">9</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>如果一个slice通过append添加时，如果超过了容量，那么就不在指向原来的数组，而是从新分配了一个</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</div><div class="line">	s1 := a[<span class="number">2</span>:<span class="number">5</span>]</div><div class="line">	s2 := a[<span class="number">1</span>:<span class="number">3</span>]</div><div class="line">	fmt.Println(s1, s2)</div><div class="line">	s2 = <span class="built_in">append</span>(s2, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>)</div><div class="line">	s1[<span class="number">0</span>] = <span class="number">9</span></div><div class="line">	fmt.Println(s1, s2)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">3</span> <span class="number">4</span> <span class="number">5</span>] [<span class="number">2</span> <span class="number">3</span>]</div><div class="line">[<span class="number">9</span> <span class="number">4</span> <span class="number">5</span>] [<span class="number">2</span> <span class="number">3</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">5</span> <span class="number">6</span> <span class="number">6</span> <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h2><blockquote>
<p>从参数2复制到参数1（覆盖）<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">s1 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</div><div class="line">s2 := []<span class="keyword">int</span>&#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</div><div class="line"><span class="built_in">copy</span>(s2, s1)</div><div class="line"><span class="built_in">copy</span>(s1, s2)</div><div class="line">fmt.Println(s2, s1)</div><div class="line"><span class="comment">// 结果</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>] [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]</div><div class="line"><span class="comment">// 当然可以指定位置</span></div><div class="line">s1 := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</div><div class="line">s2 := []<span class="keyword">int</span>&#123;<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</div><div class="line"><span class="built_in">copy</span>(s1[<span class="number">3</span>:<span class="number">6</span>], s2)</div><div class="line">fmt.Println(s1)</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span>]</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="删除切片"><a href="#删除切片" class="headerlink" title="删除切片"></a>删除切片</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 比如想删除下标为k的切片</span></div><div class="line">arr = <span class="built_in">append</span>(arr[:k], arr[k+<span class="number">1</span>:]...)</div></pre></td></tr></table></figure>
<h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><blockquote>
<ul>
<li>map是无序的<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 初始化map</span></div><div class="line">m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">1</span>: <span class="string">"zhangsan"</span>, <span class="number">2</span>: <span class="string">"lisi"</span>, <span class="number">3</span>: <span class="string">"wangwu"</span>, <span class="number">4</span>: <span class="string">"zhaoliu"</span>&#125;</div><div class="line"><span class="comment">// 初始化slice</span></div><div class="line">s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(m))</div><div class="line">i := <span class="number">0</span></div><div class="line"><span class="comment">// range 可遍历slice或map</span></div><div class="line"><span class="keyword">for</span> k, _ := <span class="keyword">range</span> m &#123;</div><div class="line">    <span class="comment">// 将map的键赋给slice</span></div><div class="line">	s[i] = k</div><div class="line">	i++</div><div class="line">&#125;</div><div class="line">fmt.Println(s)</div><div class="line"><span class="comment">//结果（体现了map的无序性）</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>]</div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">[<span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment">// 如果使用range遍历slice和map，</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	m := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;<span class="number">1</span>: <span class="string">"zhangsan"</span>, <span class="number">2</span>: <span class="string">"lisi"</span>, <span class="number">3</span>: <span class="string">"wangwu"</span>, <span class="number">4</span>: <span class="string">"zhaoliu"</span>&#125;</div><div class="line">	s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(m))</div><div class="line">	i := <span class="number">0</span></div><div class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</div><div class="line">		s[i] = k</div><div class="line">		i++</div><div class="line">		fmt.Println(k, v)</div><div class="line">	&#125;</div><div class="line">	fmt.Println(s)</div><div class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> s &#123;</div><div class="line">		fmt.Println(k, v)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果如下：</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line"><span class="number">4</span> zhaoliu</div><div class="line"><span class="number">1</span> zhangsan</div><div class="line"><span class="number">2</span> lisi</div><div class="line"><span class="number">3</span> wangwu</div><div class="line">[<span class="number">4</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</div><div class="line"><span class="number">0</span> <span class="number">4</span></div><div class="line"><span class="number">1</span> <span class="number">1</span></div><div class="line"><span class="number">2</span> <span class="number">2</span></div><div class="line"><span class="number">3</span> <span class="number">3</span></div></pre></td></tr></table></figure></li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/mgo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/mgo/" itemprop="url">
                  mgo
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:47:31+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>mongodb客户端的golang实现<br>mgo很有可能作为golang的标准库<br><a href="https://godoc.org/gopkg.in/mgo.v2" target="_blank" rel="external">mgo文档</a></p>
</blockquote>
<h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> database</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"full_text_search/config"</span></div><div class="line">	<span class="string">"gopkg.in/mgo.v2"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Session *mgo.Session</div><div class="line"></div><div class="line"><span class="comment">// 简单实现单例，只创建一个session</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> Session == <span class="literal">nil</span> &#123;</div><div class="line">		<span class="keyword">var</span> err error</div><div class="line">		Session, err = mgo.Dial(config.MongoDB.Host + <span class="string">":"</span> + config.MongoDB.Port)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="built_in">panic</span>(<span class="string">"连接mongodb失败，原因："</span> + err.Error())</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Collection</span><span class="params">(collectionName <span class="keyword">string</span>, f <span class="keyword">func</span>(collection *mgo.Collection)</span>) <span class="params">(err error)</span></span> &#123;</div><div class="line">    <span class="comment">// mgo内部实现了连接池，通过clone获取连接</span></div><div class="line">	session := Session.Clone()</div><div class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		session.Close()</div><div class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line">	collection := session.DB(config.MongoDB.Database).C(collectionName)</div><div class="line">	f(collection)</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">Session, err = mgo.Dial(config.MongoDB.Host + <span class="string">":"</span> + config.MongoDB.Port)</div><div class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">	<span class="built_in">panic</span>(<span class="string">"连接mongodb失败，原因："</span> + err.Error())</div><div class="line">&#125;</div><div class="line">err = Session.DB(<span class="string">"admin"</span>).Login(config.MongoDB.User, config.MongoDB.Password)</div><div class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</div><div class="line">	<span class="built_in">panic</span>(<span class="string">"登录mongodb失败，原因："</span> + err.Error())</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h1><p>上述是建立连接，并执行操作</p>
<h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> d <span class="keyword">struct</span> &#123;</div><div class="line">	X <span class="keyword">int</span></div><div class="line">	Y <span class="keyword">int</span></div><div class="line">	Z <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line">database.Collection(<span class="string">"user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(collection *mgo.Collection)</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> insertDatas = []<span class="keyword">interface</span>&#123;&#125;&#123;</div><div class="line">		d&#123;<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>&#125;,</div><div class="line">		d&#123;<span class="number">7</span>, <span class="number">6</span>, <span class="number">6</span>&#125;,</div><div class="line">		d&#123;<span class="number">8</span>, <span class="number">6</span>, <span class="number">6</span>&#125;,</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">var</span> insertData = d&#123;<span class="number">9</span>, <span class="number">9</span>, <span class="number">9</span>&#125;</div><div class="line">	<span class="comment">//插入单条</span></div><div class="line">	collection.Insert(insertData)</div><div class="line">	<span class="comment">//插入多条</span></div><div class="line">	collection.Insert(insertDatas...)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> d <span class="keyword">struct</span> &#123;</div><div class="line">	X <span class="keyword">int</span></div><div class="line">	Y <span class="keyword">int</span></div><div class="line">	Z <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 为了代码的可读性，没有验证错误error</span></div><div class="line">database.Collection(<span class="string">"user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(collection *mgo.Collection)</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> resDatas []d</div><div class="line">	<span class="keyword">var</span> resData d</div><div class="line">	query := collection.Find(bson.M&#123;<span class="string">"x"</span>: <span class="number">1</span>&#125;)</div><div class="line">	<span class="comment">//统计数目</span></div><div class="line">	count, _ := query.Count()</div><div class="line">	<span class="comment">//链式操作，类似函数式编程</span></div><div class="line">	query = query.Sort(<span class="string">"y"</span>).Skip(<span class="number">1</span>).Limit(<span class="number">2</span>)</div><div class="line">	<span class="comment">//查询所有</span></div><div class="line">	query.All(&amp;resDatas)</div><div class="line">	<span class="comment">//查询第一个</span></div><div class="line">	query.One(&amp;resData)</div><div class="line">	fmt.Println(resDatas, resData, count)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 为了代码的可读性，没有验证错误error</span></div><div class="line">database.Collection(<span class="string">"user"</span>, <span class="function"><span class="keyword">func</span><span class="params">(collection *mgo.Collection)</span></span> &#123;</div><div class="line">	collection.Remove(bson.M&#123;<span class="string">"x"</span>: <span class="number">1</span>&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><ul>
<li><p>修改第一条，修改此条全部内容</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">//struct 的键需要大写</span></div><div class="line">collection.Update(bson.M&#123;<span class="string">"x"</span>: <span class="number">3</span>&#125;, <span class="keyword">struct</span> &#123;</div><div class="line">	X <span class="keyword">int</span></div><div class="line">	Y <span class="keyword">int</span></div><div class="line">	Z <span class="keyword">int</span></div><div class="line">&#125;&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>修改第一条，修改此条部分内容</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">collection.Update(bson.M&#123;<span class="string">"x"</span>: <span class="number">0</span>&#125;, bson.M&#123;<span class="string">"$set"</span>: bson.M&#123;<span class="string">"y"</span>: <span class="number">1</span>&#125;&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>修改多条，只能修改每一条的部分内容</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">changeLog, err := collection.UpdateAll(bson.M&#123;<span class="string">"x"</span>: <span class="number">6</span>&#125;, bson.M&#123;<span class="string">"$set"</span>: bson.M&#123;<span class="string">"y"</span>: <span class="number">1</span>&#125;&#125;)</div><div class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">	fmt.Println(err.Error())</div><div class="line">&#125;</div><div class="line">fmt.Println(<span class="string">"Matched:"</span>, changeLog.Matched)</div><div class="line">fmt.Println(<span class="string">"Removed:"</span>, changeLog.Removed)</div><div class="line">fmt.Println(<span class="string">"Updated:"</span>, changeLog.Updated)</div><div class="line">fmt.Println(<span class="string">"UpsertedId:"</span>, changeLog.UpsertedId)</div><div class="line"><span class="comment">// 结果</span></div><div class="line">&gt; <span class="keyword">go</span> run test.<span class="keyword">go</span></div><div class="line">Matched: <span class="number">2</span></div><div class="line">Removed: <span class="number">0</span></div><div class="line">Updated: <span class="number">2</span></div><div class="line">UpsertedId: &lt;<span class="literal">nil</span>&gt;</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/并发编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/并发编程/" itemprop="url">
                  并发编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:44:57+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>Goroutine是Go并行设计的核心。goroutine说到底其实就是线程，但是它比线程更小，十几个goroutine可能体现在底层就是五六个线程，Go语言内部帮你实现了这些goroutine之间的内存共享。执行goroutine只需极少的栈内存(大概是4~5KB)，当然会根据相应的数据伸缩。也正因为如此，可同时运行成千上万个并发任务。goroutine比thread更易用、更高效、更轻便。</li>
<li>Goroutine奉行通过通讯来共享内存，而不是共享内存来通讯<h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> c <span class="keyword">struct</span> &#123;</div><div class="line">	word   <span class="keyword">string</span></div><div class="line">	wordId <span class="keyword">int</span></div><div class="line">	err    error</div><div class="line">	place  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	cpunum := runtime.NumCPU()</div><div class="line">	runtime.GOMAXPROCS(cpunum)</div><div class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> c, <span class="number">100</span>)</div><div class="line">	t1 := time.Now().Unix()</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">300</span>; i++ &#123;</div><div class="line">		<span class="keyword">go</span> test(i, ch)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">300</span>; i++ &#123;</div><div class="line">		<span class="keyword">select</span> &#123;</div><div class="line">		<span class="keyword">case</span> res := &lt;-ch:</div><div class="line">			fmt.Println(res)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	t2 := time.Now().Unix()</div><div class="line">	log.Println(t2, t1)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(i <span class="keyword">int</span>, ch <span class="keyword">chan</span> c)</span></span> &#123;</div><div class="line">	time.Sleep(time.Second)</div><div class="line">	res := c&#123;<span class="string">"test"</span>, i, <span class="literal">nil</span>, <span class="number">0</span>&#125;</div><div class="line">	ch &lt;- res</div><div class="line">	<span class="keyword">return</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h1><h2 id="操作符-lt"><a href="#操作符-lt" class="headerlink" title="操作符&lt;-"></a>操作符<code>&lt;-</code></h2><p>如果通过管道发送一个值，则将&lt;-作为二元操作符使用。通过管道接收一个值，则将其作为一元操作符使用:<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line">ic &lt;- <span class="number">3</span>        <span class="comment">// 往管道发送3</span></div><div class="line">work := &lt;-wc    <span class="comment">// 从管道接收一个指向Work类型值的指针</span></div></pre></td></tr></table></figure></p>
<h2 id="channel特点"><a href="#channel特点" class="headerlink" title="channel特点"></a>channel特点</h2><blockquote>
<ul>
<li>Channel是Goroutine沟通的桥梁，大部分是阻塞同步的</li>
<li>通过make创建，close关闭</li>
<li>channel是引用类型</li>
<li>可以使用for range来迭代不断的操作</li>
<li>可以设置单向或双向通道</li>
<li><p>可以设置缓存大小，在未被填满之前不会发生阻塞</p>
<h2 id="通道阻塞"><a href="#通道阻塞" class="headerlink" title="通道阻塞"></a>通道阻塞</h2><p>对于无缓冲的channel,<code>通道的发送/接收操作在对方准备好之前是阻塞</code></p>
</li>
<li><p>对于同一个通道，发送操作（协程或者函数中的），在接收者准备好之前是阻塞的：如果ch中的数据无人接收，就无法再给通道传入其他数据：新的输入无法在通道非空的情况下传入。所以发送操作会等待 ch 再次变为可用状态：就是通道值被接收时（可以传入变量）。</p>
</li>
<li>对于同一个通道，接收操作是阻塞的（协程或函数中的），直到发送者可用：如果通道中没有数据，接收者就阻塞了。<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</div><div class="line">    <span class="keyword">go</span> pump(ch1)       <span class="comment">// pump hangs</span></div><div class="line">    <span class="comment">// 只是接受结果一次，也就是说，下面的send方再插入一个1，2就插入不进去了，阻塞了</span></div><div class="line">    fmt.Println(&lt;-ch1) <span class="comment">// prints only 0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">pump</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; ; i++ &#123;</div><div class="line">        ch &lt;- i</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：0</span></div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="常见错误示例："><a href="#常见错误示例：" class="headerlink" title="常见错误示例："></a>常见错误示例：</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(in <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">    fmt.Println(&lt;-in)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    out := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</div><div class="line">    out &lt;- <span class="number">2</span></div><div class="line">    <span class="keyword">go</span> f1(out)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述例子会照成死锁，原因很简单，一般通讯的话，有两种情况</p>
<ul>
<li>没有缓冲时，需要最少<code>两个goroutine</code>准备好</li>
<li>有缓冲时，则是<code>goroutine - 中间缓冲层 - goroutine</code>之间的连接。</li>
</ul>
<h2 id="demo实例"><a href="#demo实例" class="headerlink" title="demo实例"></a>demo实例</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">// 使用make创建一个channel</span></div><div class="line">	channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		fmt.Println(<span class="string">"gogogo"</span>)</div><div class="line">		<span class="comment">// 向channel存数据</span></div><div class="line">		channel &lt;- <span class="literal">true</span></div><div class="line">		<span class="comment">// 关闭channel</span></div><div class="line">		<span class="built_in">close</span>(channel)</div><div class="line">	&#125;()</div><div class="line">	<span class="comment">// 迭代channel</span></div><div class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> channel &#123;</div><div class="line">		fmt.Println(v)</div><div class="line">	&#125;</div><div class="line">	fmt.Println(<span class="string">"this is base"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">gogogo</div><div class="line"><span class="literal">true</span></div><div class="line">this is base</div></pre></td></tr></table></figure>
<blockquote>
<p>由结果可以看出：先迭代完成才会进行下一步操作， 也就是说，迭代的过程是阻塞的，如果channel中没有值，迭代就会一直等待，一直等到它有值，<br>如果channel没有关闭，则会发生死锁（deadlock）</p>
<h2 id="带缓冲的channel"><a href="#带缓冲的channel" class="headerlink" title="带缓冲的channel"></a>带缓冲的channel</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">4</span>)</div><div class="line">	ch &lt;- <span class="string">"zhangsan1"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan2"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan3"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan4"</span></div><div class="line">	<span class="comment">// 如果加上这一行，则会死锁，是因为当超过缓冲区的时候，就成阻塞模式了</span></div><div class="line">	<span class="comment">//ch &lt;- "zhangsan5"</span></div><div class="line">	<span class="built_in">close</span>(ch)</div><div class="line">	fmt.Println(&lt;-ch)</div><div class="line">	fmt.Println(&lt;-ch)</div><div class="line">	fmt.Println(&lt;-ch)</div><div class="line">	fmt.Println(&lt;-ch)</div><div class="line">	fmt.Println(&lt;-ch)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果</span></div><div class="line">➜  first <span class="keyword">go</span> run helloworld.<span class="keyword">go</span></div><div class="line">zhangsan1</div><div class="line">zhangsan2</div><div class="line">zhangsan3</div><div class="line">zhangsan4</div><div class="line">         <span class="comment">// 此处为string零值</span></div></pre></td></tr></table></figure>
<p>可以看出带缓冲的channel略有不同。尽管已经close了，但我们依旧可以从中读出关闭前写入的3个值。第四次读取时，则会返回该channel类型的零值。向这类channel写入操作也会触发panic。</p>
<h2 id="channel常与range配合"><a href="#channel常与range配合" class="headerlink" title="channel常与range配合"></a>channel常与range配合</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</div><div class="line">	<span class="keyword">go</span> generate(ch)</div><div class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> ch &#123;</div><div class="line">		fmt.Printf(<span class="string">"%s\n"</span>, v)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	ch &lt;- <span class="string">"zhangsan1"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan2"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan3"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan4"</span></div><div class="line">	ch &lt;- <span class="string">"zhangsan5"</span></div><div class="line">	<span class="built_in">close</span>(ch)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</blockquote>
<h2 id="channel实际用途"><a href="#channel实际用途" class="headerlink" title="channel实际用途"></a>channel实际用途</h2><h3 id="可用作信号源"><a href="#可用作信号源" class="headerlink" title="可用作信号源"></a>可用作信号源</h3><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"Begin doing something!"</span>)</div><div class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		fmt.Println(<span class="string">"Doing something…"</span>)</div><div class="line">		<span class="built_in">close</span>(c)</div><div class="line">	&#125;()</div><div class="line">	&lt;-c</div><div class="line">	fmt.Println(<span class="string">"Done!"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="协同多个Goroutines"><a href="#协同多个Goroutines" class="headerlink" title="协同多个Goroutines"></a>协同多个Goroutines</h3><blockquote>
<p>同上，close channel还可以用于协同多个Goroutines，比如下面这个例子，我们创建了100个Worker Goroutine，这些Goroutine在被创建出来后都阻塞在”&lt;-start”上，直到我们在main goroutine中给出开工的信号：”close(start)”，这些goroutines才开始真正的并发运行起来。<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(start <span class="keyword">chan</span> <span class="keyword">bool</span>, index <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">        &lt;-start</div><div class="line">        fmt.Println(<span class="string">"This is Worker:"</span>, index)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">        start := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">        <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++ &#123;</div><div class="line">                <span class="keyword">go</span> worker(start, i)</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">close</span>(start)</div><div class="line">        <span class="keyword">select</span> &#123;&#125; <span class="comment">//deadlock we expected</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="唯一的ID服务"><a href="#唯一的ID服务" class="headerlink" title="唯一的ID服务"></a>唯一的ID服务</h3><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">newUniqueIDService</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">string</span></span> &#123;</div><div class="line">    id := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</div><div class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> counter <span class="keyword">int64</span> = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> &#123;</div><div class="line">            <span class="comment">// 无缓冲 -&gt; 阻塞</span></div><div class="line">            id &lt;- fmt.Sprintf(<span class="string">"%x"</span>, counter)</div><div class="line">            counter += <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;()</div><div class="line">    <span class="keyword">return</span> id</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    id := newUniqueIDService()</div><div class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</div><div class="line">        <span class="comment">// 这边取一个，id插入一个（自增）</span></div><div class="line">        fmt.Println(&lt;-id)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$ <span class="keyword">go</span> run testuniqueid.<span class="keyword">go</span></div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">8</span></div><div class="line"><span class="number">9</span></div></pre></td></tr></table></figure>
<h1 id="select"><a href="#select" class="headerlink" title="select"></a>select</h1><h2 id="select特点"><a href="#select特点" class="headerlink" title="select特点"></a>select特点</h2><blockquote>
<ul>
<li>可以处理一个或多个channel的发送与接收</li>
<li>同时有多个可用的channel时按随机顺序处理</li>
<li>可用空的select阻塞main函数</li>
<li>可设置超时<h2 id="惯用法：for-select"><a href="#惯用法：for-select" class="headerlink" title="惯用法：for/select"></a>惯用法：for/select</h2>我们在使用select时很少只是对其进行一次evaluation，我们常常将其与for {}结合在一起使用，并选择适当时机从for{}中退出。<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">for</span> &#123;</div><div class="line">    <span class="keyword">select</span> &#123;</div><div class="line">    <span class="keyword">case</span> x := &lt;- somechan:</div><div class="line">        <span class="comment">// … 使用x进行一些操作</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> y, ok := &lt;- someOtherchan:</div><div class="line">        <span class="comment">// … 使用y进行一些操作，</span></div><div class="line">        <span class="comment">// 检查ok值判断someOtherchan是否已经关闭</span></div><div class="line"></div><div class="line">    <span class="keyword">case</span> outputChan &lt;- z:</div><div class="line">        <span class="comment">// … z值被成功发送到Channel上时</span></div><div class="line"></div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="comment">// … 上面case均无法通信时，执行此分支</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="终结workers"><a href="#终结workers" class="headerlink" title="终结workers"></a>终结workers</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	ch, die := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>), <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</div><div class="line">		<span class="keyword">go</span> worker(die, i, ch)</div><div class="line">		ch &lt;- <span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">	time.Sleep(<span class="number">1</span> * time.Second)</div><div class="line">	<span class="comment">// 此处终结worker</span></div><div class="line">	<span class="built_in">close</span>(die)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(die <span class="keyword">chan</span> <span class="keyword">bool</span>, index <span class="keyword">int</span>, ch <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"Begin: This is Worker:"</span>, index)</div><div class="line">	<span class="keyword">for</span> &#123;</div><div class="line">		<span class="keyword">select</span> &#123;</div><div class="line">		<span class="keyword">case</span> &lt;-ch:</div><div class="line">			fmt.Println(<span class="string">"already worded:"</span>, index)</div><div class="line">		<span class="keyword">case</span> &lt;-die:</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="终结验证"><a href="#终结验证" class="headerlink" title="终结验证"></a>终结验证</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="comment">//"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(die <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span> &#123;</div><div class="line">    fmt.Println(<span class="string">"Begin: This is Worker"</span>)</div><div class="line">    <span class="keyword">for</span> &#123;</div><div class="line">        <span class="keyword">select</span> &#123;</div><div class="line">        <span class="comment">//case xx：</span></div><div class="line">        <span class="comment">//做事的分支</span></div><div class="line">        <span class="comment">// get channel message</span></div><div class="line">        <span class="keyword">case</span> &lt;-die:</div><div class="line">            fmt.Println(<span class="string">"Done: This is Worker"</span>)</div><div class="line">            <span class="comment">// send channel message</span></div><div class="line">            die &lt;- <span class="literal">true</span></div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    die := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</div><div class="line">    <span class="keyword">go</span> worker(die)</div><div class="line">    <span class="comment">// send channel message</span></div><div class="line">    die &lt;- <span class="literal">true</span></div><div class="line">    <span class="comment">// get channel message</span></div><div class="line">    &lt;-die</div><div class="line">    fmt.Println(<span class="string">"Worker goroutine has been terminated"</span>)</div><div class="line">&#125;</div><div class="line"><span class="string">``</span><span class="string">` </span></div><div class="line"></div><div class="line">#  等待goroutine完成</div><div class="line">使用`sync<span class="string">`包</span></div><div class="line">`<span class="string">``</span><span class="keyword">go</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">correct</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> wg sync.WaitGroup</div><div class="line">    wg.Add(<span class="number">5</span>)</div><div class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123; <span class="comment">// 使用局部变量</span></div><div class="line">            fmt.Print(n)</div><div class="line">            wg.Done()</div><div class="line">        &#125;(i)</div><div class="line">    &#125;</div><div class="line">    wg.Wait()</div><div class="line">    fmt.Println()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述只是等待goroutine完成，却没有进行通讯。有错误值也无法返回。所以说，最好还是使用channel<br>如果我们希望通讯，只需要在此基础上增加channel通讯即可<br>例：<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    people := []<span class="keyword">string</span>&#123;<span class="string">"Anna"</span>, <span class="string">"Bob"</span>, <span class="string">"Cody"</span>, <span class="string">"Dave"</span>, <span class="string">"Eva"</span>&#125;</div><div class="line">    match := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>) <span class="comment">// 为一个未匹配的发送操作提供空间</span></div><div class="line">    wg := <span class="built_in">new</span>(sync.WaitGroup)</div><div class="line">    wg.Add(<span class="built_in">len</span>(people))</div><div class="line">    <span class="keyword">for</span> _, name := <span class="keyword">range</span> people &#123;</div><div class="line">        <span class="keyword">go</span> Seek(name, match, wg)</div><div class="line">    &#125;</div><div class="line">    wg.Wait()</div><div class="line">    <span class="keyword">select</span> &#123;</div><div class="line">    <span class="keyword">case</span> name := &lt;-match:</div><div class="line">        fmt.Printf(<span class="string">"No one received %s’s message.\n"</span>, name)</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="comment">// 没有待处理的发送操作</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 函数Seek 发送一个name到match管道或从match管道接收一个peer，结束时通知wait group</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Seek</span><span class="params">(name <span class="keyword">string</span>, match <span class="keyword">chan</span> <span class="keyword">string</span>, wg *sync.WaitGroup)</span></span> &#123;</div><div class="line">    <span class="keyword">select</span> &#123;</div><div class="line">    <span class="keyword">case</span> peer := &lt;-match:</div><div class="line">        fmt.Printf(<span class="string">"%s sent a message to %s.\n"</span>, peer, name)</div><div class="line">    <span class="keyword">case</span> match &lt;- name:</div><div class="line">        <span class="comment">// 等待某个goroutine接收我的消息</span></div><div class="line">    &#125;</div><div class="line">    wg.Done()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="利用多核"><a href="#利用多核" class="headerlink" title="利用多核"></a>利用多核</h1><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</div><div class="line">    numcpu := runtime.NumCPU()</div><div class="line">    runtime.GOMAXPROCS(numcpu) <span class="comment">// 尝试使用所有可用的CPU</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/golang/函数，结构与接口/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/golang/函数，结构与接口/" itemprop="url">
                  函数，结构与接口
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:40:56+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="基本特点"><a href="#基本特点" class="headerlink" title="基本特点"></a>基本特点</h2><blockquote>
<ul>
<li>go函数不支持嵌套、重载、和默认参数</li>
<li>但支持一下特性<ul>
<li>无需声明原型</li>
<li>不定长度参数</li>
<li>多返回值</li>
<li>命名返回值参数</li>
<li>匿名函数</li>
<li>闭包</li>
</ul>
</li>
<li>定义函数使用关键之func，且左大括号不能另起一行</li>
<li>函数可以作为一种类型使用<h2 id="书写格式"><a href="#书写格式" class="headerlink" title="书写格式"></a>书写格式</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span> <span class="title">int</span></span> &#123;</div><div class="line">	a := <span class="number">2</span></div><div class="line">	<span class="keyword">return</span> a</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 多返回值，多参数不同类型</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">C</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	a = <span class="number">2</span></div><div class="line">	b = <span class="string">"zhangsan"</span></div><div class="line">	<span class="keyword">return</span> a, b</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 多参数相同类型</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">D</span><span class="params">(a, b, c <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	a = <span class="number">1</span></div><div class="line">	<span class="keyword">return</span> a</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 函数定义时就已经定义了a,b,c</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">E</span><span class="params">()</span> <span class="params">(a, b, c <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	a, b, c = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span></div><div class="line">	<span class="keyword">return</span> a, b, c</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 不定参数</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">F</span><span class="params">(b <span class="keyword">string</span>, a ...<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h2><p>需要注意一点：<code>Go函数的参数传递方式是值传递</code><br>也就是说：</p>
<ul>
<li>如果参数本身是值类型，则复制一个值传递,如<code>struct</code></li>
<li>如果参数本身是指针类型，则复制一个指针,如<code>slice</code></li>
<li>所以，一般大的struct需要传递struct的指针</li>
<li>一般对于slice则复制一个slice即可<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">// 切片类型</span></div><div class="line">	a := []<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">	A(a)</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 由于切片类型是引用传递，所以函数内部改变，外部也随之</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">(a []<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	a[<span class="number">1</span>] = <span class="number">2</span></div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 结果：</span></div><div class="line">[<span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>]</div><div class="line">[<span class="number">2</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span>]</div><div class="line">[<span class="number">2</span> <span class="number">2</span> <span class="number">4</span> <span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>如果需要正常传递指针<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">// 切片类型</span></div><div class="line">	a := <span class="number">1</span></div><div class="line">	fmt.Println(a)</div><div class="line">	A(&amp;a)</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 传递一个指针</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">(a *<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	*a = <span class="number">2</span></div><div class="line">	<span class="comment">// 打印a的值</span></div><div class="line">	fmt.Println(a)</div><div class="line">	<span class="comment">// 打印指针a对应的值</span></div><div class="line">	fmt.Println(*a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 结果：</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">0xc82000a2c0</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	f := clause(<span class="number">20</span>)</div><div class="line">	fmt.Println(f(<span class="number">2</span>))</div><div class="line">	fmt.Println(f(<span class="number">5</span>))</div><div class="line">&#125;</div><div class="line"><span class="comment">// 匿名函数</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">clause</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	fmt.Println(&amp;x)</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">		fmt.Println(&amp;x)</div><div class="line">		<span class="keyword">return</span> x + y</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//结果：</span></div><div class="line"><span class="number">0xc82000a2c0</span></div><div class="line"><span class="number">0xc82000a2c0</span></div><div class="line"><span class="number">22</span></div><div class="line"><span class="number">0xc82000a2c0</span></div><div class="line"><span class="number">25</span></div><div class="line"><span class="comment">// 可以看出，三次地址是相同的，也就是说用的是同一个变量</span></div><div class="line"></div><div class="line"><span class="comment">//但是，如果换一种写法</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := <span class="number">3</span></div><div class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">		fmt.Println(&amp;a)</div><div class="line">		<span class="keyword">return</span> x * a</div><div class="line">	&#125;</div><div class="line">	fmt.Println(&amp;a)</div><div class="line">	fmt.Println(f(<span class="number">4</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 结果：</span></div><div class="line"><span class="number">0xc820064028</span></div><div class="line"><span class="number">0xc820064028</span></div><div class="line"><span class="number">12</span></div><div class="line"><span class="comment">// 也就是说,用的是同一个变量，并没有什么变量传递问题</span></div></pre></td></tr></table></figure>
<h2 id="不定参数"><a href="#不定参数" class="headerlink" title="不定参数"></a>不定参数</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 代码：</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	slice := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div><div class="line">	test(slice...)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(args ...<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> args &#123;</div><div class="line">		fmt.Println(k, v)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 运行：</span></div><div class="line">/chimps/web_back/<span class="keyword">go</span>/src/full_text_search <span class="keyword">go</span> run test.<span class="keyword">go</span></div><div class="line"><span class="number">0</span> <span class="number">1</span></div><div class="line"><span class="number">1</span> <span class="number">2</span></div><div class="line"><span class="number">2</span> <span class="number">3</span></div><div class="line"><span class="number">3</span> <span class="number">4</span></div></pre></td></tr></table></figure>
<h1 id="Defer"><a href="#Defer" class="headerlink" title="Defer"></a>Defer</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>类似于析构函数，在函数体执行结束之后按照调用顺序的<code>相反顺序</code>逐个执行</li>
<li>即使函数发生严重错误也会执行</li>
<li>支持匿名函数的调用</li>
<li>常用与资源清理、文件关闭、解锁以及记录时间等操作</li>
<li>通过与匿名函数配合可在return之后修改函数计算结果</li>
<li>如果函数体内某个变量作为defer时匿名函数的参数，则在定义defer时已经获得了拷贝，否则则是引用某个变量的地址</li>
<li>Go没有异常机制，但有panic/revover模式来处理错误</li>
<li>panic可以在任何地方引发，但recover只有在defer调用的函数中有效</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">//示例：</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	A()</div><div class="line">	B()</div><div class="line">	C()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"this is func A"</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"recover in B"</span>)</div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line">	<span class="built_in">panic</span>(<span class="string">"panic in B"</span>)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">C</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"this is func C"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">this is <span class="function"><span class="keyword">func</span> <span class="title">A</span></span></div><div class="line"><span class="title">recover</span> <span class="title">in</span> <span class="title">B</span></div><div class="line"><span class="title">this</span> <span class="title">is</span> <span class="title">func</span> <span class="title">C</span></div></pre></td></tr></table></figure>
<h2 id="panic"><a href="#panic" class="headerlink" title="panic"></a>panic</h2><blockquote>
<p>　　panic 是用来表示非常严重的不可恢复的错误的。在Go语言中这是一个内置函数，接收一个interface{}类型的值（也就是任何值了）作为参数。panic的作用就像我们平常接触的异常。不过Go可没有try…catch，所以，panic一般会导致程序挂掉（除非recover）。所以，Go语言中的异常，那真的是异常了。你可以试试，调用panic看看，程序立马挂掉，然后Go运行时会打印出调用栈。<br>　　但是，关键的一点是，即使函数执行的时候panic了，函数不往下走了，运行时并不是立刻向上传递panic，而是到defer那，等defer的东西都跑完了，panic再向上传递。所以这时候 defer 有点类似 try-catch-finally 中的 finally。<br>　　panic就是这么简单。抛出个真正意义上的异常。</p>
<h2 id="recover"><a href="#recover" class="headerlink" title="recover"></a>recover</h2><p>　　上面说到，panic的函数并不会立刻返回，而是先defer，再返回。这时候（defer的时候），如果有办法将panic捕获到，并阻止panic传递，那就异常的处理机制就完善了。<br>　　Go语言提供了recover内置函数，前面提到，一旦panic，逻辑就会走到defer那，那我们就在defer那等着，调用recover函数将会捕获到当前的panic（如果有的话），被捕获到的panic就不会向上传递了，于是，世界恢复了和平。你可以干你想干的事情了。<br>　　不过要注意的是，recover之后，逻辑并不会恢复到panic那个点去，函数还是会在defer之后返回</p>
</blockquote>
<h1 id="结构struct"><a href="#结构struct" class="headerlink" title="结构struct"></a>结构struct</h1><h2 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h2><blockquote>
<ul>
<li>使用 type <name> struct{}定义</name></li>
<li>支持匿名结构，可用做成员或成员变量</li>
<li>匿名结构也可用于map的值</li>
<li>可以使用字面值对结构进行初始化</li>
<li>允许直接通过指针读取结构成员</li>
<li>相同类型的成员可以进行直接拷贝赋值</li>
<li>支持 == 与 != 比较运算符，但不支持&gt;或&lt;</li>
<li>支持匿名字段，本质上是定义了以某个类型名为名称的字段</li>
<li>嵌入结构作为匿名字段看起来像继承，但不是继承</li>
<li>可以使用匿名字段指针<h2 id="使用格式"><a href="#使用格式" class="headerlink" title="使用格式"></a>使用格式</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 一般格式</span></div><div class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := person&#123;&#125;</div><div class="line">	a.Name = <span class="string">"zhangsan"</span></div><div class="line">	a.Age = <span class="number">12</span></div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 使用字面值进行初始化</span></div><div class="line">a := person&#123;</div><div class="line">	Name: <span class="string">"zhangsna"</span>,</div><div class="line">	Age:  <span class="number">15</span>,</div><div class="line">&#125;</div><div class="line">fmt.Println(a)</div><div class="line"><span class="comment">//结果：</span></div><div class="line">&#123;zhangsna <span class="number">15</span>&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>作为函数参数时，按值传递<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">func main() &#123;</div><div class="line">	a := person&#123;</div><div class="line">		Name: &quot;zhangsna&quot;,</div><div class="line">		Age:  15,</div><div class="line">	&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">	A(a)</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func A(per person) &#123;</div><div class="line">	per.Name = &quot;lisi&quot;</div><div class="line">	fmt.Println(per)</div><div class="line">&#125;</div><div class="line">//结果：</div><div class="line">&#123;zhangsna 15&#125;</div><div class="line">&#123;lisi 15&#125;</div><div class="line">&#123;zhangsna 15&#125;</div></pre></td></tr></table></figure></p>
<p>一般情况下，我们为了节省内存空间，都使用引用传值，引用传值有两种方案<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := person&#123;</div><div class="line">		Name: <span class="string">"zhangsna"</span>,</div><div class="line">		Age:  <span class="number">15</span>,</div><div class="line">	&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">	A(&amp;a)</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">(per *person)</span></span> &#123;</div><div class="line">	per.Name = <span class="string">"lisi"</span></div><div class="line">	fmt.Println(per)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 但是，如果这样的话太麻烦，一般情况下我们都这样使用：</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := &amp;person&#123;</div><div class="line">		Name: <span class="string">"zhangsna"</span>,</div><div class="line">		Age:  <span class="number">15</span>,</div><div class="line">	&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">	A(a)</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">(per *person)</span></span> &#123;</div><div class="line">    <span class="comment">// 我们可以直接对结构的指针进行这样的操作</span></div><div class="line">	per.Name = <span class="string">"lisi"</span></div><div class="line">	fmt.Println(per)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">&amp;&#123;zhangsna <span class="number">15</span>&#125;</div><div class="line">&amp;&#123;lisi <span class="number">15</span>&#125;</div><div class="line">&amp;&#123;lisi <span class="number">15</span>&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h2><blockquote>
<p>在go语言的一个struct中，除了变量名和类型之外，还可以选择性的增加一些tag：tag可以在类型的后面，用双引号(double quote)或重音(backquote/grave accent)表示的字符串。这些符号能被用来做文档或重要的标签。<br>tag里面的内容在正常编程中没有作用。只有在使用反射的时候才有作用。反射的包可以让我们在运行时获取到变量的类型，属性以及方法。比如reflect.TypeOf()就可以返回一个变量的类型。如果是一个struct类型，可以按照每一个变量索引，来查询每一个的tag。</p>
</blockquote>
<p>例：<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="comment">// 与json中的user_id对应，bson中的user_id对应</span></div><div class="line">    UserId   <span class="keyword">int</span>    <span class="string">`json:"user_id" bson:"user_id"`</span></div><div class="line">    UserName <span class="keyword">string</span> <span class="string">`json:"user_name" bson:"user_name"`</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="匿名结构，匿名字段"><a href="#匿名结构，匿名字段" class="headerlink" title="匿名结构，匿名字段"></a>匿名结构，匿名字段</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := &amp;<span class="keyword">struct</span> &#123;</div><div class="line">		Name <span class="keyword">string</span></div><div class="line">		Age  <span class="keyword">int</span></div><div class="line">	&#125;&#123;</div><div class="line">		Name: <span class="string">"jobs"</span>,</div><div class="line">		Age:  <span class="number">22</span>,</div><div class="line">	&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 另一种匿名结构</span></div><div class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</div><div class="line">	Name    <span class="keyword">string</span></div><div class="line">	Age     <span class="keyword">int</span></div><div class="line">	contact <span class="keyword">struct</span> &#123;</div><div class="line">		Phone, City <span class="keyword">string</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := person&#123;Name: <span class="string">"zhangsan"</span>, Age: <span class="number">22</span>&#125;</div><div class="line">	a.contact.Phone = <span class="string">"123123123"</span></div><div class="line">	a.contact.City = <span class="string">"beijing"</span></div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">&#123;zhangsan <span class="number">22</span> &#123;<span class="number">123123123</span> beijing&#125;&#125;</div><div class="line"></div><div class="line"><span class="comment">// 匿名字段,</span></div><div class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</div><div class="line">	<span class="keyword">string</span></div><div class="line">	<span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 顺序必须一致</span></div><div class="line">	a := person&#123;<span class="string">"zhangsan"</span>, <span class="number">22</span>&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><blockquote>
<p>结构类型的比较，是看结构下每个字段的值是否相同，是否是同一个结构类型<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</div><div class="line">	<span class="keyword">string</span></div><div class="line">	<span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := person&#123;<span class="string">"zhangsan"</span>, <span class="number">22</span>&#125;</div><div class="line">	b := person&#123;<span class="string">"zhangsan"</span>, <span class="number">22</span>&#125;</div><div class="line">	fmt.Println(a == b)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line"><span class="literal">true</span></div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="组合（继承）"><a href="#组合（继承）" class="headerlink" title="组合（继承）"></a>组合（继承）</h2><blockquote>
<p>这里并不是继承，而是将大家都用的结构提取出来罢了<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> humen <span class="keyword">struct</span> &#123;</div><div class="line">	Sex <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> teacher <span class="keyword">struct</span> &#123;</div><div class="line">	humen</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</div><div class="line">	humen</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Age  <span class="keyword">int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">// 一般都是用这种模式</span></div><div class="line">	a := teacher&#123;Name: <span class="string">"zhangsan"</span>, Age: <span class="number">22</span>, humen: humen&#123;Sex: <span class="number">0</span>&#125;&#125;</div><div class="line">	b := student&#123;Name: <span class="string">"lisi"</span>, Age: <span class="number">22</span>, humen: humen&#123;Sex: <span class="number">1</span>&#125;&#125;</div><div class="line">	<span class="comment">// 可以直接这样写，十分方便</span></div><div class="line">	a.Sex = <span class="number">13</span></div><div class="line">	<span class="comment">// 当然也可以这样写,在命名冲突时，这样写是十分有用的</span></div><div class="line">	a.humen.Sex = <span class="number">13</span></div><div class="line">	b.Sex = <span class="number">100</span></div><div class="line">	fmt.Println(a, b)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><blockquote>
<p>一般使用格式<br><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	a := A&#123;Name: <span class="string">"lisi"</span>&#125;</div><div class="line">	fmt.Println(a)</div><div class="line">	a.Print()</div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *A)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;</div><div class="line">	a.Name = <span class="string">"zhangsan"</span></div><div class="line">	fmt.Println(a)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果</span></div><div class="line">&#123;lisi&#125;</div><div class="line">&amp;&#123;zhangsan&#125;</div><div class="line">&#123;zhangsan&#125;</div></pre></td></tr></table></figure></p>
<p>给普通变量增加方法</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> TZ <span class="keyword">int</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> a TZ</div><div class="line">	a.Print()</div><div class="line">&#125;</div><div class="line"><span class="comment">// a *TZ作为函数的第一个且必须的参数，由此来绑定方法和变量（对象）</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *TZ)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"TZ"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// 结果：</span></div><div class="line">TZ</div></pre></td></tr></table></figure>
<blockquote>
<p>对私有变量的访问权限（私有变量的范围是本包）</p>
<h1 id="接口interface"><a href="#接口interface" class="headerlink" title="接口interface"></a>接口interface</h1><h2 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h2><ul>
<li>接口是一个或多个方法签名的集合</li>
<li>只要某个类型拥有该接口的所有方法签名，即算实现该接口，无需显示声明实现了哪个接口，这称为Structural Typing</li>
<li>接口只有方法声明，没有实现，没有数据字段</li>
<li>接口可以匿名嵌入其他接口，或嵌入到结构中</li>
<li>将对象赋值给接口时，会发生拷贝，而接口内部存储的是指向这个复制品的指针，既无法修改复制品的状态，也无法获取指针</li>
<li>只有当接口存储的接口类型和对象都为nil时，接口才等于nil</li>
<li>接口调用不会做receiver的自动转换</li>
<li>接口同样支持匿名字段方法</li>
<li>接口也可实现类似OOP中的多态</li>
<li>空接口可以作为任何类型数据的容器<h2 id="实现一个接口"><a href="#实现一个接口" class="headerlink" title="实现一个接口"></a>实现一个接口</h2><figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="keyword">type</span> USB <span class="keyword">interface</span> &#123;</div><div class="line">	Name() <span class="keyword">string</span></div><div class="line">	Connect()</div><div class="line">&#125;</div><div class="line"><span class="keyword">type</span> PhoneConnecter <span class="keyword">struct</span> &#123;</div><div class="line">	name <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pc PhoneConnecter)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> pc.name</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pc PhoneConnecter)</span> <span class="title">Connect</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(pc.name)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> a USB</div><div class="line">	a = PhoneConnecter&#123;<span class="string">"PhoneConnecter"</span>&#125;</div><div class="line">	a.Connect()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="interface变量存储的类型"><a href="#interface变量存储的类型" class="headerlink" title="interface变量存储的类型"></a>interface变量存储的类型</h2><blockquote>
<p>　　我们知道interface的变量里面可以存储任意类型的数值(该类型实现了interface)。那么我们怎么反向知道这个变量里面实际保存了的是哪个类型的对象呢？目前常用的有两种方法：</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/进程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/进程管理/" itemprop="url">
                  进程管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:18:51+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进程查看"><a href="#进程查看" class="headerlink" title="进程查看"></a>进程查看</h1><h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><ul>
<li><p>常用组合之一 aux        </p>
<blockquote>
<p>查看当前系统所有运行的进程<br>-a     显示前台所有进程<br>-u    显示用户名<br>-x    显示后台进程<br>user： 用户名</p>
<ul>
<li>pid：    进程id PID</li>
<li>%CPU    cpu占用百分比</li>
<li>%MEM    内存占用百分比</li>
<li>VSZ    虚拟内存占用量        KB</li>
<li>RSS    固定内存占有量      kb</li>
<li>tty    登录终端    <ul>
<li>tty1-7 本地终端</li>
<li>1-6 字符 </li>
<li>7图形    pts/0-5 alt+F1-F7                </li>
</ul>
</li>
<li>stat<ul>
<li>S：睡眠    </li>
<li>D：不可唤醒</li>
<li>R：运行</li>
<li>T：停止</li>
<li>Z：僵死</li>
<li>W：进入内存交换    </li>
<li>X：死掉的进程     </li>
<li>&lt;:高优先级    </li>
<li>N：低优先级    </li>
<li>L：被锁进内存    </li>
<li>s：含子进程    </li>
<li>+：位于后台    </li>
<li>l：多线程</li>
</ul>
</li>
<li>start    进程触发时间</li>
<li>time        占用cpu时间</li>
<li>command    进程本身</li>
</ul>
</blockquote>
</li>
<li><p>常用组合之二 -ef</p>
<blockquote>
<ul>
<li>-e 显示所有进程</li>
<li>-f 显示详细信息</li>
<li>-F 显示完整格式的进程信息</li>
<li>-H 以层级结构显示进程信息</li>
</ul>
</blockquote>
</li>
<li>常用组合之三 -efH</li>
<li>常用组合之四 -eo axo<blockquote>
<ul>
<li>o field1,field2…<br>自定义要显示的字段，以逗号分隔<br>常用的field:pid,ni,pri,pcup,stat,comm,tty,ppid<ul>
<li>ni: nice值；（优先级）</li>
<li>pri：priority 优先级；</li>
<li>rtprio:real time piority,实时优先级；<br>例：<code>ps axo pid,pri,comm</code><h2 id="pgrep-pkill命令"><a href="#pgrep-pkill命令" class="headerlink" title="pgrep pkill命令"></a>pgrep pkill命令</h2></li>
</ul>
</li>
<li>英文释义：pgrep, pkill - look up or signal processes based on name and other attributes</li>
</ul>
</blockquote>
</li>
<li>格式：pgrep [options] pattern<ul>
<li>-u uid:effective user(以谁的身份启动的)</li>
<li>-U uid:real user</li>
<li>-t TERMINAL:与指定终端相关的的进程</li>
<li>-l 显示进程名</li>
<li>-a 显示完整格式的进程名</li>
<li>-P 显示进程的子进程<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">实例：</div><div class="line">ps -aux | grep swoole #找到swoole进程</div><div class="line">或者：</div><div class="line">ps -efH | grep swoole #找到swoole进程</div><div class="line">找到进程号：如2257</div><div class="line">pgrep -P 2257</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="uptime（效果和top第一行相同）"><a href="#uptime（效果和top第一行相同）" class="headerlink" title="uptime（效果和top第一行相同）"></a>uptime（效果和top第一行相同）</h2><p>过去1分钟，5分钟，10分钟cpu</p>
<h2 id="pstree-查看进程树"><a href="#pstree-查看进程树" class="headerlink" title="pstree    查看进程树"></a>pstree    查看进程树</h2><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><blockquote>
<ul>
<li>第一行：uptime信息（连敲l命令可开启或关闭第一行）<ul>
<li>系统当前时间</li>
<li>系统持续时间</li>
<li>登录用户，1,5,15分钟之前的平均负载</li>
</ul>
</li>
<li>第二行：进程总数</li>
<li>第三行： CPU占用率        <ul>
<li>us 用户空间</li>
<li>sy 内核空间</li>
<li>ni 调整nice值后，多占用空间</li>
<li>id 空闲时间比例</li>
<li>hi 处理硬件中断所需要时间</li>
<li>si 处理软件中断所需要时间</li>
<li>cs 处理上下文（进程）切换所需要时间</li>
<li>st 虚拟化技术占用的cpu</li>
</ul>
</li>
<li>第四行：内存使用：    <ul>
<li>VSZ 虚拟内存集</li>
<li>RSS 常驻内存集</li>
<li>SHM 共享内存集（share memory）</li>
</ul>
</li>
<li>第五行：swap使用</li>
<li>字段： PID，USER，PR（优先级），NI（nice优先级），VIRT（虚拟内存），RES（物理内存），SHR（），S（状态），%CPU,%MEM(内存占用)，TIME+（系统调用总时间），COMMAND（进程名称）</li>
<li>操作命令        <ul>
<li>M    内存排序</li>
<li>P    CPU排序</li>
<li>T 累计占用CPU时间排序</li>
<li>q    退出</li>
<li>s 修改刷新时间间隔</li>
<li>k 终止指定的命令</li>
</ul>
</li>
<li>选项：<ul>
<li>-d # ;更改刷新时间</li>
<li>-b 以批处理方式显示</li>
<li>-n #；显示多少批次<h2 id="htop-top升级版"><a href="#htop-top升级版" class="headerlink" title="htop top升级版"></a>htop top升级版</h2></li>
</ul>
</li>
<li>选项<ul>
<li>-d #:指定延迟时间加载</li>
<li>-u UserName:仅显示指定用户的进程</li>
<li>-s COLUME:以指定字段进行排序</li>
</ul>
</li>
<li>子命令<ul>
<li>l：显示选定的进程打开的文件列表</li>
<li>s：跟踪选定的进程的系统调用</li>
<li>t：以层级结构显示个进程状态</li>
<li>a：将选定的进程绑定至某指定的CPU核心<h2 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h2></li>
</ul>
</li>
<li>概要： Report virtual memory statistics</li>
<li>格式： vmstat [options] [delay [count]] </li>
<li>procs <ul>
<li>r：等待运行的进程个数，CPU上等待运行的队列长度</li>
<li>b：处于不可中断睡眠的进程个数，被阻塞的任务队列的长度</li>
</ul>
</li>
<li>memory<ul>
<li>swpd：交换内存使用总量</li>
<li>free：空闲的物理内存总量</li>
<li>buffer：用户buffer的内存总量</li>
<li>cache：用户cache的内存总量</li>
</ul>
</li>
<li>swap（交换分区）<ul>
<li>si：数据进入swap中的数据速率（kb/s）</li>
<li>so：数据离开swap中的数据速率（kb/s）</li>
</ul>
</li>
<li>io<ul>
<li>bi：从设备中读入数据到系统的速度（kb/s）</li>
<li>bo：保存数据到块设备的速率（kb/s）</li>
</ul>
</li>
<li>system<ul>
<li>in：每秒产生的中断次数</li>
<li>cs：每秒产生的上下文切换次数</li>
<li>（上面这2个值越大，会看到由内核消耗的CPU时间会越多）</li>
</ul>
</li>
<li>CPU<ul>
<li>us：用户进程消耗的CPU时间百分比（us 的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超过50% 的使用，那么我们就该考虑优化程序算法或者进行加速了）（user）</li>
<li>sy：内核进程消耗的CPU时间百分比（system）</li>
<li>id：空闲（idle）</li>
<li>wa：IO等待消耗的CPU时间百分比（ wa 的值高时，说明IO等待比较严重，这可能是由于磁盘大量作随机访问造成，也有可能是磁盘的带宽出现瓶颈(块操作)。）（wait）</li>
</ul>
</li>
<li>选项<ul>
<li>-s：显示内存统计数据<h2 id="pmap"><a href="#pmap" class="headerlink" title="pmap"></a>pmap</h2></li>
</ul>
</li>
<li>概要：pmap命令用于报告进程的内存映射关系，是Linux调试及运维一个很好的工具。</li>
<li>格式：pmap [options] pid […]</li>
<li>选项<ul>
<li>-x：查看详细信息</li>
</ul>
</li>
<li>另一种查看方式：cat /proc/PID/maps<h2 id="pidof"><a href="#pidof" class="headerlink" title="pidof"></a>pidof</h2></li>
<li>概要：查看pid</li>
<li>示例：<code>pidof nginx</code><h2 id="dstat"><a href="#dstat" class="headerlink" title="dstat"></a>dstat</h2></li>
<li>选项<ul>
<li>-c：显示CPU系统占用，用户占用，空闲，等待，中断，软件中断等信息。 </li>
<li>-C：当有多个CPU时候，此参数可按需分别显示cpu状态，例：-C 0,1 是显示cpu0和cpu1的信息。 </li>
<li>-d：显示磁盘读写数据大小。 </li>
<li>-D hda,total：include hda and total。 </li>
<li>-n：显示网络状态。（network）</li>
<li>-N eth1,total：有多块网卡时，指定要显示的网卡。 </li>
<li>-l：显示系统负载情况。</li>
<li>-m：显示内存使用情况。 </li>
<li>-g：显示页面使用情况。（从内存写入磁盘，从磁盘写入内存）</li>
<li>-p：显示进程状态。(process)</li>
<li>-s：显示交换分区使用情况。(swapped) </li>
<li>-S：类似D/N。 </li>
<li>-r：I/O请求情况。 </li>
<li>-y：系统状态。 </li>
<li>–ipc：显示ipc消息队列，信号等信息。</li>
<li>–socket：用来显示tcp udp端口状态。 </li>
<li>-a：此为默认选项，等同于-cdngy。</li>
<li>-v：等同于 -pmgdsc -D total。 </li>
<li>–tcp</li>
<li>–udp</li>
<li>–raw</li>
<li>–top-cpu：最消耗cpu</li>
<li>–top-io：最消耗磁盘io</li>
<li>–top-mem：最消耗内存</li>
<li>–top-lantency：延迟最大的进程<h2 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h2></li>
</ul>
</li>
<li>概要：用于向进程发信号，已实现进程的管理（send a signal to a process）</li>
<li>格式：kill(选项)(参数)</li>
<li>每个信号的标示方式有三种  <ul>
<li>信号的数字标识</li>
<li>信号的完整名称</li>
<li>信号的简写名称</li>
</ul>
</li>
<li>向进程发信号<ul>
<li>kill[-s signal|-SIGNAL] pid …</li>
<li>常用信号<ol>
<li>（1号）SIGHUP：无需关闭进程而让其重读配置文件</li>
<li>（2号）SIGINT：终止正在运行的进程，相当于ctrl+c</li>
<li>（9号）SIGKILL：杀死进行中的进程</li>
<li>（15号）SIGTREM：终止运行中的进程</li>
<li>（18号）SIGCONT：继续</li>
<li>（19号）SIGSTOP：停止<h2 id="killall"><a href="#killall" class="headerlink" title="killall"></a>killall</h2></li>
</ol>
</li>
</ul>
</li>
<li>概要：kill processes by name</li>
<li>格式：kill [signal] program</li>
</ul>
</blockquote>
<h2 id="4-进程管理-终止进程"><a href="#4-进程管理-终止进程" class="headerlink" title="4    进程管理        终止进程"></a>4    进程管理        终止进程</h2><pre><code>ps   aux    组合使用
kill  PID        结束单个进程  结束进程
-9  强制         
 pstree
killall  -9   进程名        结束一类进程
pkill    -9   进程名
w            判断登录用户
pkill  -9  -t  终端号    把某个终端登录的用户踢出
pkill  -9  -t tty     把本地登录终端1登录用户踢出
</code></pre><h1 id="2-linux服务管理"><a href="#2-linux服务管理" class="headerlink" title="2    linux服务管理"></a>2    linux服务管理</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><pre><code>1）系统默认安装的服务            
2）源码包安装的服务
</code></pre><p>（一）系统默认安装的服务</p>
<h2 id="确定服务分类"><a href="#确定服务分类" class="headerlink" title="确定服务分类"></a>确定服务分类</h2><pre><code>chkconfig  --list        查看服务的自启动状态
    运行级别：0-6
        0    关机
        1    单用户模式
        2    不完全多用户，不包含NFS服务  无网络登录
        3    完全多用户    字符界面   
        4    未分配
        5    图形界面
        6    重启
        init  0     halt 关机         init 5  startx     init 3
        init  6    重启  init(初始化)
        runlevel            查询系统当前运行级别
        vi  /etc/inittab
</code></pre><h2 id="独立的服务器管理"><a href="#独立的服务器管理" class="headerlink" title="独立的服务器管理"></a>独立的服务器管理</h2><p>1）启动<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/etc/rc.d/init.d/服务名   start|stop|restart|status</div><div class="line">/etc/rc.d/init.d/httpd  start</div><div class="line">service   服务名   start|stop|restart|status</div></pre></td></tr></table></figure></p>
<p>2)自启动<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">chkconfig  --level  2345  服务名  on|off</div><div class="line">vi  /etc/rc.local----&gt;/etc/rc.d/rc.local</div><div class="line">/etc/rc.d/init.d/httpd  start</div></pre></td></tr></table></figure></p>
<h2 id="ntsysv"><a href="#ntsysv" class="headerlink" title="ntsysv"></a>ntsysv</h2><pre><code>所有系统默认安装服务都可以使用ntsysv命令进行自启动管理
（二）源码包安装的服务
1源码包安装的服务            
    1）绝对路径启动
        /usr/local/apache2/bin/apachectl  start 
    2)自启动
        vi /etc/rc.local
        /usr/local/apache2/bin/apachectl  start
</code></pre><h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>服务管理：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">RPM包安装服务</div><div class="line">	独立的服务</div><div class="line">		启动：	</div><div class="line">			/etc/rc.d/init.d/服务名  start</div><div class="line">			service  服务名  start</div><div class="line"></div><div class="line">		自启动：</div><div class="line">			chkconfig  --level  2345  服务名  on|off</div><div class="line">			vi  /etc/rc.local		推荐</div><div class="line">				/etc/rc.d/init.d/httpd  start</div><div class="line">源码包服务</div><div class="line">	启动</div><div class="line">			/usr/local/服务名/bin/服务名二进制执行文件  start</div><div class="line">	自启动</div><div class="line">			vi  /etc/rc.local</div><div class="line">				/usr/local/apache2/bin/apachectl  start</div></pre></td></tr></table></figure></p>
<h1 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h1><pre><code>echo  11  &gt;&gt;  /root/aa        在aa文件中追加11.一会定时任务验证用
循环定时任务                        
crontab  -e        编辑定时任务
*  *  *  *  *  命令
10  *  31  *  *  命令
10  *  *  *  *  命令
5  4  *  5,7,10  *  命令
*/10  *  *  *  *  命令
第一个：一小时中第几分钟        0-59
第二个：一天中第几个小时        0-23
第三个：一个月中第几天        1-31
第四个：一年第几个月            1-12
第五个：一周中星期几            0-6        
crontab  -l        查看系统定时任务
crontab  -r          删除定时任务
</code></pre><p>注意事项：</p>
<blockquote>
<p>选项都不能为空，必须填入，不知道的值使用通配符<em>表示任何时间<br>每个时间字段都可以指定多个值，不连续的值用,间隔，连续的值用-间隔<br>间隔固定时间执行书写为</em>/n格式<br>命令应该给出绝对路径<br>   星期几和第几天不能同时出现<br>   最小时间范围是分钟，最大时间范围是月</p>
<h1 id="查看硬件相关信息："><a href="#查看硬件相关信息：" class="headerlink" title="查看硬件相关信息："></a>查看硬件相关信息：</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cat /proc/cpuinfo 文件保存了CPU设备信息  </div><div class="line">dmesg				查看系统启动信息</div><div class="line">cat  /var/log/dmesg		系统启动信息日志		</div><div class="line">dmesg | grep eth0		查看eth0信息</div><div class="line">dmesg | grep CPU		查看cpu信息</div></pre></td></tr></table></figure>
</blockquote>
<h1 id="进程前后台切换"><a href="#进程前后台切换" class="headerlink" title="进程前后台切换"></a>进程前后台切换</h1><h2 id="前后台切换"><a href="#前后台切换" class="headerlink" title="前后台切换"></a>前后台切换</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">command &amp;   //将进程放在后台执行</div><div class="line">ctrl-z      //暂停当前进程 并放入后台</div><div class="line">jobs        //查看当前后台任务</div><div class="line">bg          //将任务转为后台执行</div><div class="line">fg          //将任务调回前台</div><div class="line">kill        //杀掉任务</div></pre></td></tr></table></figure>
<blockquote>
<p>如果我们在终端中直接运行一GUI程序，一般情况下，终端就会被当前进程占用了。如果我们想把它放到后台运行有两种方法：</p>
<ol>
<li>command &amp; 在运行的命令后加一个&amp;号，就会后台运行命令</li>
<li>ctrl-z 在终端中按ctrl-z 会将当前任务暂停并转入后台; 利用jobs命令可以查看当前后台的任务; 如果在jobs命令后增加 -l 参数 那么就会显示详细信息!</li>
<li>可以发现终止的进程状态为Stopped 通过bg %i （i为进程的标号）命令可以将其转为运行</li>
<li>如果想要结束任务，可以利用kill %i命令</li>
<li>示例图：<img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce54" alt="title"><h2 id="改变进程所在进程树的位置"><a href="#改变进程所在进程树的位置" class="headerlink" title="改变进程所在进程树的位置"></a>改变进程所在进程树的位置</h2></li>
</ol>
<ul>
<li>默认情况下：<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">php test_swoole_server.php</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p><img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce55" alt="title"></p>
<ul>
<li>改变进程所在位置后<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">(php test_swoole_server.php &amp;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="leanote://file/getImage?fileId=58048913ab64413a7e00ce53" alt="title"></p>
<h2 id="Hnohup"><a href="#Hnohup" class="headerlink" title="Hnohup"></a>Hnohup</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">(nohup php watch_send_email_websocket.php 2&gt;/root/log/swoole/send_email/error.log &amp;)</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/ssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/ssh/" itemprop="url">
                  ssh无密码登录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:14:05+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ssh无密码登录"><a href="#ssh无密码登录" class="headerlink" title="ssh无密码登录"></a>ssh无密码登录</h1><h2 id="公钥认证的基本思想"><a href="#公钥认证的基本思想" class="headerlink" title="公钥认证的基本思想"></a>公钥认证的基本思想</h2><pre><code>对信息的加密和解密采用不同的key，这对key分别称作private key和public key，其中，public key存放在欲登录的服务器上，而private key为特定的客户机所持有。
当客户机向服务器发出建立安全连接的请求时，首先发送自己的public key，如果这个public key是被服务器所允许的，服务器就发送一个经过public key加密的随机数据给客户机，这个数据只能通过private key解密，客户机将解密后的信息发还给服务器，服务器验证正确后即确认客户机是可信任的，从而建立起一条安全的信息通道。
通过这种方式，客户机不需要向外发送自己的身份标志“private key”即可达到校验的目的，并且private key是不能通过public key反向推断出来的。这避免了网络窃听可能造成的密码泄露。客户机需要小心的保存自己的private key，以免被其他人窃取，一旦这样的事情发生，就需要各服务器更换受信的public key列表。
</code></pre><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><ul>
<li><p>用ssh-keygen创建公钥</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">[root@Server1 ~]<span class="comment"># ssh-keygen -t rsa</span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key(/root/.ssh/id_rsa):</div><div class="line">Created directory <span class="string">'/root/.ssh'</span>.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</div><div class="line">Enter same passphrase again:</div><div class="line">Your identification has been saved <span class="keyword">in</span>/root/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span>/root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">7b:aa:08:a0:99:<span class="built_in">fc</span>:d9:cc:d8:2e:4b:1a:c0:6b:da:e4root@Server1</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line">+--[ RSA 2048]----+</div><div class="line">| |</div><div class="line">| |</div><div class="line">| |</div><div class="line">|. |</div><div class="line">|o. S |</div><div class="line">|++. . |</div><div class="line">|+=o. . . |</div><div class="line">|o+=oB. o |</div><div class="line">|..E==*... |</div><div class="line">+-----------------+</div><div class="line"></div><div class="line">补充说明</div><div class="line">ssh-keygen:生成秘钥</div><div class="line">其中：</div><div class="line">  -t指定算法</div><div class="line">  -f 指定生成秘钥路径</div><div class="line">  -N 指定密码</div></pre></td></tr></table></figure>
</li>
<li><p>查看钥匙</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">[root@Server1 ~]<span class="comment"># ls -l .ssh  </span></div><div class="line">总用量 8  </div><div class="line">-rw-------. 1 root root 1675 12月 10 22:20 id_rsa  </div><div class="line">-rw-r--r--. 1 root root 394 12月 10 22:20 id_rsa.pub</div></pre></td></tr></table></figure>
</li>
<li><p>将公钥复制到被管理机器Server2和Server3下的.ssh目录下（先确保存在这个目录）</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">[root@server1 .ssh]<span class="comment"># scp id_rsa.pub root@192.168.1.3:~/.ssh/  </span></div><div class="line">The authenticity of host <span class="string">'192.168.1.3(192.168.1.3)'</span> can<span class="string">'t be established.  </span></div><div class="line">RSA key fingerprint is93:eb:f9:47:b1:f6:3f:b4:2e:21:c3:d5:ab:1d:ae:65.  </div><div class="line">Are you sure you want to continueconnecting (yes/no)? yes  </div><div class="line">Warning: Permanently added '192.168.1.3<span class="string">'(RSA) to the list of known hosts.  </span></div><div class="line">root@192.168.1.3's password:  </div><div class="line">id_rsa.pub   </div><div class="line">[root@server1 .ssh]<span class="comment"># scp id_rsa.pub root@192.168.1.4:~/.ssh/authorized_keys  </span></div><div class="line">The authenticity of host <span class="string">'192.168.1.4(192.168.1.4)'</span> can<span class="string">'t be established.  </span></div><div class="line">RSA key fingerprint is93:eb:f9:47:b1:f6:3f:b4:2e:21:c3:d5:ab:1d:ae:65.  </div><div class="line">Are you sure you want to continueconnecting (yes/no)? yes  </div><div class="line">Warning: Permanently added '192.168.1.4<span class="string">'(RSA) to the list of known hosts.  </span></div><div class="line">root@192.168.1.4's password:  </div><div class="line">id_rsa.pub</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>到Server2和Server3目录下执行下面的命令<br><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line">cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</div></pre></td></tr></table></figure></p>
</blockquote>
<ul>
<li><p>设置文件和目录权限：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">chmod 600 authorized_keys</div></pre></td></tr></table></figure>
</li>
<li><p>验证使用SSH IP地址的方式无密码访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@server1 .ssh]# ssh 192.168.1.3</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/网络管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/网络管理/" itemprop="url">
                  网络管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:05:23+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h1><p>(查看端口状况)<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">netstat -apn</div></pre></td></tr></table></figure></p>
<h1 id="ufw"><a href="#ufw" class="headerlink" title="ufw"></a>ufw</h1><p>(端口管理)</p>
<ul>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo apt-get install ufw</div></pre></td></tr></table></figure>
</li>
<li><p>开启，默认关闭所有</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo ufw enable </div><div class="line">sudo ufw default deny</div></pre></td></tr></table></figure>
</li>
<li><p>查看端口状态</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo ufw status</div></pre></td></tr></table></figure>
</li>
<li><p>新增端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo ufw allow 8080</div></pre></td></tr></table></figure>
</li>
<li><p>删除端口</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo ufw delete allow 8080</div></pre></td></tr></table></figure>
</li>
<li><p>允许特定来源的访问</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sudo ufw allow from 192.168.1.1</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="ssh翻墙"><a href="#ssh翻墙" class="headerlink" title="ssh翻墙"></a>ssh翻墙</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">参考：[实战 SSH 端口转发](http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/)</div><div class="line">ssh -D &lt;local port&gt; &lt;SSH Server&gt;</div><div class="line">例：</div><div class="line">ssh -D 7000 root@xbug.site</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/vim/" itemprop="url">
                  vim
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:04:35+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="移动光标"><a href="#移动光标" class="headerlink" title="移动光标"></a>移动光标</h2><ul>
<li><code>ctrl+b</code>: 前移一个字符(backward)</li>
<li><code>ctrl+f</code>: 后移一个字符(forward)</li>
<li><code>alt+&lt;-</code>: 前移一个单词</li>
<li><code>alt+-&gt;</code>: 后移一个单词</li>
<li><code>ctrl+a</code>: 移到行首（a是首字母） </li>
<li><code>ctrl+e</code>: 移到行尾（end）</li>
<li><code>ctrl+x</code>: 行首到当前光标替换</li>
</ul>
<h2 id="编辑命令"><a href="#编辑命令" class="headerlink" title="编辑命令"></a>编辑命令</h2><ul>
<li><code>alt+.</code>: 粘帖最后一次命令最后的参数（通常用于<code>mkdir long-long-dir</code>后, <code>cd</code>配合着<code>alt+.</code>）</li>
<li><code>alt+d</code>: 删除当前光标到临近右边单词开始(delete)</li>
<li><code>ctrl+w</code>: 删除当前光标到临近左边单词结束(word)</li>
<li><code>ctrl+h</code>: 删除光标前一个字符（相当于backspace）</li>
<li><code>ctrl+d</code>: 删除光标后一个字符（相当于delete）</li>
<li><code>ctrl+u</code>: 删除光标左边所有</li>
<li><code>ctrl+k</code>: 删除光标右边所有</li>
<li><code>ctrl+l</code>: 清屏</li>
<li><code>ctrl+shift+c</code>: 复制（相当于鼠标左键拖拽）</li>
<li><code>ctrl+shift+v</code>: 粘贴（相当于鼠标中键）</li>
</ul>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li><code>ctrl+n</code>: 下一条命令</li>
<li><code>ctrl+p</code>: 上一条命令</li>
<li><code>alt+n</code>: 下一条命令（例如输入<code>ls</code>, 然后按’alt+n’, 就会找到历史记录下的<code>ls</code>命令）</li>
<li><code>alt+p</code>: 上一条命令（跟<code>alt+n</code>相似）</li>
<li><code>shift+PageUp</code>: 向上翻页</li>
<li><code>shift+PageDown</code>: 向下翻页</li>
<li><code>ctrl+r</code>: 进入历史查找命令记录， 输入关键字。 多次按返回下一个匹配项</li>
</ul>
<h2 id="zsh"><a href="#zsh" class="headerlink" title="zsh"></a>zsh</h2><ul>
<li><code>d</code>: 列出以前的打开的命令</li>
<li><code>j</code>: jump到以前某个目录，模糊匹配</li>
</ul>
<h2 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h2><h3 id="移动光标-1"><a href="#移动光标-1" class="headerlink" title="移动光标"></a>移动光标</h3><ul>
<li><code>b</code>: 向前移动一个单词</li>
<li><code>w</code>: 向后移动一个单词</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ul>
<li><code>dw</code>: 从当前光标开始删除到下一个单词头</li>
<li><code>de</code>: 从当前光标开始删除到单词尾</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/expect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/expect/" itemprop="url">
                  expect交互编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:02:55+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Ubuntu：apt-get install expect</div><div class="line">mac: brew install homebrew/dupes/expect</div></pre></td></tr></table></figure>
<h1 id="设置变量"><a href="#设置变量" class="headerlink" title="设置变量"></a>设置变量</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">set password  rootddd</div></pre></td></tr></table></figure>
<h1 id="获取参数"><a href="#获取参数" class="headerlink" title="获取参数"></a>获取参数</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">set filename [lindex $argv 0]</div></pre></td></tr></table></figure>
<h1 id="一般格式"><a href="#一般格式" class="headerlink" title="一般格式"></a>一般格式</h1><blockquote>
<p>开头一定要是expect<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#!/usr/bin/expect</div><div class="line"></div><div class="line">set filename [lindex $argv 0]</div><div class="line">set password  example_pass</div><div class="line"># 开始执行命令</div><div class="line">spawn ssh root@example.com</div><div class="line"># 匹配（如果包含，则执行下面的send）</div><div class="line">expect &quot;password:&quot;</div><div class="line"># \r回车</div><div class="line">send &quot;$password\r&quot;</div><div class="line">send &quot;ls\r&quot;</div><div class="line">send &quot;exit\r&quot;</div><div class="line"># 结束标志</div><div class="line">interact</div></pre></td></tr></table></figure></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/shell/" itemprop="url">
                  shell
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:01:52+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="判断命令是否执行成功"><a href="#判断命令是否执行成功" class="headerlink" title="判断命令是否执行成功"></a>判断命令是否执行成功</h1><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="keyword">if</span> [[ $? <span class="_">-eq</span> 0 ]];<span class="keyword">then</span> A <span class="keyword">else</span> b;<span class="keyword">fi</span></div><div class="line"><span class="comment"># 或</span></div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-eq</span> 0 ];<span class="keyword">then</span></div><div class="line">  命令正确的分支</div><div class="line"><span class="keyword">else</span></div><div class="line">  命令失败的分支</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<h1 id="在脚本中执行其他脚本"><a href="#在脚本中执行其他脚本" class="headerlink" title="在脚本中执行其他脚本"></a>在脚本中执行其他脚本</h1><ul>
<li><p>fork  ( /directory/script.sh)：</p>
<blockquote>
<p>如果shell中包含执行命令，那么子命令并不影响父级的命令，在子命令执行完后再执行父级命令。子级的环境变量不会影响到父级。<br>fork是最普通的, 就是直接在脚本里面用/directory/script.sh来调用script.sh这个脚本.<br>运行的时候开一个sub-shell执行调用的脚本，sub-shell执行的时候, parent-shell还在。<br>sub-shell执行完毕后返回parent-shell. sub-shell从parent-shell继承环境变量.但是sub-shell中的环境变量不会带回parent-shell</p>
</blockquote>
</li>
<li><p>exec (exec /directory/script.sh)：</p>
<blockquote>
<p>执行子级的命令后，不再执行父级命令。<br>exec与fork不同，不需要新开一个sub-shell来执行被调用的脚本.  被调用的脚本与父脚本在同一个shell内执行。但是使用exec调用一个新脚本以后, 父脚本中exec行之后的内容就不会再执行了。这是exec和source的区别</p>
</blockquote>
</li>
<li><p>source (source /directory/script.sh)：</p>
<blockquote>
<p>执行子级命令后继续执行父级命令，同时子级设置的环境变量会影响到父级的环境变量。<br>与fork的区别是不新开一个sub-shell来执行被调用的脚本，而是在同一个shell中执行. 所以被调用的脚本中声明的变量和环境变量, 都可以在主脚本中得到和使用.</p>
<h1 id="获取时间"><a href="#获取时间" class="headerlink" title="获取时间"></a>获取时间</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">file_name=&quot;`date +%y%m%d`.sql&quot;</div><div class="line"># 结果：170109.sql</div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 将参数赋值给file_name变量，注意=两边不能有空格</div><div class="line">file_name=$1</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/pdf处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/pdf处理/" itemprop="url">
                  pdf处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T23:01:16+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>PDFtk 是什么？我觉得官网的一句话解释得很好。</p>
<blockquote>
<p>If PDF is electronic paper, then PDFtk is an electronic staple-remover, hole-punch, binder, secret-decoder-ring, and X-Ray-glasses. PDFtk is a simple tool for doing everyday things with PDF documents.</p>
</blockquote>
<p>其官方网站为：<br><a href="http://www.pdflabs.com/tools/pdftk-the-pdf-toolkit" target="_blank" rel="external">官网</a></p>
<p>PDFtk 目前分为三个版本：</p>
<ul>
<li>PDFtk Server：<br>命令行工具。支持 windows、Linux、Mac。</li>
<li>PDFtk Free：<br>图形界面基础免费版；仅限 windows 用户；功能仅限于 PDF 合并和分割；</li>
<li>PDFtk Pro：<br>图形界面专业收费版；仅限 windows 用户，可以对 PDF 文档进行合并、分割、旋转、加水印、加邮戳、加密。</li>
</ul>
<p>对于 Linux 用户，唯一的选择是免费的 PDFtk Server，其功能与收费 PDFtk Pro 完全相同，只是没有 GUI 而已。作者还是很厚道的。</p>
<p>Linux 的各个发行版的官方源中基本都有该软件，直接 apt-get 或者 yum 安装即可。</p>
<h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><p>合并 PDF；<br>分割 PDF 页面；<br>旋转 PDF 文档或页面；<br>PDF 解密；（不是破解）<br>PDF 加密；<br>用 X/FDF 填写 PDF 表格；<br>从 PDF 表格中生成 PDF Data Stencils；<br>加背景水印或前景印章；<br>报告 PDF Metrics，书签和元数据；<br>增加 / 更新 PDF 书签或元数据；<br>给 PDF 页面或文档加附件；<br>解压 PDF 附件；<br>分解 PDF 文档为多个单页；<br>解压缩和重压缩页面流；<br>修复受损的 PDF 文档；<br>这功能完全可以与 Adobe Acrobat 相媲美了，更重要的是 PDFtk 支持 Linux 且完全免费。（个人用户免费，若用于商业用途需付费）。</p>
<h1 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h1><p>具体选项看这里：</p>
<p><a href="http://www.pdflabs.com/docs/pdftk-man-page/" target="_blank" rel="external">具体选项</a></p>
<p>下面给出一些常见的例子。例子原文</p>
<p>扫描一本书，odd.pdf 为书的全部奇数页，even.pdf 为书的全部偶数页，下面的命令可以将两个 pdf 合并成页码正常的书:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk A=odd.pdf B=even.pdf shuffle A B output collated.pdf</div></pre></td></tr></table></figure></p>
<p>如果 odd.pdf 是逆序的:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk A=odd.pdf B=even.pdf shuffle Aend-1 B output collated.pdf</div></pre></td></tr></table></figure></p>
<p>加密 PDF:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk secured.pdf input_pw foopass output unsecured.pdf</div></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，保留全部权限:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk 1.pdf output 1.128.pdf owner_pw foopass</div></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，保留全部权限，打开文档需输入密码 “baz”:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk 1.pdf output 1.128.pdf owner_pw foo user_pw baz</div></pre></td></tr></table></figure></p>
<p>PDF 128 位加密，打开文档需输入密码 “baz”，保留打印之外的其他权限:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk 1.pdf output 1.128.pdf owner_pw foo user_pw baz allow printing</div></pre></td></tr></table></figure></p>
<p>合并 in1.pdf 和 in2.pdf 到新 PDF 中:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in1.pdf in2.pdf cat output out1.pdf</div></pre></td></tr></table></figure></p>
<p>或（使用句柄）:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk A=in1.pdf B=in2.pdf cat A B output out1.pdf</div></pre></td></tr></table></figure></p>
<p>或（使用通配符）:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk *.pdf cat output combined.pdf</div></pre></td></tr></table></figure></p>
<p>去除 in1.pdf 中的第 13 页，并创建 out1.pdf:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf cat 1-12 14-end output out1.pdf</div></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk A=in1.pdf cat A1-12 A14-end output out1.pdf</div></pre></td></tr></table></figure></p>
<p>对输出进行 40 位加密，撤销所有权限，设置 owner 密码为 foopass:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk 1.pdf 2.pdf cat output 3.pdf encrypt_40bit owner_pw foopass</div></pre></td></tr></table></figure></p>
<p>合并两个文件，其中一个需要被加密。对输出不加密:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk A=secured.pdf 2.pdf input_pw A=foopass cat output 3.pdf</div></pre></td></tr></table></figure></p>
<p>解压 PDF 页面流，然后就可以在文本编辑器中编辑 PDF 文件:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk doc.pdf output doc.unc.pdf uncompress</div></pre></td></tr></table></figure></p>
<p>压缩 PDF:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk mydoc.pdf output mydoc.clear.pdf compress</div></pre></td></tr></table></figure></p>
<p>修复破损的 PDF:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk broken.pdf output fixed.pdf</div></pre></td></tr></table></figure></p>
<p>将一个 PDF 文档分割成一页一个文档:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf burst</div></pre></td></tr></table></figure></p>
<p>将一个 PDF 文档分割成一页一个文档，并加密，允许低质量的打印:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf burst owner_pw foopass allow DegradedPrinting</div></pre></td></tr></table></figure></p>
<p>获取 PDF 问的元数据和书签信息:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf dump_data output report.txt</div></pre></td></tr></table></figure></p>
<p>将 PDF 第一页顺时针旋转 90 度:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf cat 1east 2-end output out.pdf</div></pre></td></tr></table></figure></p>
<p>将整个 PDF 文档旋转 180 度:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">pdftk in.pdf cat 1-endsouth output out.pdf</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/每日一个Linux命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/每日一个Linux命令/" itemprop="url">
                  每日一个Linux命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:58:59+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="创建快捷方式"><a href="#创建快捷方式" class="headerlink" title="创建快捷方式"></a>创建快捷方式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ln 源文件 目标文件</div><div class="line">  例：ln default /Users/pangmin/Documents/www/nginx-host</div><div class="line">ln -s 源文件 目标文件</div><div class="line">  例：ln -s /usr/local/etc/nginx/sites-enabled/ </div><div class="line">      /Users/pangmin/Documents/www/site-default</div></pre></td></tr></table></figure>
<h2 id="启动-关闭-重启-nginx"><a href="#启动-关闭-重启-nginx" class="headerlink" title="启动 关闭 重启 nginx"></a>启动 关闭 重启 nginx</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">开启：nginx</div><div class="line">关闭：nginx -s stop</div><div class="line">重启：nginx -s reload</div></pre></td></tr></table></figure>
<h2 id="启动-关闭-重启-mysql"><a href="#启动-关闭-重启-mysql" class="headerlink" title="启动 关闭 重启 mysql"></a>启动 关闭 重启 mysql</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">开启：mysql.server start</div><div class="line">关闭：mysql.server stop</div><div class="line">重启：mysql.server restart</div></pre></td></tr></table></figure>
<h2 id="启动-关闭-重启-memcache"><a href="#启动-关闭-重启-memcache" class="headerlink" title="启动 关闭 重启 memcache"></a>启动 关闭 重启 memcache</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">开启：memcached -d</div><div class="line">关闭：killall memcached</div></pre></td></tr></table></figure>
<h2 id="启动-关闭-重启-php-fpm"><a href="#启动-关闭-重启-php-fpm" class="headerlink" title="启动 关闭 重启 php-fpm"></a>启动 关闭 重启 php-fpm</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">开启：php-fpm -D</div><div class="line">关闭：killall php-fpm</div></pre></td></tr></table></figure>
<h2 id="安装-卸载-homebrew"><a href="#安装-卸载-homebrew" class="headerlink" title="安装 卸载 homebrew"></a>安装 卸载 homebrew</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">安装：</div><div class="line">ruby -e &quot;$(curl -fsSkL raw.github.com/mxcl/homebrew/go)&quot;</div><div class="line">更新</div><div class="line">brew update</div><div class="line">卸载：</div><div class="line">  cd `brew --prefix`</div><div class="line">  rm -rf Cellar</div><div class="line">  brew prune</div><div class="line">  rm `git ls-files`</div><div class="line">  rm -r Library/Homebrew Library/Aliases Library/Formula Library/Contributions</div><div class="line">  rm -rf .git</div><div class="line">  rm -rf ~/Library/Caches/Homebrew</div><div class="line">安装软件。</div><div class="line">  4.1、查找：brew search</div><div class="line">　　如：brew search rar</div><div class="line">  4.2、安装， 如：brew install unrar</div><div class="line">4.3、卸载， 如：brew uninstall unrar</div><div class="line">4.4、查看，如:brew list</div></pre></td></tr></table></figure>
<h2 id="修改权限："><a href="#修改权限：" class="headerlink" title="修改权限："></a>修改权限：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">例如chmod -R 777 /home/mypackage</div></pre></td></tr></table></figure>
<h2 id="更改用户"><a href="#更改用户" class="headerlink" title="更改用户"></a>更改用户</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">例 su - pangmin</div></pre></td></tr></table></figure>
<h2 id="查看命令帮助"><a href="#查看命令帮助" class="headerlink" title="查看命令帮助"></a>查看命令帮助</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">（命令） --help</div></pre></td></tr></table></figure>
<h2 id="查看文件安装路径"><a href="#查看文件安装路径" class="headerlink" title="查看文件安装路径"></a>查看文件安装路径</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">whereis php</div></pre></td></tr></table></figure>
<h2 id="压缩解压"><a href="#压缩解压" class="headerlink" title="压缩解压"></a>压缩解压</h2><h3 id="zip格式"><a href="#zip格式" class="headerlink" title="zip格式"></a>zip格式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">zip -r myfile.zip ./*</div><div class="line">将当前目录下的所有文件和文件夹全部压缩成myfile.zip文件,－r表示递归压缩子目录下所有文件.</div><div class="line"></div><div class="line">2.unzip</div><div class="line">unzip -o -d /home/sunny myfile.zip</div><div class="line">把myfile.zip文件解压到 /home/sunny/</div><div class="line">-o:不提示的情况下覆盖文件；</div><div class="line">-d:-d /home/sunny 指明将文件解压缩到/home/sunny目录下；</div><div class="line">3.其他</div><div class="line">zip -d myfile.zip smart.txt</div><div class="line">删除压缩文件中smart.txt文件</div><div class="line">zip -m myfile.zip ./rpm_info.txt</div><div class="line">向压缩文件中myfile.zip中添加rpm_info.txt文件</div><div class="line">-------------------------------------------------------------------------------</div><div class="line">要使用 zip 来压缩文件，在 shell 提示下键入下面的命令：</div><div class="line">zip -r filename.zip filesdir</div><div class="line">在这个例子里，filename.zip 代表你创建的文件，filesdir 代表你想放置新 zip 文件的目录。-r 选项指定你想递归地（recursively）包括所有包括在 filesdir 目录中的文件。</div><div class="line">要抽取 zip 文件的内容，键入以下命令：</div><div class="line">unzip filename.zip</div><div class="line">你可以使用 zip 命令同时处理多个文件和目录，方法是将它们逐一列出，并用空格间隔：</div><div class="line">zip -r filename.zip file1 file2 file3 /usr/work/school </div><div class="line">上面的命令把 file1、file2、 file3、以及 /usr/work/school 目录的内容（假设这个目录存在）压缩起来，然后放入 filename.zip 文件中。</div></pre></td></tr></table></figure>
<h3 id="tar格式"><a href="#tar格式" class="headerlink" title="tar格式"></a>tar格式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">　压缩</div><div class="line">　　tar –cvf jpg.tar *.jpg //将目录里所有jpg文件打包成tar.jpg</div><div class="line">　　tar –czf jpg.tar.gz *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用gzip压缩，生成一个gzip压缩过的包，命名为jpg.tar.gz</div><div class="line">　　tar –cjf jpg.tar.bz2 *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用bzip2压缩，生成一个bzip2压缩过的包，命名为jpg.tar.bz2</div><div class="line">　　tar –cZf jpg.tar.Z *.jpg //将目录里所有jpg文件打包成jpg.tar后，并且将其用compress压缩，生成一个umcompress压缩过的包，命名为jpg.tar.Z</div><div class="line">　　rar a jpg.rar *.jpg //rar格式的压缩，需要先下载rar for linux</div><div class="line">　　zip jpg.zip *.jpg //zip格式的压缩，需要先下载zip for linux</div><div class="line">　　解压</div><div class="line">　　tar –xvf file.tar //解压 tar包</div><div class="line">　　tar -xzvf file.tar.gz //解压tar.gz</div><div class="line">　　tar -xjvf file.tar.bz2 //解压 tar.bz2</div><div class="line">　　tar –xZvf file.tar.Z //解压tar.Z</div><div class="line">　　unrar e file.rar //解压rar</div><div class="line">　　unzip file.zip //解压zip</div></pre></td></tr></table></figure>
<h2 id="将命令输出保存到变量中"><a href="#将命令输出保存到变量中" class="headerlink" title="将命令输出保存到变量中"></a>将命令输出保存到变量中</h2><ul>
<li><p>`符号包含的命令执行完后，可以讲其输出结果保存到变量中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">v=`java -version`  </div><div class="line">echo $v</div></pre></td></tr></table></figure>
</li>
<li><p>还有另一种方法，用$()将命令包起来。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">v=$(java -version)  </div><div class="line">echo $v</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="bash常用快捷键"><a href="#bash常用快捷键" class="headerlink" title="bash常用快捷键"></a>bash常用快捷键</h2><blockquote>
<p><strong>ctrl+A</strong><br>把光标移动到命令行开头。如果我们输入的命令过长,想要把光标移 动到命令行开头时使用。<br><strong>ctrl+E</strong><br>把光标移动到命令行结尾。<br><strong>ctrl+C</strong><br>强制终止当前的命令。<br><strong>ctrl+L</strong><br>清屏,相当于clear命令。<br><strong>ctrl+U</strong><br>删除或剪切光标之前的命令。我输入了一行很长的命令,不用使用退 格键一个一个字符的删除,使用这个快捷键会更加方便<br><strong>ctrl+K</strong><br>删除或剪切光标之后的内容。<br><strong>ctrl+Y</strong><br>粘贴ctrl+U或ctrl+K剪切的内容。<br><strong>ctrl+R</strong><br>在历史命令中搜索,按下ctrl+R之后,就会出现搜索界面,只要输入 搜索内容,就会从历史命令中搜索。<br><strong>ctrl+D</strong><br>退出当前终端。<br><strong>ctrl+Z</strong><br>暂停,并放入后台。这个快捷键牵扯工作管理的内容,我们在系统管 理章节详细介绍。<br><strong>ctrl+S</strong><br>暂停屏幕输出。<br><strong>ctrl+Q</strong><br>恢复屏幕输出。</p>
</blockquote>
<h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><ul>
<li>hash：列出</li>
<li>hash -d COMMOND:删除</li>
<li>hash -r 清空</li>
</ul>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li>程序：指令+数据<ul>
<li>指令：有程序文件提供</li>
<li>数据：io设备，文件，管道，变量</li>
</ul>
</li>
</ul>
<h2 id="查看Linux版本"><a href="#查看Linux版本" class="headerlink" title="查看Linux版本"></a>查看Linux版本</h2><ul>
<li>uname -a</li>
<li>cat /proc/version</li>
</ul>
<h2 id="apt-get"><a href="#apt-get" class="headerlink" title="apt-get"></a>apt-get</h2><ul>
<li><code>-y</code>参数<br>安装遇到<code>Do you want to continue? [Y/n] Abort</code>时，使用这个参数自动选择Y</li>
</ul>
<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><ul>
<li>在历史中搜索：快捷键<code>Ctrl + R</code></li>
<li>清空历史命令：<code>history -c</code></li>
</ul>
<h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><ul>
<li><p>l:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">drwxrwxrwx 2 chimps chimps 4096 2月   1 03:16 文档</div><div class="line">drwxrwxrwx 2 chimps chimps 4096 3月  13 20:27 下载</div><div class="line">drwxrwxrwx 2 chimps chimps 4096 2月   1 03:16 音乐</div><div class="line">drwxrwxrwx 2 chimps chimps 4096 2月   1 03:16 桌面</div></pre></td></tr></table></figure>
<ul>
<li>第一个首字母表示文件类型：<code>d</code>：directory，<code>-</code>：普通文件，<code>l</code>:link</li>
<li>第二个表示文件连接数。</li>
</ul>
</li>
<li>S：order by size</li>
<li>k：显示大小以k字节为单位</li>
<li>h：以更直观的方式查看文件大小</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/linux/Awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/Awk/" itemprop="url">
                  Awk
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:57:01+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>参见<a href="http://man.linuxde.net/awk" target="_blank" rel="external">linux手册awk部分</a></p>
<h1 id="示例文本"><a href="#示例文本" class="headerlink" title="示例文本"></a>示例文本</h1><p>test.txt<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Beth	4.00	0</div><div class="line">Dan	3.75	0</div><div class="line">kathy	4.00	10</div><div class="line">Mark	5.00	20</div><div class="line">Mary	5.50	22</div><div class="line">Susie	4.25	18</div></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="基本语法示例"><a href="#基本语法示例" class="headerlink" title="基本语法示例"></a>基本语法示例</h1><p><code>awk &#39;$3 &gt;0 { print $1, $2 * $3 }&#39; emp.data</code></p>
<h1 id="通过awk脚本文件"><a href="#通过awk脚本文件" class="headerlink" title="通过awk脚本文件"></a>通过awk脚本文件</h1><p>test.awk<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/.+th/ &#123;</div><div class="line">    print $0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行脚本：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ awk -f test.awk test.txt</div><div class="line"># 结果：</div><div class="line">Beth    4.00    0</div><div class="line">kathy   4.00    10</div></pre></td></tr></table></figure></p>
<h1 id="BEGIN与END"><a href="#BEGIN与END" class="headerlink" title="BEGIN与END"></a>BEGIN与END</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    print &quot;begin search&quot;</div><div class="line">&#125;</div><div class="line">END&#123;</div><div class="line">    print &quot;all end&quot;</div><div class="line">&#125;</div><div class="line">/.+th/&#123;</div><div class="line">    print $0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ awk -f test.awk test.txt</div><div class="line"># 结果</div><div class="line">begin search</div><div class="line">Beth    4.00    0</div><div class="line">kathy   4.00    10</div><div class="line">all end</div></pre></td></tr></table></figure></p>
<h1 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h1><h2 id="ARGC"><a href="#ARGC" class="headerlink" title="ARGC"></a>ARGC</h2><p>表示在命令中提供的参数的个数<br>例：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">awk &apos;BEGIN &#123;print &quot;Arguments =&quot;, ARGC&#125;&apos; One Two Three Four</div></pre></td></tr></table></figure></p>
<p>结果：<code>Arguments = 5</code></p>
<h2 id="ARGV"><a href="#ARGV" class="headerlink" title="ARGV"></a>ARGV</h2><p>这个变量表示存储命令行输入参数的数组,数组的有效索引是从 0 到 ARGC-1<br>例<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    for (i = 0; i &lt; ARGC ;i++)&#123;  </div><div class="line">        printf &quot;ARGV[%d]=%s\n&quot;, i, ARGV[i]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">END&#123;</div><div class="line">    print &quot;all end&quot;</div><div class="line">&#125;</div><div class="line">/.+th/&#123;</div><div class="line">    print $0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ awk -f test.awk test.txt</div><div class="line"># 结果</div><div class="line">ARGV[0]=awk</div><div class="line">ARGV[1]=test.txt</div><div class="line">Beth    4.00    0</div><div class="line">kathy   4.00    10</div><div class="line">all end</div></pre></td></tr></table></figure></p>
<h2 id="ENVISON环境变量"><a href="#ENVISON环境变量" class="headerlink" title="ENVISON环境变量"></a>ENVISON环境变量</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    for (n in ENVIRON)&#123;</div><div class="line">        print n &quot;: &quot; ENVIRON[n]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ awk -f test.awk test.txt</div><div class="line"># 结果</div><div class="line">GOROOT: /usr/local/Cellar/go/1.7.4_1/libexec</div><div class="line">LESS: -R</div><div class="line">PAGER: less</div><div class="line">AWKPATH: .:/usr/local/Cellar/gawk/4.1.4_1/share/awk</div><div class="line">OLDPWD: ...</div><div class="line">TERM_PROGRAM: iTerm.app</div></pre></td></tr></table></figure></p>
<h2 id="FILENAME"><a href="#FILENAME" class="headerlink" title="FILENAME"></a>FILENAME</h2><p>文件名<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    print FILENAME</div><div class="line">&#125;</div><div class="line">END&#123;</div><div class="line">    print FILENAME</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/linux/awk awk -f test.awk test.txt</div><div class="line"></div><div class="line">test.txt</div></pre></td></tr></table></figure></p>
<p>可以看出在begin的时候FILENAME变量为空值</p>
<h2 id="FS"><a href="#FS" class="headerlink" title="FS"></a>FS</h2><p>此变量表示输入的数据域之间的分隔符，其默认值是空格。 你可以使用 -F 命令行选项改变它的默认值。</p>
<h2 id="NF"><a href="#NF" class="headerlink" title="NF"></a>NF</h2><p>此变量表示当前输入记录中域的数量<br>test.txt<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Marks</div><div class="line">Mark	5.00</div><div class="line">Mary	5.50	22</div><div class="line">Susie	4.25	18</div></pre></td></tr></table></figure></p>
<p>test.awk<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">NF&gt;2&#123;</div><div class="line">    print $0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/linux/awk awk -f test.awk test.txt</div><div class="line">Mary	5.50	22</div><div class="line">Susie	4.25	18</div></pre></td></tr></table></figure></p>
<h2 id="NR（FNR）"><a href="#NR（FNR）" class="headerlink" title="NR（FNR）"></a>NR（FNR）</h2><p>默认的就是读取的数据行数，NR可以理解为Number of Record的缩写,FNR则为File Number of Record<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># class1:</div><div class="line">zhaoyun 85 87</div><div class="line">guanyu 87 88</div><div class="line">liubei 90 86</div><div class="line"># class2:</div><div class="line">caocao 92 87 90</div><div class="line">guojia 99 96 92</div><div class="line"># test.awk:</div><div class="line">&#123;</div><div class="line">    print NR,FNR,$0</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/linux/awk awk -f test.awk class1 class2</div><div class="line">1 1 zhaoyun 85 87</div><div class="line">2 2 guanyu 87 88</div><div class="line">3 3 liubei 90 86</div><div class="line">4 1 caocao 92 87 90</div><div class="line">5 2 guojia 99 96 92</div></pre></td></tr></table></figure></p>
<h1 id="数组操作"><a href="#数组操作" class="headerlink" title="数组操作"></a>数组操作</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    arr[1] = &quot;zhangsan&quot;</div><div class="line">    arr[&quot;lisi&quot;] = &quot;lisi&quot;</div><div class="line">    arr[2] = &quot;wangwu&quot;</div><div class="line"></div><div class="line">    for (n in arr)&#123;</div><div class="line">        print arr[n]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/linux/awk awk -f test.awk test.txt</div><div class="line">lisi</div><div class="line">zhangsan</div><div class="line">wangwu</div></pre></td></tr></table></figure></p>
<h2 id="判断数组中是否存在某一项"><a href="#判断数组中是否存在某一项" class="headerlink" title="判断数组中是否存在某一项"></a>判断数组中是否存在某一项</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    arr[&quot;zhangsan&quot;] = &quot;wangwu&quot;</div><div class="line">    if(&quot;zhangsan&quot; in arr)&#123;</div><div class="line">        print &quot;zhangsan ok&quot;</div><div class="line">    &#125;else&#123;</div><div class="line">        print &quot;zhangsan not found&quot;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if(&quot;lisi&quot; in arr)&#123;</div><div class="line">        print &quot;lisi ok&quot;</div><div class="line">    &#125;else&#123;</div><div class="line">        print &quot;lisi not found&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/linux/awk awk -f deal_err.awk</div><div class="line">zhangsan ok</div><div class="line">lisi not found</div></pre></td></tr></table></figure></p>
<h1 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h1><h2 id="获取每个进程的内存占用"><a href="#获取每个进程的内存占用" class="headerlink" title="获取每个进程的内存占用"></a>获取每个进程的内存占用</h2><p>test.awk:<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">NR != 1 &amp;&amp; $4 &gt; 0&#123;</div><div class="line">    mem[$4] = $11</div><div class="line">&#125;</div><div class="line">END&#123;</div><div class="line">    asorti(mem, Nmem)</div><div class="line">    for (k in Nmem)&#123;</div><div class="line">        print mem[Nmem[k]], Nmem[k]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行：<br><code>ps aux | awk -f test.awk</code></p>
<h2 id="多行日志处理"><a href="#多行日志处理" class="headerlink" title="多行日志处理"></a>多行日志处理</h2><p>file.log：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[2017-02-17 16:19:04] [285]</div><div class="line">&lt;- /v2/api/file/item/476</div><div class="line">-&gt; &#123;&quot;success&quot;:true,&quot;successInfo&quot;:&#123;&#125;&#125;</div><div class="line"></div><div class="line">[2017-03-10 11:57:42] []</div><div class="line">&lt;- /v2/api/file/diff?fid1=381&amp;fid2=287</div><div class="line">-&gt; &#123;&quot;success&quot;:false,&quot;errorInfo&quot;:&quot;长度不能为空&quot;,&quot;successInfo&quot;:&#123;&#125;,&quot;debug&quot;:&#123;&quot;line&quot;:37,&quot;info&quot;:null&#125;&#125;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<h3 id="方式一：使用数组"><a href="#方式一：使用数组" class="headerlink" title="方式一：使用数组"></a>方式一：使用数组</h3><p>deal_err.awk<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">BEGIN&#123;</div><div class="line">    sub_index = 0</div><div class="line">&#125;</div><div class="line">/^\[/&#123;</div><div class="line">    arr_line[sub_index] = $1 &quot;\t&quot; $2</div><div class="line">&#125;</div><div class="line"></div><div class="line">/^&lt;-/&#123;</div><div class="line">    arr_line[sub_index] = arr_line[sub_index] &quot;\t&quot; $2</div><div class="line">&#125;</div><div class="line"></div><div class="line">/^-&gt;/&#123;</div><div class="line">    text = substr($2, 2, length($2)-2)</div><div class="line">    split(text, text_arr, &quot;,&quot;)</div><div class="line">    split(text_arr[1], text_arr1, &quot;:&quot;)</div><div class="line">    if (text_arr1[2] == &quot;false&quot;)&#123;</div><div class="line">        arr[sub_index] = arr_line[sub_index] &quot;\t&quot; text_arr[2]</div><div class="line">        sub_index ++</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">END&#123;</div><div class="line">    for (k in arr) &#123;</div><div class="line">        print k,arr[k] &gt;&gt; &quot;output.txt&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">awk -f deal_err.awk file.log</div></pre></td></tr></table></figure></p>
<h3 id="方式二：匹配成功就写到文件"><a href="#方式二：匹配成功就写到文件" class="headerlink" title="方式二：匹配成功就写到文件"></a>方式二：匹配成功就写到文件</h3><p>deal_err.awk<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/^\[/&#123;</div><div class="line">    url = $1 &quot;\t&quot; $2</div><div class="line">&#125;</div><div class="line"></div><div class="line">/^&lt;-/&#123;</div><div class="line">    request = arr_line[sub_index] &quot;\t&quot; $2</div><div class="line">&#125;</div><div class="line"></div><div class="line">/^-&gt;/&#123;</div><div class="line">    response = substr($2, 2, length($2)-2)</div><div class="line">    split(response, res_arr, &quot;,&quot;)</div><div class="line">    split(res_arr[1], res_arr1, &quot;:&quot;)</div><div class="line">    if (res_arr1[2] == &quot;false&quot;)&#123;</div><div class="line">        print url,request,res_arr[2] &gt; &quot;output.txt&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很明显，这样可读性好一些<br>运行：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">awk -f deal_err.awk file.log</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/auth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/auth/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:56:49+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mongodb/CRUD操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mongodb/CRUD操作/" itemprop="url">
                  CRUD操作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:55:18+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h1><ul>
<li><p>正常插入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.insert(&#123;<span class="attr">x</span>:<span class="number">1</span>,<span class="attr">y</span>:<span class="number">2</span>,<span class="attr">z</span>:<span class="number">3</span>&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : <span class="number">1</span> &#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>循环插入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;<span class="number">100</span>;i++) db.user.insert(&#123;<span class="attr">x</span>:i, <span class="attr">y</span>:i*<span class="number">10</span>, <span class="attr">z</span>:i*<span class="number">100</span>&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : <span class="number">1</span> &#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="update"><a href="#update" class="headerlink" title="update"></a>update</h1><ul>
<li><p>整个更新</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d844bae387d0c1e8d870"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d84ebae387d0c1e8d871"</span>), <span class="string">"x"</span> : <span class="number">2</span>, <span class="string">"y"</span> : <span class="number">3</span> &#125;</div><div class="line">&gt; db.user.update(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;,&#123;<span class="attr">x</span>:<span class="number">999</span>&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : <span class="number">1</span>, <span class="string">"nUpserted"</span> : <span class="number">0</span>, <span class="string">"nModified"</span> : <span class="number">1</span> &#125;)</div><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d844bae387d0c1e8d870"</span>), <span class="string">"x"</span> : <span class="number">999</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d84ebae387d0c1e8d871"</span>), <span class="string">"x"</span> : <span class="number">2</span>, <span class="string">"y"</span> : <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>部分更新<br>使用$set操作符</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d844bae387d0c1e8d870"</span>), <span class="string">"x"</span> : <span class="number">999</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d84ebae387d0c1e8d871"</span>), <span class="string">"x"</span> : <span class="number">2</span>, <span class="string">"y"</span> : <span class="number">3</span> &#125;</div><div class="line">&gt; db.user.update(&#123;<span class="attr">x</span>:<span class="number">2</span>&#125;,&#123;<span class="attr">$set</span>:&#123;<span class="attr">x</span>:<span class="number">999</span>&#125;&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : <span class="number">1</span>, <span class="string">"nUpserted"</span> : <span class="number">0</span>, <span class="string">"nModified"</span> : <span class="number">1</span> &#125;)</div><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d844bae387d0c1e8d870"</span>), <span class="string">"x"</span> : <span class="number">999</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d84ebae387d0c1e8d871"</span>), <span class="string">"x"</span> : <span class="number">999</span>, <span class="string">"y"</span> : <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>不存在则创建</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;)</div><div class="line">&gt; db.user.update(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;,&#123;<span class="attr">x</span>:<span class="number">2</span>&#125;,<span class="literal">true</span>)</div><div class="line">WriteResult(&#123;</div><div class="line">	<span class="string">"nMatched"</span> : <span class="number">0</span>,</div><div class="line">	<span class="string">"nUpserted"</span> : <span class="number">1</span>,</div><div class="line">	<span class="string">"nModified"</span> : <span class="number">0</span>,</div><div class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"58d0da6e34123eac45d857ac"</span>)</div><div class="line">&#125;)</div><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d844bae387d0c1e8d870"</span>), <span class="string">"x"</span> : <span class="number">999</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d84ebae387d0c1e8d871"</span>), <span class="string">"x"</span> : <span class="number">999</span>, <span class="string">"y"</span> : <span class="number">3</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0da6e34123eac45d857ac"</span>), <span class="string">"x"</span> : <span class="number">2</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>更新多条<br>mongodb默认是更新一条，据说是为了防止一时大意，<br>而且更新多条不允许更新整个，只能使用$set关键字</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0dde9bae387d0c1e8d873"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0ddeabae387d0c1e8d874"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">1</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0ddebbae387d0c1e8d875"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">1</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div><div class="line">&gt; db.user.update(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;,&#123;<span class="attr">$set</span>:&#123;<span class="attr">y</span>:<span class="number">2</span>&#125;&#125;,<span class="literal">false</span>,<span class="literal">true</span>)</div><div class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : <span class="number">3</span>, <span class="string">"nUpserted"</span> : <span class="number">0</span>, <span class="string">"nModified"</span> : <span class="number">2</span> &#125;)</div><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0dde9bae387d0c1e8d873"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0ddeabae387d0c1e8d874"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0ddebbae387d0c1e8d875"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">1</span> &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h1><ul>
<li><p>删除某个collection所有内容</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.remove(&#123;&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nRemoved"</span> : <span class="number">102</span> &#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>删除某个</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.remove(&#123;<span class="attr">x</span>:<span class="number">3</span>&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nRemoved"</span> : <span class="number">1</span> &#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="find"><a href="#find" class="headerlink" title="find"></a>find</h1><ul>
<li><p>查找所有</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find()</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0cebcbae387d0c1e8d80a"</span>), <span class="string">"username"</span> : <span class="string">"zhangsan"</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d36abae387d0c1e8d80b"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">3</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d37dbae387d0c1e8d80c"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>有条件查找</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;)</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d36abae387d0c1e8d80b"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">3</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d37dbae387d0c1e8d80c"</span>), <span class="string">"x"</span> : <span class="number">1</span>, <span class="string">"y"</span> : <span class="number">2</span>, <span class="string">"z"</span> : <span class="number">3</span> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>查找总数目</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find().count()</div><div class="line"><span class="number">102</span></div></pre></td></tr></table></figure>
</li>
<li><p>分页,排序</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.find().skip(<span class="number">5</span>).limit(<span class="number">3</span>).sort(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;)</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d453bae387d0c1e8d80f"</span>), <span class="string">"x"</span> : <span class="number">3</span>, <span class="string">"y"</span> : <span class="number">30</span>, <span class="string">"z"</span> : <span class="number">300</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d453bae387d0c1e8d810"</span>), <span class="string">"x"</span> : <span class="number">4</span>, <span class="string">"y"</span> : <span class="number">40</span>, <span class="string">"z"</span> : <span class="number">400</span> &#125;</div><div class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"58d0d453bae387d0c1e8d811"</span>), <span class="string">"x"</span> : <span class="number">5</span>, <span class="string">"y"</span> : <span class="number">50</span>, <span class="string">"z"</span> : <span class="number">500</span> &#125;</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mongodb/mongoIndex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mongodb/mongoIndex/" itemprop="url">
                  mongoIndex
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:53:16+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h1><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.getIndexSpecs() </div><div class="line">or</div><div class="line">&gt; db.user.getIndexes()</div></pre></td></tr></table></figure>
<h1 id="id索引"><a href="#id索引" class="headerlink" title="id索引"></a>id索引</h1><p>默认创建 _id</p>
<h1 id="单键索引"><a href="#单键索引" class="headerlink" title="单键索引"></a>单键索引</h1><ul>
<li>创建索引：<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">db.user.ensureIndex(&#123;<span class="attr">x</span>:<span class="number">1</span>&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>索引可以重复创建，如果索引已存在，则直接返回成功</p>
<h1 id="多键索引"><a href="#多键索引" class="headerlink" title="多键索引"></a>多键索引</h1><p>创建形式与单键索引相同，区别在于字段的值<br>单键索引的值为单一的值<br>多键索引为多个值，例如数组<br>例：当x有索引时：当插入<code>&gt; db.user.insert({x:[12,34,55,66]})</code>,便创建的多键索引</p>
<h1 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h1><p>插入：<br><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.insert(&#123;<span class="attr">x</span>:[<span class="number">12</span>,<span class="number">34</span>,<span class="number">55</span>,<span class="number">66</span>]&#125;)</div><div class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : <span class="number">1</span> &#125;)</div><div class="line">&gt; db.user.ensureIndex(&#123;<span class="attr">x</span>:<span class="number">1</span>,<span class="attr">y</span>:<span class="number">1</span>&#125;)</div><div class="line">&#123;</div><div class="line">	<span class="string">"createdCollectionAutomatically"</span> : <span class="literal">false</span>,</div><div class="line">	<span class="string">"numIndexesBefore"</span> : <span class="number">2</span>,</div><div class="line">	<span class="string">"numIndexesAfter"</span> : <span class="number">3</span>,</div><div class="line">	<span class="string">"ok"</span> : <span class="number">1</span></div><div class="line">&#125;</div><div class="line">&gt; db.user.getIndexes()</div><div class="line">[</div><div class="line">	&#123;</div><div class="line">		<span class="string">"v"</span> : <span class="number">2</span>,</div><div class="line">		<span class="string">"key"</span> : &#123;</div><div class="line">			<span class="string">"_id"</span> : <span class="number">1</span></div><div class="line">		&#125;,</div><div class="line">		<span class="string">"name"</span> : <span class="string">"_id_"</span>,</div><div class="line">		<span class="string">"ns"</span> : <span class="string">"blog.user"</span></div><div class="line">	&#125;,</div><div class="line">	&#123;</div><div class="line">		<span class="string">"v"</span> : <span class="number">2</span>,</div><div class="line">		<span class="string">"key"</span> : &#123;</div><div class="line">			<span class="string">"x"</span> : <span class="number">1</span></div><div class="line">		&#125;,</div><div class="line">		<span class="string">"name"</span> : <span class="string">"x_1"</span>,</div><div class="line">		<span class="string">"ns"</span> : <span class="string">"blog.user"</span></div><div class="line">	&#125;,</div><div class="line">	&#123;</div><div class="line">		<span class="string">"v"</span> : <span class="number">2</span>,</div><div class="line">		<span class="string">"key"</span> : &#123;</div><div class="line">			<span class="string">"x"</span> : <span class="number">1</span>,</div><div class="line">			<span class="string">"y"</span> : <span class="number">1</span></div><div class="line">		&#125;,</div><div class="line">		<span class="string">"name"</span> : <span class="string">"x_1_y_1"</span>,</div><div class="line">		<span class="string">"ns"</span> : <span class="string">"blog.user"</span></div><div class="line">	&#125;</div><div class="line">]</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mongodb/installAndHelp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mongodb/installAndHelp/" itemprop="url">
                  installAndHelp
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T22:53:16+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p>当然，最权威的还是官网<br><a href="https://docs.mongodb.com" target="_blank" rel="external">官方wiki</a></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul>
<li><a href="https://docs.mongodb.com/manual/administration/install-enterprise/" target="_blank" rel="external">官网安装方式</a></li>
<li>安装之后可以将mongodb的bin目录增加到PATH目录中</li>
<li>例如mac：只需要<code>brew install mongodb</code>,<br>然后将<code>/usr/local/Cellar/mongodb/3.4.2/bin</code>加入到path中即可<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1></li>
<li><p>创建目录<br>demo：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/web_back/mongodb ll</div><div class="line">drwxr-xr-x   3 chimp  wheel  102  3 21 14:01 conf</div><div class="line">drwxr-xr-x  20 chimp  wheel  680  3 21 14:32 data</div><div class="line">drwxr-xr-x   4 chimp  wheel  136  3 21 14:07 log</div></pre></td></tr></table></figure>
</li>
<li><p>增加conf文件<br>此时没有增加用户认证，生产环境肯定要加的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/web_back/mongodb cat conf/mongod.conf</div><div class="line">port = 12345</div><div class="line">dbpath = data</div><div class="line">logpath = log/mongod.log</div><div class="line">fork = true</div></pre></td></tr></table></figure>
</li>
<li><p>运行<code>mongod -f /conf/mongod.conf</code><br>之前将/usr/local/Cellar/mongodb/3.4.2/bin加入到PATH中，mongod可执行文件就在此目录下</p>
</li>
<li>日志存放在<code>log/mongod.log</code>中<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">/chimps/web_back/mongodb tail -f log/mongod.log</div><div class="line">2017-03-21T14:07:03.850+0800 I -        [initandlisten] Detected data files in /chimps/web_back/mongodb/data created by the &apos;wiredTiger&apos; storage engine, so setting the active storage engine to &apos;wiredTiger&apos;.</div><div class="line">... ...</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><h2 id="mongo-h"><a href="#mongo-h" class="headerlink" title="mongo -h"></a>mongo -h</h2><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">~ mongo -h</div><div class="line">MongoDB shell version v3.4.2</div><div class="line">usage: mongo [options] [db address] [file names (ending in .js)]    # 格式</div><div class="line">db address can be:</div><div class="line">  foo                   foo database on local machine</div><div class="line">  192.168.0.5/foo       foo database on 192.168.0.5 machine</div><div class="line">  192.168.0.5:9999/foo  foo database on 192.168.0.5 machine on port 9999</div><div class="line">Options:</div><div class="line">  --shell                             run the shell after executing files</div><div class="line">  --nodb                              don&apos;t connect to mongod on startup - no</div><div class="line">                                      &apos;db address&apos; arg expected</div><div class="line">  --norc                              will not run the &quot;.mongorc.js&quot; file on</div><div class="line">                                      start up</div><div class="line">  --quiet                             be less chatty</div><div class="line">  --port arg                          port to connect to</div><div class="line">  --host arg                          server to connect to</div><div class="line">  --eval arg                          evaluate javascript</div><div class="line">  -h [ --help ]                       show this usage information</div><div class="line">  --version                           show version information</div><div class="line">  --verbose                           increase verbosity</div><div class="line">  --ipv6                              enable IPv6 support (disabled by default)</div><div class="line">  --disableJavaScriptJIT              disable the Javascript Just In Time</div><div class="line">                                      compiler</div><div class="line">  --disableJavaScriptProtection       allow automatic JavaScript function</div><div class="line">                                      marshalling</div><div class="line">  --ssl                               use SSL for all connections</div><div class="line">  --sslCAFile arg                     Certificate Authority file for SSL</div><div class="line">  --sslPEMKeyFile arg                 PEM certificate/key file for SSL</div><div class="line">  --sslPEMKeyPassword arg             password for key in PEM file for SSL</div><div class="line">  --sslCRLFile arg                    Certificate Revocation List file for SSL</div><div class="line">  --sslAllowInvalidHostnames          allow connections to servers with</div><div class="line">                                      non-matching hostnames</div><div class="line">  --sslAllowInvalidCertificates       allow connections to servers with invalid</div><div class="line">                                      certificates</div><div class="line">  --sslFIPSMode                       activate FIPS 140-2 mode at startup</div><div class="line">  --networkMessageCompressors arg     Comma-separated list of compressors to</div><div class="line">                                      use for network messages</div><div class="line">  --jsHeapLimitMB arg                 set the js scope&apos;s heap size limit</div><div class="line"></div><div class="line">Authentication Options:</div><div class="line">  -u [ --username ] arg               username for authentication</div><div class="line">  -p [ --password ] arg               password for authentication</div><div class="line">  --authenticationDatabase arg        user source (defaults to dbname)</div><div class="line">  --authenticationMechanism arg       authentication mechanism</div><div class="line">  --gssapiServiceName arg (=mongodb)  Service name to use when authenticating</div><div class="line">                                      using GSSAPI/Kerberos</div><div class="line">  --gssapiHostName arg                Remote host name to use for purpose of</div><div class="line">                                      GSSAPI/Kerberos authentication</div><div class="line"></div><div class="line">file names: a list of files to run. files have to end in .js and will exit after unless --shell is specified</div></pre></td></tr></table></figure>
<ul>
<li>只需要：<code>mongo localhost:12345</code><h1 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h1></li>
<li><p><code>db.help()</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">&gt; db.help()</div><div class="line">DB methods:</div><div class="line">	db.adminCommand(nameOrDocument) - switches to 'admin' db, and runs command [ just calls db.runCommand(...) ]</div><div class="line">	db.auth(username, password)</div><div class="line">	db.cloneDatabase(fromhost)</div><div class="line">	db.commandHelp(name) returns the help for the command</div><div class="line">	db.copyDatabase(fromdb, todb, fromhost)</div><div class="line">	db.createCollection(name, &#123; size : ..., capped : ..., max : ... &#125; )</div><div class="line">	db.createView(name, viewOn, [ &#123; $operator: &#123;...&#125;&#125;, ... ], &#123; viewOptions &#125; )</div><div class="line">	db.createUser(userDocument)</div><div class="line">	db.currentOp() displays currently executing operations in the db</div><div class="line">	db.dropDatabase()</div><div class="line">	db.eval() - deprecated</div><div class="line">	db.fsyncLock() flush data to disk and lock server for backups</div><div class="line">	db.fsyncUnlock() unlocks server following a db.fsyncLock()</div><div class="line">	db.getCollection(cname) same as db['cname'] or db.cname</div><div class="line">	db.getCollectionInfos([filter]) - returns a list that contains the names and options of the db's collections</div><div class="line">	db.getCollectionNames()</div><div class="line">	db.getLastError() - just returns the err msg string</div><div class="line">	db.getLastErrorObj() - return full status object</div><div class="line">	db.getLogComponents()</div><div class="line">	db.getMongo() get the server connection object</div><div class="line">	db.getMongo().setSlaveOk() allow queries on a replication slave server</div><div class="line">	db.getName()</div><div class="line">	db.getPrevError()</div><div class="line">	db.getProfilingLevel() - deprecated</div><div class="line">	db.getProfilingStatus() - returns if profiling is on and slow threshold</div><div class="line">	db.getReplicationInfo()</div><div class="line">	db.getSiblingDB(name) get the db at the same server as this one</div><div class="line">	db.getWriteConcern() - returns the write concern used for any operations on this db, inherited from server object if set</div><div class="line">	db.hostInfo() get details about the server's host</div><div class="line">	db.isMaster() check replica primary status</div><div class="line">	db.killOp(opid) kills the current operation in the db</div><div class="line">	db.listCommands() lists all the db commands</div><div class="line">	db.loadServerScripts() loads all the scripts in db.system.js</div><div class="line">	db.logout()</div><div class="line">	db.printCollectionStats()</div><div class="line">	db.printReplicationInfo()</div><div class="line">	db.printShardingStatus()</div><div class="line">	db.printSlaveReplicationInfo()</div><div class="line">	db.dropUser(username)</div><div class="line">	db.repairDatabase()</div><div class="line">	db.resetError()</div><div class="line">	db.runCommand(cmdObj) run a database command.  if cmdObj is a string, turns it into &#123; cmdObj : 1 &#125;</div><div class="line">	db.serverStatus()</div><div class="line">	db.setLogLevel(level,&lt;component&gt;)</div><div class="line">	db.setProfilingLevel(level,&lt;slowms&gt;) 0=off 1=slow 2=all</div><div class="line">	db.setWriteConcern( &lt;write concern doc&gt; ) - sets the write concern for writes to the db</div><div class="line">	db.unsetWriteConcern( &lt;write concern doc&gt; ) - unsets the write concern for writes to the db</div><div class="line">	db.setVerboseShell(flag) display extra information in shell output</div><div class="line">	db.shutdownServer()</div><div class="line">	db.stats()</div><div class="line">	db.version() current version of the server</div></pre></td></tr></table></figure>
</li>
<li><p>collection 相关操作<br>假设我有个user 字段</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&gt; db.user.help()</div><div class="line">DBCollection help</div><div class="line">	db.user.find().help() - show DBCursor help</div><div class="line">	db.user.bulkWrite( operations, &lt;optional params&gt; ) - bulk execute write operations, optional parameters are: w, wtimeout, j</div><div class="line">	db.user.count( query = &#123;&#125;, &lt;optional params&gt; ) - count the number <span class="keyword">of</span> documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS</div><div class="line">	db.user.copyTo(newColl) - duplicates collection by copying all documents to newColl; no indexes are copied.</div><div class="line">	db.user.convertToCapped(maxBytes) - calls &#123;<span class="attr">convertToCapped</span>:<span class="string">'user'</span>, <span class="attr">size</span>:maxBytes&#125;&#125; command</div><div class="line">	db.user.createIndex(keypattern[,options])</div><div class="line">	db.user.createIndexes([keypatterns], &lt;options&gt;)</div><div class="line">	db.user.dataSize()</div><div class="line">	db.user.deleteOne( filter, &lt;optional params&gt; ) - <span class="keyword">delete</span> first matching <span class="built_in">document</span>, optional parameters are: w, wtimeout, j</div><div class="line">	db.user.deleteMany( filter, &lt;optional params&gt; ) - <span class="keyword">delete</span> all matching documents, optional parameters are: w, wtimeout, j</div><div class="line">	db.user.distinct( key, query, &lt;optional params&gt; ) - e.g. db.user.distinct( <span class="string">'x'</span> ), optional parameters are: maxTimeMS</div><div class="line">	db.user.drop() drop the collection</div><div class="line">	db.user.dropIndex(index) - e.g. db.user.dropIndex( <span class="string">"indexName"</span> ) or db.user.dropIndex( &#123; <span class="string">"indexKey"</span> : <span class="number">1</span> &#125; )</div><div class="line">	db.user.dropIndexes()</div><div class="line">	db.user.ensureIndex(keypattern[,options]) - DEPRECATED, use createIndex() instead</div><div class="line">	db.user.explain().help() - show explain help</div><div class="line">	db.user.reIndex()</div><div class="line">	db.user.find([query],[fields]) - query is an optional query filter. fields is optional set <span class="keyword">of</span> fields to <span class="keyword">return</span>.</div><div class="line">	                                              e.g. db.user.find( &#123;<span class="attr">x</span>:<span class="number">77</span>&#125; , &#123;<span class="attr">name</span>:<span class="number">1</span>, <span class="attr">x</span>:<span class="number">1</span>&#125; )</div><div class="line">	db.user.find(...).count()</div><div class="line">	db.user.find(...).limit(n)</div><div class="line">	db.user.find(...).skip(n)</div><div class="line">	db.user.find(...).sort(...)</div><div class="line">	db.user.findOne([query], [fields], [options], [readConcern])</div><div class="line">	db.user.findOneAndDelete( filter, &lt;optional params&gt; ) - <span class="keyword">delete</span> first matching <span class="built_in">document</span>, optional parameters are: projection, sort, maxTimeMS</div><div class="line">	db.user.findOneAndReplace( filter, replacement, &lt;optional params&gt; ) - replace first matching <span class="built_in">document</span>, optional parameters are: projection, sort, maxTimeMS, upsert, returnNewDocument</div><div class="line">	db.user.findOneAndUpdate( filter, update, &lt;optional params&gt; ) - update first matching <span class="built_in">document</span>, optional parameters are: projection, sort, maxTimeMS, upsert, returnNewDocument</div><div class="line">	db.user.getDB() get DB object associated <span class="keyword">with</span> collection</div><div class="line">	db.user.getPlanCache() get query plan cache associated <span class="keyword">with</span> collection</div><div class="line">	db.user.getIndexes()</div><div class="line">	db.user.group( &#123; <span class="attr">key</span> : ..., <span class="attr">initial</span>: ..., <span class="attr">reduce</span> : ...[, <span class="attr">cond</span>: ...] &#125; )</div><div class="line">	db.user.insert(obj)</div><div class="line">	db.user.insertOne( obj, &lt;optional params&gt; ) - insert a <span class="built_in">document</span>, optional parameters are: w, wtimeout, j</div><div class="line">	db.user.insertMany( [objects], &lt;optional params&gt; ) - insert multiple documents, optional parameters are: w, wtimeout, j</div><div class="line">	db.user.mapReduce( mapFunction , reduceFunction , &lt;optional params&gt; )</div><div class="line">	db.user.aggregate( [pipeline], &lt;optional params&gt; ) - performs an aggregation on a collection; returns a cursor</div><div class="line">	db.user.remove(query)</div><div class="line">	db.user.replaceOne( filter, replacement, &lt;optional params&gt; ) - replace the first matching <span class="built_in">document</span>, optional parameters are: upsert, w, wtimeout, j</div><div class="line">	db.user.renameCollection( newName , &lt;dropTarget&gt; ) renames the collection.</div><div class="line">	db.user.runCommand( name , &lt;options&gt; ) runs a db command <span class="keyword">with</span> the given name where the first param is the collection name</div><div class="line">	db.user.save(obj)</div><div class="line">	db.user.stats(&#123;<span class="attr">scale</span>: N, <span class="attr">indexDetails</span>: <span class="literal">true</span>/<span class="literal">false</span>, <span class="attr">indexDetailsKey</span>: &lt;index key&gt;, indexDetailsName: &lt;index name&gt;&#125;)</div><div class="line">	db.user.storageSize() - includes free space allocated to this collection</div><div class="line">	db.user.totalIndexSize() - size in bytes of all the indexes</div><div class="line">	db.user.totalSize() - storage allocated for all data and indexes</div><div class="line">	db.user.update( query, object[, upsert_bool, multi_bool] ) - instead of two flags, you can pass an object with fields: upsert, multi</div><div class="line">	db.user.updateOne( filter, update, &lt;optional params&gt; ) - update the first matching document, optional parameters are: upsert, w, wtimeout, j</div><div class="line">	db.user.updateMany( filter, update, &lt;optional params&gt; ) - update all matching documents, optional parameters are: upsert, w, wtimeout, j</div><div class="line">	db.user.validate( &lt;full&gt; ) - SLOW</div><div class="line">	db.user.getShardVersion() - only for use with sharding</div><div class="line">	db.user.getShardDistribution() - prints statistics about data distribution in the cluster</div><div class="line">	db.user.getSplitKeysForChunks( &lt;maxChunkSize&gt; ) - calculates split points over all chunks and returns splitter function</div><div class="line">	db.user.getWriteConcern() - returns the write concern used for any operations on this collection, inherited from server/db if set</div><div class="line">	db.user.setWriteConcern( &lt;write concern doc&gt; ) - sets the write concern for writes to the collection</div><div class="line">	db.user.unsetWriteConcern( &lt;write concern doc&gt; ) - unsets the write concern for writes to the collection</div><div class="line">	db.user.latencyStats() - display operation latency histograms for this collection</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/mongodb/auth/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chimps">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="chimps">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mongodb/auth/" itemprop="url">
                  auth认证
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T10:07:42+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mongodb/" itemprop="url" rel="index">
                    <span itemprop="name">mongodb</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="以auth认证方式启动"><a href="#以auth认证方式启动" class="headerlink" title="以auth认证方式启动"></a>以auth认证方式启动</h1><ul>
<li><p>可以在config文件中加一项：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">auth: true</div></pre></td></tr></table></figure>
</li>
<li><p>可以在命令行中，添加一个option，<code>--auth</code></p>
</li>
</ul>
<p>但是，如果mongodb中没有用户，认证是没有意义的。</p>
<h1 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h1><ul>
<li><p>选择库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">// 用户的存储也是基于库的。管理员用户的话，需要在admin中创建。创建的第一个用户即为管理员用户</div><div class="line">&gt; use admin</div></pre></td></tr></table></figure>
</li>
<li><p>创建管理员用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">db.createUser(&#123;</div><div class="line">    user:&quot;root&quot;, </div><div class="line">    pwd:&quot;root&quot;, </div><div class="line">    roles:[</div><div class="line">     	&#123;</div><div class="line">            role:&quot;userAdminAnyDatabase&quot;, </div><div class="line">            db:&quot;admin&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>创建普通用户</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">db.createUser(&#123;</div><div class="line">    user:&quot;user1&quot;, </div><div class="line">    pwd:&quot;pwd1&quot;, </div><div class="line">    roles:[</div><div class="line">     	&#123;</div><div class="line">            role:&quot;readWrite&quot;, </div><div class="line">            db:&quot;db1&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">// user所存储的库</div><div class="line">&gt; use admin</div><div class="line">&gt; db.auth(username, password)</div><div class="line">// 返回原数据库</div><div class="line">&gt; use blog</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="chimps" />
          <p class="site-author-name" itemprop="name">chimps</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chimps</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
